/* ========================================
   SELAH RHYTHM GLOBAL STYLES
   v0.9.45
   ======================================== */

@import './variables.css';


    /* GLOBAL TYPOGRAPHY - Applied once at body level */
    body { 
      font-family: var(--font-body);
      font-weight: var(--weight-regular);
      min-height: 100vh; 
      color: var(--text);
      font-size: var(--text-base);
      line-height: var(--leading-normal);
      letter-spacing: var(--tracking-normal);
      background: var(--bg);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .reduce-motion body {
      transition: none;
    }
    
    /* Typography inheritance - no per-component font-family */
    input, button, textarea, select {
      font-family: inherit;
      font-size: inherit;
    }
    
    /* CROSSFADE BACKGROUND SYSTEM - All 3 layers always mounted, opacity crossfade */
    .bg-layers { 
      position: fixed; 
      inset: -50px; /* Extend beyond viewport */
      z-index: -1; 
      pointer-events: none;
      overflow: hidden;
    }
    .bg-layer {
      position: absolute; 
      inset: -50px; /* Match parent extension */
      opacity: 0;
      transition: opacity 0.3s ease-out;
      will-change: opacity;
    }
    .bg-layer.active { opacity: 1; }
    .bg-layer::before { 
      content: ''; 
      position: absolute; 
      inset: -20%; /* Larger overflow for gradients */
    }
    
    /* Dark mode background consistency */
    [data-theme="dark"] .bg-layers {
      background: var(--bg);
    }
    
    [data-theme="dark"] .bg-layer {
      background: var(--bg);
    }
    .bg-layer::after {
      content: ''; position: absolute; inset: 0;
      background: radial-gradient(ellipse 120% 100% at 50% 100%, transparent 50%, var(--bg) 100%);
      opacity: 0.25;
    }
    
    /* ORDER LAYER - warm terracotta hints */
    .bg-layer.order { background: var(--bg); }
    .bg-layer.order::before {
      background: 
        radial-gradient(ellipse 130% 90% at 50% -25%, var(--terracotta-bg) 0%, transparent 55%),
        radial-gradient(ellipse 90% 80% at 100% 15%, var(--ochre-bg) 0%, transparent 55%),
        radial-gradient(ellipse 70% 60% at 0% 75%, var(--sage-bg) 0%, transparent 50%),
        linear-gradient(175deg, var(--bg-tertiary) 0%, var(--bg-secondary) 50%, var(--bg-primary) 100%);
    }
    [data-theme="dark"] .bg-layer.order::before {
      background: 
        radial-gradient(ellipse 130% 90% at 50% -25%, var(--terracotta-bg) 0%, transparent 55%),
        radial-gradient(ellipse 90% 80% at 100% 15%, var(--ochre-bg) 0%, transparent 55%),
        radial-gradient(ellipse 70% 60% at 0% 75%, var(--sage-bg) 0%, transparent 50%),
        linear-gradient(175deg, var(--bg-tertiary) 0%, var(--bg-secondary) 50%, var(--bg-primary) 100%);
    }
    
    /* FOCUS LAYER - plum atmosphere */
    .bg-layer.focus { background: var(--bg); }
    .bg-layer.focus::before {
      background: 
        radial-gradient(ellipse 100% 75% at 50% 0%, var(--plum-bg) 0%, transparent 60%),
        radial-gradient(ellipse 70% 60% at 95% 75%, var(--terracotta-bg) 0%, transparent 50%),
        radial-gradient(ellipse 60% 50% at 5% 85%, var(--sage-bg) 0%, transparent 45%),
        linear-gradient(170deg, var(--bg-primary) 0%, var(--bg-secondary) 60%, var(--bg-tertiary) 100%);
    }
    [data-theme="dark"] .bg-layer.focus::before {
      background: 
        radial-gradient(ellipse 100% 75% at 50% 0%, var(--plum-bg) 0%, transparent 60%),
        radial-gradient(ellipse 70% 60% at 95% 75%, var(--terracotta-bg) 0%, transparent 50%),
        linear-gradient(170deg, var(--bg-primary) 0%, var(--bg-secondary) 60%, var(--bg-tertiary) 100%);
    }
    
    /* REST LAYER - sage calm */
    .bg-layer.rest { background: var(--bg); }
    .bg-layer.rest::before {
      background: 
        radial-gradient(ellipse 130% 100% at 50% 115%, var(--sage-bg) 0%, transparent 55%),
        radial-gradient(ellipse 80% 65% at 0% 45%, var(--terracotta-bg) 0%, transparent 50%),
        radial-gradient(ellipse 70% 55% at 100% 35%, var(--ochre-bg) 0%, transparent 50%),
        linear-gradient(175deg, var(--bg-secondary) 0%, var(--bg-tertiary) 50%, var(--bg-primary) 100%);
    }
    [data-theme="dark"] .bg-layer.rest::before {
      background: 
        radial-gradient(ellipse 130% 100% at 50% 115%, var(--sage-bg) 0%, transparent 55%),
        radial-gradient(ellipse 80% 65% at 0% 45%, var(--terracotta-bg) 0%, transparent 50%),
        linear-gradient(175deg, var(--bg-secondary) 0%, var(--bg-tertiary) 50%, var(--bg-primary) 100%);
    }
    
    /* RHYTHMIC DOT PATTERN - Subtle, atmospheric */
    .dot-pattern {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.4s ease-out;
      background-image: radial-gradient(circle at center, var(--dot-color) 1.2px, transparent 1.2px);
      background-size: 24px 24px;
      background-position: 12px 12px;
      /* Edge fade mask - dots fade toward edges */
      -webkit-mask-image: radial-gradient(ellipse 85% 85% at 50% 50%, black 30%, transparent 70%);
      mask-image: radial-gradient(ellipse 85% 85% at 50% 50%, black 30%, transparent 70%);
    }
    .dot-pattern.visible { opacity: 1; }
    .dot-pattern.animated {
      animation: dotDrift 25s ease-in-out infinite;
    }
    @keyframes dotDrift {
      0%, 100% { background-position: 12px 12px; }
      25% { background-position: 13px 11px; }
      50% { background-position: 11px 13px; }
      75% { background-position: 12px 11px; }
    }
    .reduce-motion .dot-pattern.animated { animation: none; }
    
    /* Hover emphasizes card, NOT dots */
    .has-dots { transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out; }
    .has-dots:hover { 
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
      border-color: var(--border-strong);
    }
    .has-dots:hover .dot-pattern { opacity: 0.7; }
    .has-dots:hover .dot-pattern.animated { 
      background-image: radial-gradient(circle at center, var(--dot-color-hover) 1.2px, transparent 1.2px);
    }
    /* Remove dots from most cards - only keep on specific surfaces */
    .card .dot-pattern { display: none; }
    .schedule-card .dot-pattern, .scripture-card .dot-pattern, .bestill-card .dot-pattern, .reflection-card .dot-pattern { display: block; }
    
    /* Prevent loading flash - match app layout sizing */
    #root:empty { 
      min-height: 100vh; 
      max-width: var(--content-max-width);
      margin: 0 auto;
      padding: var(--content-padding);
    }
    
    /* LOADING STATE - Centered, on-brand, matches app layout */
    /* LOADING STATE - On-brand with terracotta */
    #root > div[style*="padding: 40px"] {
      min-height: 100vh;
      max-width: var(--content-max-width);
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--content-padding);
      text-align: center;
      font-family: var(--font-body);
      color: #5A524A;
      background: linear-gradient(145deg, rgba(196, 112, 75, 0.04) 0%, rgba(122, 154, 126, 0.03) 40%, transparent 100%);
      position: relative;
    }
    #root > div[style*="padding: 40px"]::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: radial-gradient(rgba(196, 112, 75, 0.08) 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: 0.4;
      pointer-events: none;
    }
    .loading-logo {
      display: inline-flex;
      align-items: baseline;
      gap: 0.18em;
      font-size: 28px;
      letter-spacing: -0.02em;
      margin-bottom: 8px;
      animation: loadingPulse 2s ease-in-out infinite;
    }
    .loading-word-selah {
      font-family: var(--font-display);
      font-weight: 500;
      color: var(--terracotta); /* #C4704B */
    }
    .loading-word-rhythm {
      font-family: var(--font-body);
      color: var(--text-secondary); /* #5A524A */
      font-weight: 400;
    }
    .loading-tagline {
      font-size: 13px;
      color: var(--text-tertiary); /* #8A8078 */
      font-weight: 500;
      letter-spacing: 0.08em;
      margin-bottom: 16px;
    }
    .loading-status-text {
      font-size: 12px;
      color: #9d9a94;
      margin: 0;
    }
    @keyframes loadingPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    /* Dark mode loading */
    @media (prefers-color-scheme: dark) {
      #root > div[style*="padding: 40px"] {
        background: linear-gradient(145deg, rgba(196, 112, 75, 0.06) 0%, rgba(122, 154, 126, 0.04) 40%, transparent 100%);
      }
      #root > div[style*="padding: 40px"]::before {
        background-image: radial-gradient(rgba(196, 112, 75, 0.10) 1px, transparent 1px);
      }
      .loading-word-selah {
        color: var(--terracotta-soft); /* #D4846A */
      }
      .loading-word-rhythm {
        color: #F5F3F0;
      }
    }
    
    /* LAYOUT ALIGNMENT - Shared max-width for all sections */
    .app { 
      max-width: var(--content-max-width); 
      margin: 0 auto; 
      padding: var(--content-padding); 
      padding-bottom: 130px; 
    }
    
    /* HEADER - Strong blur separation, matches content width */
    .header { 
      position: relative; /* CRITICAL: Required for absolute positioning of nav-segmented-control */
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      padding: var(--space-2) var(--space-4); 
      background: rgba(250, 248, 242, 0.98);
      -webkit-backdrop-filter: blur(24px) saturate(1.1);
      backdrop-filter: blur(24px) saturate(1.1); 
      border-radius: var(--radius-xl); 
      margin-bottom: var(--space-4); 
      border: 1.5px solid rgba(44, 42, 39, 0.08);
      box-shadow: var(--shadow-sm);
      position: sticky;
      top: 10px;
      z-index: 100;
      overflow: visible; /* Changed from hidden - allows absolutely positioned control to be visible */
    }
    /* Dot + gradient overlay for nav bar - BALANCED VISIBILITY */
    .header {
      --nav-mx: 50%;
      --nav-my: 50%;
    }
    .header::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.28;
      background-image: radial-gradient(rgba(196, 112, 75, 0.15) 0.7px, transparent 0.8px);
      background-size: 7px 7px;
      -webkit-mask-image: linear-gradient(to right, black 0%, transparent 30%, transparent 70%, black 100%);
      mask-image: linear-gradient(to right, black 0%, transparent 30%, transparent 70%, black 100%);
      border-radius: inherit;
      overflow: hidden; /* Add this to contain the pattern */
    }
    .header::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: 
        radial-gradient(circle 100px at var(--nav-mx) var(--nav-my), rgba(196, 112, 75, 0.06), transparent 55%),
        linear-gradient(135deg, rgba(196, 112, 75, 0.03) 0%, rgba(212, 132, 106, 0.02) 30%, transparent 50%, rgba(59, 130, 246, 0.04) 100%);
      border-radius: inherit;
      opacity: 0;
      transition: opacity 0.25s ease-out;
    }
    @media (hover: hover) {
      .header:hover::after {
        opacity: 1;
      }
    }
    /* Safari fallback - reduce blur if rendering artifacts occur */
    @supports (-webkit-backdrop-filter: blur(1px)) and (not (backdrop-filter: blur(1px))) {
      .header {
        -webkit-backdrop-filter: blur(20px) saturate(1.05);
        backdrop-filter: blur(20px) saturate(1.05);
      }
    }
    [data-theme="dark"] .header {
      background: rgba(26, 24, 22, 0.95); /* Warm charcoal from --bg-primary */
      border-color: rgba(250, 248, 245, 0.06);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }
    [data-theme="dark"] .header::before {
      opacity: 0.12;
      background-image: radial-gradient(rgba(212, 132, 106, 0.12) 0.7px, transparent 0.8px);
    }
    [data-theme="dark"] .header::after {
      background: 
        radial-gradient(circle 100px at var(--nav-mx) var(--nav-my), rgba(196, 112, 75, 0.08), transparent 55%),
        linear-gradient(135deg, rgba(196, 112, 75, 0.04) 0%, rgba(212, 132, 106, 0.02) 30%, transparent 50%, rgba(96, 165, 250, 0.04) 100%);
    }
    .header-left { display: flex; align-items: center; gap: var(--space-3); min-width: 180px; cursor: pointer; }
    /* Header date (left side) */
    .header-date {
      margin-left: var(--space-4);
      padding-left: var(--space-4);
      border-left: 1px solid var(--border);
      display: flex;
      align-items: center;
    }
    .header-date-text {
      font-size: var(--text-sm);
      color: var(--text-muted);
      font-weight: 400;
    }
    @media (max-width: 768px) {
      .header-date {
        display: none;
      }
    }
    .logo-wrapper { 
      width: 32px; height: 32px; 
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-soft) 100%); 
      border-radius: 8px; 
      display: flex; align-items: center; justify-content: center; 
      box-shadow: 0 2px 6px rgba(196, 112, 75, 0.2);
      flex-shrink: 0;
    }
    .logo-wrapper:hover { transform: scale(1.05); box-shadow: 0 3px 10px rgba(196, 112, 75, 0.25); }
    .logo-wrapper svg { width: 16px; height: 16px; color: #fff; }
    .title-block { display: flex; flex-direction: column; }
    .title { font-size: var(--text-lg); font-weight: 600; color: var(--text); letter-spacing: var(--tracking-tight); }
    .tagline { font-size: var(--text-xs); color: var(--text-muted); font-weight: 400; letter-spacing: var(--tracking-normal); }
    
    /* SELAH RHYTHM LOGO TEXT */
    .sr-logo-text,
    .brand-name {
      display: flex;
      align-items: baseline;
      gap: 6px;
    }
    .sr-word-selah,
    .brand-selah,
    .logo-selah {
      font-family: var(--font-display);
      font-size: 22px;
      font-weight: 500;
      color: var(--terracotta);
    }
    .sr-word-rhythm,
    .brand-rhythm,
    .logo-rhythm {
      font-family: var(--font-body);
      font-size: 18px;
      font-weight: 400;
      color: var(--text-secondary);
    }
    [data-theme="dark"] .sr-word-selah {
      color: var(--accent-soft);
    }
    [data-theme="dark"] .sr-word-rhythm {
      color: var(--text);
    }
    /* Header center - true viewport center */
    .header-center { 
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      display: flex; 
      align-items: center; 
      gap: 0; 
    }
    .mode-tab { 
      padding: var(--space-2) var(--space-4); 
      border: none; 
      background: transparent; 
      color: var(--text-light); 
      font-size: var(--text-sm); 
      font-weight: 500; 
      cursor: pointer; 
      position: relative; 
      border-radius: var(--radius-sm);
      min-width: 60px;
    }
    .mode-tab:hover { color: var(--text-muted); background: var(--accent-hover); transform: translateY(-1px); }
    .mode-tab.active { color: var(--accent); background: var(--accent-light); }
    .mode-tab:active { transform: translateY(0); }
    
    /* Nav tab active states - rounded rectangle with colors */
    .nav-tab.active,
    .nav-segment-btn.active {
      background: white;
      color: var(--text-primary);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    /* Nav Tab Active States - mode-specific text colors */
    .nav-tab.active[data-tab="order"],
    .nav-tab.active[data-mode="order"],
    .nav-segment-btn.active.mode-order {
      color: var(--terracotta);
      background: white;
    }
    .nav-tab.active[data-tab="focus"],
    .nav-tab.active[data-mode="focus"],
    .nav-segment-btn.active.mode-focus {
      color: var(--plum);
      background: white;
    }
    .nav-tab.active[data-tab="rest"],
    .nav-tab.active[data-mode="rest"],
    .nav-segment-btn.active.mode-rest {
      color: var(--sage);
      background: white;
    }
    /* Legacy support */
    .mode-order .nav-tab.active[data-view="order"] {
      background: var(--terracotta);
      color: white;
    }
    .mode-focus .nav-tab.active[data-view="focus"] {
      background: var(--plum);
      color: white;
    }
    .mode-rest .nav-tab.active[data-view="rest"] {
      background: var(--sage);
      color: white;
    }
    
    /* ============================================
       NAV BAR REDESIGN - v0.9.14
       ============================================ */
    
    /* Segmented Control Container */
    .nav-segmented-control,
    .nav-tabs {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%); /* Center both horizontally AND vertically */
      display: inline-flex;
      align-items: center;
      background: rgba(0, 0, 0, 0.06);
      border: none;
      border-radius: 12px;
      padding: 4px;
      gap: 0;
      z-index: 10; /* Ensure it's above other header content */
    }
    
    /* Sliding Indicator - rounded rectangle */
    .nav-segment-pill {
      position: absolute;
      top: 4px;
      bottom: 4px;
      width: calc(33.333% - 2px);
      border-radius: 8px;
      transition: transform 0.28s cubic-bezier(0.4, 0, 0.2, 1), background 0.28s ease;
      z-index: 0;
      pointer-events: none;
    }
    
    /* Mode-specific pill colors */
    .nav-segment-pill.mode-order {
      background: rgba(196, 112, 75, 0.15);
      box-shadow: 0 1px 3px rgba(196, 112, 75, 0.1);
      transform: translateX(0);
    }
    .nav-segment-pill.mode-focus {
      background: rgba(59, 130, 246, 0.15);
      box-shadow: 0 1px 3px rgba(59, 130, 246, 0.1);
      transform: translateX(100%);
    }
    .nav-segment-pill.mode-rest {
      background: rgba(16, 185, 129, 0.15);
      box-shadow: 0 1px 3px rgba(16, 185, 129, 0.1);
      transform: translateX(200%);
    }
    
    /* Dark mode pill colors */
    [data-theme="dark"] .nav-segment-pill.mode-order {
      background: rgba(196, 112, 75, 0.2);
    }
    [data-theme="dark"] .nav-segment-pill.mode-focus {
      background: rgba(96, 165, 250, 0.2);
    }
    [data-theme="dark"] .nav-segment-pill.mode-rest {
      background: rgba(52, 211, 153, 0.2);
    }
    
    /* Segment Buttons - rounded rectangle */
    /* FIX: Explicitly set color and opacity in all states to prevent text from disappearing.
     * The "Rest" label was becoming invisible due to conflicting color declarations (white text on white background).
     * Solution: Set explicit color values for all states (inactive, active, hover, focus) in both light and dark modes.
     */
    .nav-segment-btn,
    .nav-tab {
      position: relative;
      z-index: 1;
      padding: 8px 20px;
      border: none;
      background: transparent;
      color: var(--text-secondary); /* Explicit color - never inherited */
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s ease;
      min-width: 70px;
      opacity: 1; /* Explicit opacity - prevent any inherited opacity from hiding text */
      -webkit-text-fill-color: var(--text-secondary); /* Explicit webkit fill color */
    }
    .nav-segment-btn:hover,
    .nav-tab:hover {
      color: var(--text-primary); /* Explicit hover color */
      background: rgba(0, 0, 0, 0.03);
      opacity: 1;
      -webkit-text-fill-color: var(--text-primary);
    }
    .nav-segment-btn:focus,
    .nav-tab:focus {
      color: var(--text-primary); /* Explicit focus color */
      opacity: 1;
      -webkit-text-fill-color: var(--text-primary);
      outline: 2px solid var(--focus-ring);
      outline-offset: 2px;
    }
    /* Nav segmented control in dark mode */
    [data-theme="dark"] .nav-segmented-control {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.08);
    }
    [data-theme="dark"] .nav-segment-btn,
    [data-theme="dark"] .nav-tab {
      color: var(--text-tertiary); /* Explicit dark mode inactive color */
      opacity: 1;
      -webkit-text-fill-color: var(--text-tertiary);
    }
    [data-theme="dark"] .nav-segment-btn:hover,
    [data-theme="dark"] .nav-tab:hover {
      color: var(--text-secondary); /* Explicit dark mode hover color */
      opacity: 1;
      -webkit-text-fill-color: var(--text-secondary);
    }
    [data-theme="dark"] .nav-segment-btn:focus,
    [data-theme="dark"] .nav-tab:focus {
      color: var(--text-secondary); /* Explicit dark mode focus color */
      opacity: 1;
      -webkit-text-fill-color: var(--text-secondary);
    }
    
    /* Active segment text colors (mode-specific) - updated to rounded rectangle */
    /* FIX: Each active state must explicitly set BOTH background AND text color to prevent white-on-white invisibility */
    .nav-segment-btn.active.mode-order,
    .nav-tab.active.mode-order {
      color: var(--terracotta); /* Explicit active color - terracotta text on white background */
      background: white;
      opacity: 1;
      -webkit-text-fill-color: var(--terracotta);
    }
    .nav-segment-btn.active.mode-focus,
    .nav-tab.active.mode-focus {
      color: var(--plum); /* Explicit active color - plum text on white background */
      background: white;
      opacity: 1;
      -webkit-text-fill-color: var(--plum);
    }
    .nav-segment-btn.active.mode-rest,
    .nav-tab.active.mode-rest {
      color: var(--sage); /* Explicit active color - sage text on white background (FIXED: removed duplicate white override) */
      background: white;
      opacity: 1;
      -webkit-text-fill-color: var(--sage);
    }
    
    /* Dark mode active colors - explicit white text on colored backgrounds */
    [data-theme="dark"] .nav-segment-btn.active.mode-order,
    [data-theme="dark"] .nav-tab.active.mode-order {
      background: var(--terracotta);
      color: white; /* Explicit white text on terracotta background */
      opacity: 1;
      -webkit-text-fill-color: white;
    }
    [data-theme="dark"] .nav-segment-btn.active.mode-focus,
    [data-theme="dark"] .nav-tab.active.mode-focus {
      background: var(--plum);
      color: white; /* Explicit white text on plum background */
      opacity: 1;
      -webkit-text-fill-color: white;
    }
    [data-theme="dark"] .nav-segment-btn.active.mode-rest,
    [data-theme="dark"] .nav-tab.active.mode-rest {
      background: var(--sage);
      color: white; /* Explicit white text on sage background */
      opacity: 1;
      -webkit-text-fill-color: white;
    }
    
    /* Mobile: Stack nav below header on very small screens */
    @media (max-width: 600px) {
      .header {
        flex-wrap: wrap;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-3);
      }
      
      .nav-segmented-control {
        position: relative; /* Remove absolute positioning on mobile */
        left: auto;
        top: auto;
        transform: none;
        order: 3; /* Move to end */
        width: 100%;
        justify-content: center;
        margin-top: var(--space-1);
      }
      
      .header-left {
        flex: 1;
        min-width: auto;
      }
      
      .header-right {
        flex: 0;
        min-width: auto;
      }
      
      /* Hide greeting on very small screens to save space */
      .nav-greeting {
        display: none;
      }
      
      /* Make nav buttons smaller */
      .nav-segment-btn {
        padding: 5px 12px;
        min-width: 60px;
        font-size: var(--text-xs);
      }
    }
    
    /* Medium screens: Reduce spacing */
    @media (max-width: 768px) and (min-width: 601px) {
      .nav-greeting-text {
        max-width: 100px;
      }
      
      .nav-segment-btn {
        padding: 5px 14px;
        min-width: 65px;
      }
    }
    
    /* Greeting Display */
    .nav-greeting {
      font-size: var(--text-sm);
      color: var(--text);
      font-weight: 500;
      padding: var(--space-2) var(--space-3);
      background: var(--toggle-bg);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }
    .nav-greeting-divider {
      color: var(--text-muted);
      opacity: 0.5;
    }
    .nav-greeting-date {
      color: var(--text-muted);
      font-weight: 400;
    }
    .nav-greeting-text {
      max-width: 160px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* Progress Indicator */
    .nav-progress {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: var(--toggle-bg);
      border-radius: var(--radius-sm);
      cursor: default;
    }
    .nav-progress-ring {
      width: 18px;
      height: 18px;
      position: relative;
    }
    .nav-progress-ring svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }
    .nav-progress-ring-track,
    .progress-ring-track {
      fill: none;
      stroke: var(--border-default);
      stroke-width: 3;
    }
    .nav-progress-ring-fill,
    .progress-ring-fill,
    .progress-ring-progress {
      fill: none;
      stroke: var(--sage);
      stroke-width: 3;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s ease;
    }
    .nav-progress-text {
      font-size: var(--text-xs);
      font-weight: 600;
      color: var(--text);
      font-variant-numeric: tabular-nums;
    }
    .nav-progress-label {
      font-size: 9px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Scroll-aware header shadow */
    .header {
      transition: box-shadow 0.3s ease, backdrop-filter 0.3s ease;
    }
    .header.scrolled {
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
    }
    [data-theme="dark"] .header.scrolled {
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    
    /* Hide old mode-tab styles (keep for fallback) */
    .header-center {
      display: none; /* Replaced by nav-segmented-control */
    }
    
    .header-right { display: flex; align-items: center; gap: var(--space-2); min-width: 140px; justify-content: flex-end; }
    .date-display { font-size: var(--text-sm); color: var(--text-muted); font-weight: 500; padding: var(--space-2); background: var(--toggle-bg); border-radius: var(--radius-sm); }
    .header-btn { 
      display: flex; align-items: center; justify-content: center; 
      width: 34px; height: 34px; border: none; 
      background: var(--toggle-bg); color: var(--text-muted); 
      border-radius: var(--radius-md); cursor: pointer;
      transition: all 0.15s ease-out;
    }
    .header-btn:hover { 
      color: var(--text); 
      background: var(--border-strong); 
      transform: translateY(-1px);
    }
    .header-btn:active { transform: translateY(0); }
    
    /* Nav Timer Indicator - Plum pill with bright pulse */
    .nav-timer-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px 6px 12px;
      background: var(--plum);
      border-radius: var(--radius-full);
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .nav-timer-indicator:hover {
      background: var(--plum-deep);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(107, 74, 107, 0.4);
    }
    .nav-timer-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: navTimerPulse 1.5s ease-in-out infinite;
    }
    .nav-timer-dot.focus {
      background: #FFFFFF;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
    }
    .nav-timer-dot.break {
      background: #7dd3fc;
      box-shadow: 0 0 8px rgba(125, 211, 252, 0.8);
    }
    .nav-timer-time {
      font-size: var(--text-sm);
      font-weight: 600;
      color: white;
      font-variant-numeric: tabular-nums;
      min-width: 36px;
    }
    @keyframes navTimerPulse {
      0%, 100% { opacity: 1; transform: scale(1); box-shadow: 0 0 8px rgba(255, 255, 255, 0.8); }
      50% { opacity: 0.8; transform: scale(0.85); box-shadow: 0 0 12px rgba(255, 255, 255, 1); }
    }
    .reduce-motion .nav-timer-dot {
      animation: none;
    }
    
    /* Dark mode adjustments */
    [data-theme="dark"] .nav-timer-indicator {
      background: var(--plum);
    }
    [data-theme="dark"] .nav-timer-dot.focus {
      background: #FFFFFF;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.9);
    }
    [data-theme="dark"] .nav-timer-dot.break {
      background: #7dd3fc;
      box-shadow: 0 0 10px rgba(125, 211, 252, 0.9);
    }
    
    /* GLOBAL ICON SIZING SYSTEM */
    .header-btn svg,
    button svg:not(.task-check svg):not(.habit-check svg),
    .icon-block svg,
    .card-header svg { width: 16px; height: 16px; }
    
    /* Smaller icons */
    .task-check svg,
    .habit-check svg { width: 10px; height: 10px; }
    
    /* Tiny icons */
    .task-action-btn svg,
    .anchor-edit svg,
    .anchor-delete svg,
    .habit-delete svg { width: 12px; height: 12px; }
    
    /* Medium icons */
    .timer-btn svg { width: 18px; height: 18px; }
    
    /* CARDS - Apple-like card finish system */
    .card { 
      position: relative; 
      background: var(--card-bg); 
      border-radius: var(--card-radius);
      border: 1.5px solid var(--card-border);
      outline: 1.5px solid var(--card-stroke);
      outline-offset: -1px;
      overflow: hidden;
      box-shadow: inset 0 1px 0 var(--card-inset-highlight), var(--card-shadow);
      transition: transform 300ms cubic-bezier(0.25, 0.1, 0.25, 1), box-shadow 300ms cubic-bezier(0.25, 0.1, 0.25, 1), border-color 300ms ease, outline-color 300ms ease;
      will-change: transform, box-shadow;
      --card-hover-gradient: var(--card-hover-gradient-order);
    }
    [data-theme="dark"] .card {
      box-shadow: inset 0 1px 0 var(--card-inset-highlight), var(--card-shadow);
    }
    /* Hover gradient overlay */
    .card::after {
      content: "";
      position: absolute;
      inset: 0;
      background: var(--card-hover-gradient);
      opacity: 0;
      transition: opacity 300ms cubic-bezier(0.25, 0.1, 0.25, 1);
      pointer-events: none;
      z-index: 0;
      border-radius: inherit;
    }
    /* Micro-interactions: hover lift - applies to whole card including collapsed */
    .card:hover {
      transform: translateY(var(--hover-lift-y)) scale(1.008);
      box-shadow: inset 0 1px 0 var(--card-inset-highlight), var(--hover-shadow);
      border-color: var(--border-strong);
      outline-color: rgba(196, 112, 75, 0.12);
    }
    .card:hover::after {
      opacity: 1;
    }
    [data-theme="dark"] .card:hover {
      outline-color: rgba(212, 132, 106, 0.15);
    }
    /* Micro-interactions: press down */
    .card:active {
      transform: translateY(var(--press-y));
      box-shadow: inset 0 1px 0 var(--card-inset-highlight), var(--press-shadow);
    }
    /* Ensure card content sits above */
    .card > * {
      position: relative;
      z-index: 1;
    }
    /* Card content for body-only hover detection */
    .card-content { 
      position: relative;
      z-index: 1;
      padding: var(--card-content-pad-top) 24px 24px; /* Consistent top padding using design token */
    }
    /* Collapsed cards use same hover system - card:hover applies to all cards */
    .card.is-collapsed {
      --card-hover-gradient: var(--card-hover-gradient-order);
    }
    /* Collapsed cards still lift on hover (handled by .card:hover above) */
    .card.is-collapsed .card-header.is-collapsed:hover {
      background: linear-gradient(to bottom, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.03) 50%, transparent 100%);
    }
    [data-theme="dark"] .card.is-collapsed .card-header.is-collapsed:hover {
      background: linear-gradient(to bottom, rgba(255, 255, 255, 0.04) 0%, rgba(255, 255, 255, 0.02) 50%, transparent 100%);
    }
    .reduce-motion .card:hover,
    .reduce-motion .card:active { transform: none; }
    
    /* Card header dot texture - brand detail applied to ALL card headers */
    .card-header {
      position: relative;
      overflow: visible; /* Changed from hidden to prevent shadow clipping */
      border-radius: 0; /* Remove radius - parent card handles rounding via overflow:hidden */
    }
    /* Dot texture overlay on ALL card headers - CONSISTENT VISIBILITY */
    .card-header::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.38;
      background-image: radial-gradient(rgba(139, 92, 246, 0.45) 0.7px, transparent 0.8px);
      background-size: 6px 6px;
      background-position: 0 0;
      border-radius: inherit;
      /* Fade mask for subtle edge */
      -webkit-mask-image: linear-gradient(to bottom, black 75%, transparent 100%);
      mask-image: linear-gradient(to bottom, black 75%, transparent 100%);
      transition: opacity 0.15s ease-out;
    }
    [data-theme="dark"] .card-header::after {
      opacity: 0.30;
      background-image: radial-gradient(rgba(212, 132, 106, 0.25) 0.7px, transparent 0.8px);
    }
    /* Hover: dots become slightly more visible */
    .card:hover .card-header::after {
      opacity: 0.48;
    }
    [data-theme="dark"] .card:hover .card-header::after {
      opacity: 0.38;
    }
    /* Headers with has-dots class get slightly stronger texture */
    .card-header.has-dots::after {
      opacity: 0.45;
    }
    [data-theme="dark"] .card-header.has-dots::after {
      opacity: 0.35;
    }
    
    /* Focus rings for interactive elements */
    :where(button, [role="button"], input, select, textarea, .chip, .pill):focus-visible {
      outline: none;
      box-shadow:
        0 0 0 3px var(--focus-ring-soft),
        0 0 0 1px var(--focus-ring);
    }
    
    /* Button/chip micro-interactions */
    :where(button, [role="button"], .chip, .pill) {
      transition: transform 140ms ease, box-shadow 140ms ease, background 140ms ease, border-color 140ms ease;
    }
    :where(button, [role="button"], .chip, .pill):hover {
      transform: translateY(-1px);
    }
    :where(button, [role="button"], .chip, .pill):active {
      transform: translateY(0);
    }
    
    /* Zone-based card coloring - subtle tint only, let base color do the work */
    .mode-order .card { 
      background: var(--card-bg);
      transition: transform 300ms cubic-bezier(0.25, 0.1, 0.25, 1), box-shadow 300ms cubic-bezier(0.25, 0.1, 0.25, 1), border-color 300ms ease, outline-color 300ms ease;
    }
    .mode-order .card::after {
      transition: opacity 300ms cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    .mode-order .card.schedule-card { 
      border-color: var(--focus-border);
      background: var(--card-bg);
    }
    .mode-order .card.schedule-card:hover { 
      border-color: var(--focus);
    }
    .mode-order .card.primary-card { 
      border: 1px solid var(--border);
      background: var(--card-bg);
    }
    .mode-order .card.primary-card:hover { 
      border-color: var(--border-strong);
    }
    /* Neutralize primary-card special styling in Order mode */
    .mode-order .primary-card .card-header {
      background: var(--card-header-bg) !important;
      border-bottom-color: var(--border) !important;
    }
    .mode-order .primary-card .card-header:hover {
      background: var(--card-header-bg) !important;
    }
    .mode-order .primary-card .card-header h3 {
      font-size: var(--text-sm) !important;
      color: var(--text) !important;
    }
    .mode-order .primary-card .task-text {
      font-size: var(--text-sm) !important;
      font-weight: var(--weight-regular) !important;
    }
    .mode-order .primary-card .task-item {
      background: transparent !important;
      border-left: none !important;
      padding-left: 0 !important;
      margin-left: 0 !important;
      border-radius: 0 !important;
    }
    .mode-order .primary-card .card-header-icon,
    .mode-order .primary-card .card-icon {
      background: var(--terracotta) !important;
    }
    
    .mode-focus .card { 
      background: var(--card-bg);
      --card-hover-gradient: var(--card-hover-gradient-focus);
      transition: transform 300ms cubic-bezier(0.25, 0.1, 0.25, 1), box-shadow 300ms cubic-bezier(0.25, 0.1, 0.25, 1), border-color 300ms ease, outline-color 300ms ease;
    }
    .mode-focus .card::after {
      transition: opacity 300ms cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    .mode-focus .card.timer-card { 
      border-color: var(--focus-border);
      background: var(--card-bg);
    }
    .mode-focus .card.timer-card:hover {
      border-color: var(--focus);
    }
    .mode-focus .card.today-card { 
      border-color: var(--accent-border);
      background: var(--card-bg);
    }
    
    /* Rest mode cards - exclude scripture-card and bestill-card from background override 
       so their custom gradients remain visible */
    .mode-rest .card:not(.scripture-card):not(.bestill-card) { 
      background: var(--card-bg);
    }
    .mode-rest .card {
      --card-hover-gradient: var(--card-hover-gradient-rest);
      transition: transform 300ms cubic-bezier(0.25, 0.1, 0.25, 1), box-shadow 300ms cubic-bezier(0.25, 0.1, 0.25, 1), border-color 300ms ease, outline-color 300ms ease;
    }
    .mode-rest .card::after {
      transition: opacity 300ms cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    /* Ensure Rest cards hover properly - exclude custom gradient cards */
    .mode-rest .card:hover:not(.scripture-card):not(.bestill-card) {
      transform: translateY(var(--hover-lift-y)) scale(1.008);
      box-shadow: inset 0 1px 0 var(--card-inset-highlight), var(--hover-shadow);
    }
    /* Safety override: custom cards keep their own shadow styling on hover */
    .mode-rest .scripture-card:hover {
      box-shadow: inherit;
    }
    .mode-rest .bestill-card:hover {
      transform: translateY(var(--hover-lift-y)) scale(1.008);
      box-shadow: 
        inset 0 1px 0 rgba(255,255,255,0.90),
        0 18px 48px rgba(15,23,42,0.14), 
        0 6px 18px rgba(15,23,42,0.08);
    }
    .mode-rest .card.reflection-card { 
      border-color: var(--rest-border);
    }
    
    /* Habits card - clean base */
    .habits-card {
      background: var(--card-bg);
    }
    .habits-card:hover {
      box-shadow: var(--shadow-md);
    }
    
    /* DARK MODE - Complete surface system override */
    [data-theme="dark"] .card {
      background: var(--card-bg);
      border-color: rgba(255, 255, 255, 0.08);
    }
    [data-theme="dark"] .card:hover {
      border-color: rgba(255, 255, 255, 0.12);
    }
    [data-theme="dark"] .card-header {
      border-bottom-color: rgba(255, 255, 255, 0.06);
    }
    [data-theme="dark"] .card-header:hover {
      background: rgba(255, 255, 255, 0.04);
    }
    /* Dark mode pastel headers - muted versions */
    [data-theme="dark"] .primary-card .card-header {
      background: var(--pastel-lavender);
    }
    [data-theme="dark"] .primary-card .card-header:hover {
      background: var(--pastel-lavender-deep);
    }
    [data-theme="dark"] .schedule-card .card-header {
      background: var(--pastel-sky);
    }
    [data-theme="dark"] .schedule-card .card-header:hover {
      background: var(--pastel-sky-deep);
    }
    [data-theme="dark"] .today-card .card-header {
      background: var(--plum-bg);
      border-bottom-color: var(--plum-border);
    }
    [data-theme="dark"] .today-card .card-header:hover {
      background: var(--plum-bg);
    }
    [data-theme="dark"] .timer-card .card-header {
      background: var(--pastel-sky);
    }
    [data-theme="dark"] .timer-card .card-header:hover {
      background: var(--pastel-sky-deep);
    }
    [data-theme="dark"] .habits-card .card-header {
      background: var(--pastel-mint);
    }
    [data-theme="dark"] .habits-card .card-header:hover {
      background: var(--pastel-mint-deep);
    }
    [data-theme="dark"] .reflection-card .card-header {
      background: var(--pastel-mint);
    }
    [data-theme="dark"] .reflection-card .card-header:hover {
      background: var(--pastel-mint-deep);
    }
    /* Dark mode bestill-card header - base style only, hover handled via ::after overlay */
    [data-theme="dark"] .bestill-card .card-header {
      background: var(--pastel-lavender);
    }
    /* Dark mode habits add button - lighter for visibility */
    [data-theme="dark"] .habits-add-btn {
      background: var(--sage-soft);
      color: var(--sage-deep);
      box-shadow: 0 2px 6px rgba(122, 154, 126, 0.3);
    }
    [data-theme="dark"] .habits-add-btn:hover {
      background: var(--sage);
      box-shadow: 0 3px 10px rgba(122, 154, 126, 0.4);
    }
    
    .card-header { 
      padding: 16px 24px; 
      border-bottom: 1px solid var(--border); 
      display: flex; justify-content: space-between; align-items: center; 
      cursor: pointer; user-select: none; 
      transition: background 0.2s ease-out;
      position: relative;
      min-height: 44px;
      overflow: visible; /* Prevent shadow clipping on hover */
    }
    
    /* Header highlight backgrounds - gradient highlights instead of top bands */
    .card-header.highlight-terracotta,
    .task-card-header.highlight-terracotta {
      background: linear-gradient(135deg, rgba(196, 112, 75, 0.08) 0%, rgba(196, 112, 75, 0.03) 100%);
    }
    
    .card-header.highlight-sage,
    .task-card-header.highlight-sage {
      background: linear-gradient(135deg, rgba(122, 154, 126, 0.08) 0%, rgba(122, 154, 126, 0.03) 100%);
    }
    
    .card-header.highlight-ochre,
    .task-card-header.highlight-ochre {
      background: linear-gradient(135deg, rgba(201, 162, 39, 0.08) 0%, rgba(201, 162, 39, 0.03) 100%);
    }
    
    .card-header.highlight-plum,
    .task-card-header.highlight-plum {
      background: linear-gradient(135deg, rgba(107, 74, 107, 0.08) 0%, rgba(107, 74, 107, 0.03) 100%);
    }
    
    /* Dark mode header highlights - slightly stronger opacity */
    [data-theme="dark"] .card-header.highlight-terracotta,
    [data-theme="dark"] .task-card-header.highlight-terracotta {
      background: linear-gradient(135deg, rgba(196, 112, 75, 0.12) 0%, rgba(196, 112, 75, 0.04) 100%);
    }
    
    [data-theme="dark"] .card-header.highlight-sage,
    [data-theme="dark"] .task-card-header.highlight-sage {
      background: linear-gradient(135deg, rgba(122, 154, 126, 0.12) 0%, rgba(122, 154, 126, 0.04) 100%);
    }
    
    [data-theme="dark"] .card-header.highlight-ochre,
    [data-theme="dark"] .task-card-header.highlight-ochre {
      background: linear-gradient(135deg, rgba(201, 162, 39, 0.12) 0%, rgba(201, 162, 39, 0.04) 100%);
    }
    
    [data-theme="dark"] .card-header.highlight-plum,
    [data-theme="dark"] .task-card-header.highlight-plum {
      background: linear-gradient(135deg, rgba(107, 74, 107, 0.15) 0%, rgba(107, 74, 107, 0.05) 100%);
    }
    .card-header:hover { background: var(--toggle-bg); }
    .card-header h3 {  font-size: var(--text-sm); font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 7px; }
    
    /* Collapsed card headers - Apple-style compact panels */
    .card.is-collapsed .card-header.is-collapsed,
    .card-header.is-collapsed {
      padding: var(--space-3) var(--space-4);
      min-height: 56px;
      background: linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 0%, transparent 100%);
      border-bottom: 1px solid var(--border-strong);
    }
    [data-theme="dark"] .card.is-collapsed .card-header.is-collapsed,
    [data-theme="dark"] .card-header.is-collapsed {
      background: linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 0%, transparent 100%);
    }
    .card.is-collapsed .card-header.is-collapsed h3 svg,
    .card-header.is-collapsed h3 svg {
      width: 14px;
      height: 14px;
    }
    .card.is-collapsed .card-header.is-collapsed .task-count,
    .card-header.is-collapsed .task-count {
      font-size: 10px;
      padding: 3px 8px;
      background: var(--toggle-bg);
      border: 1px solid var(--border);
      border-radius: 999px;
      opacity: 0.8;
      font-weight: 500;
    }
    .card.is-collapsed .card-header.is-collapsed .collapse-icon,
    .card-header.is-collapsed .collapse-icon {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card.is-collapsed .card-header.is-collapsed .collapse-icon svg,
    .card-header.is-collapsed .collapse-icon svg {
      width: 14px;
      height: 14px;
    }
    .card-header.purple svg { color: var(--accent); }
    .card-header.blue svg { color: var(--focus); }
    .card-header.green svg { color: var(--rest); }
    .card-header.warm svg { color: var(--warm); }
    .card-header.gold svg { color: var(--warm); }
    .card-header-sub {  font-size: var(--text-xs); color: var(--text-muted); font-weight: 400; margin-left: var(--space-2); }
    
    /* HELP ICON BUTTON */
    .help-icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      min-width: 30px;
      min-height: 30px;
      margin-left: 10px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: var(--radius-sm);
      padding: 0;
      transition: all 0.15s ease-out;
      flex-shrink: 0;
    }
    .help-icon-btn svg {
      width: 13px;
      height: 13px;
    }
    .help-icon-btn:hover,
    .help-icon-btn:focus {
      color: var(--text);
      background: var(--toggle-bg);
      outline: none;
    }
    .help-icon-btn:active {
      transform: scale(0.95);
    }
    /* Help icons on dark backgrounds (timer, bestill) */
    .timer-card .icon-btn,
    .apple-timer-container .icon-btn,
    .apple-timer-header .icon-btn,
    .bestill-card .icon-btn {
      color: rgba(255, 255, 255, 0.7);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    .timer-card .icon-btn:hover,
    .apple-timer-container .icon-btn:hover,
    .apple-timer-header .icon-btn:hover,
    .bestill-card .icon-btn:hover {
      color: rgba(255, 255, 255, 0.95);
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.25);
    }
    .timer-card .icon-btn svg,
    .apple-timer-header .icon-btn svg {
      width: 16px;
      height: 16px;
    }
    /* Legacy support */
    .timer-card .help-icon-btn,
    .apple-timer-container .help-icon-btn {
      color: rgba(255, 255, 255, 0.7) !important;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    .timer-card .help-icon-btn:hover,
    .apple-timer-container .help-icon-btn:hover {
      color: rgba(255, 255, 255, 0.95) !important;
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.25);
    }
    
    /* FEATURE POPOVER */
    .feature-popover {
      position: fixed;
      z-index: 1000;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      padding: var(--space-3) var(--space-4);
      max-width: 280px;
      font-size: var(--text-sm);
      line-height: var(--leading-normal);
      color: var(--text);
      opacity: 0;
      transform: translateY(-4px);
      pointer-events: none;
      transition: opacity 0.1s ease-out, transform 0.1s ease-out;
    }
    .feature-popover.open {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
      transition: opacity 0.12s ease-out, transform 0.12s ease-out;
    }
    .feature-popover[aria-hidden="true"] {
      opacity: 0;
      transform: translateY(-4px);
      pointer-events: none;
      transition: opacity 0.08s ease-out, transform 0.08s ease-out;
    }
    
    /* Reduced motion support for popover */
    @media (prefers-reduced-motion: reduce) {
      .feature-popover,
      .feature-popover.open,
      .feature-popover[aria-hidden="true"] {
        transition: opacity 0.1s ease-out;
        transform: none;
      }
    }
    .reduce-motion .feature-popover,
    .reduce-motion .feature-popover.open,
    .reduce-motion .feature-popover[aria-hidden="true"] {
      transition: opacity 0.1s ease-out;
      transform: none;
    }
    
    /* PASTEL ICON BLOCKS - Solid color accents for hierarchy */
    .icon-block {
      width: 28px; height: 28px;
      border-radius: 7px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .icon-block.lavender { background: var(--pastel-lavender); }
    .icon-block.lavender svg { color: var(--accent); }
    .icon-block.sky { background: var(--pastel-sky); }
    .icon-block.sky svg { color: var(--focus); }
    .icon-block.mint { background: var(--pastel-mint); }
    .icon-block.mint svg { color: var(--rest); }
    .icon-block.butter { background: var(--pastel-butter); }
    .icon-block.butter svg { color: var(--warm); }
    
    /* Pastel accent strips on cards */
    .card.accent-strip-left { border-left: 3px solid var(--pastel-lavender-deep); }
    .card.accent-strip-left.sky { border-left-color: var(--pastel-sky-deep); }
    .card.accent-strip-left.mint { border-left-color: var(--pastel-mint-deep); }
    .card.accent-strip-left.butter { border-left-color: var(--pastel-butter-deep); }
    
    .card-content { 
      padding: var(--space-5) 24px 24px; /* Increased top and bottom padding */
    }
    
    /* Task card content - add top padding */
    .task-card-content {
      padding: var(--card-content-pad-top) 24px 20px; /* Consistent top padding using design token */
    }
    
    /* Primary task indicator - positioned above task text, nearly left-justified */
    .task-primary-label {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 4px; /* Position above task text */
      margin-left: 0; /* Nearly left-justified with task text column */
      color: var(--terracotta);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 4px;  /* Space between label and task name */
    }
    
    .task-primary-label::before {
      content: '';
      font-size: 10px;
    }
    
    /* Smooth expand/collapse animations for card drawers - no snapping */
    .card-drawer {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      pointer-events: none;
      transition: max-height 280ms ease, opacity 200ms ease, transform 240ms ease;
      transform: translateY(-6px);
    }
    .card-drawer.expanded {
      max-height: 900px;
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }
    @media (prefers-reduced-motion: reduce) {
      .card-drawer {
        transition: none;
        max-height: none !important;
        opacity: 1 !important;
        transform: none !important;
        pointer-events: auto !important;
      }
    }
    
    /* Reusable collapsible wrapper pattern */
    .collapseWrap {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      pointer-events: none;
      transition: max-height 280ms ease, opacity 200ms ease, transform 240ms ease;
      transform: translateY(-6px);
    }
    .collapseWrap.expanded {
      max-height: 900px;
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }
    .collapseInner {
      padding: var(--space-4);
    }
    @media (prefers-reduced-motion: reduce) {
      .collapseWrap {
        transition: none;
        max-height: none !important;
        opacity: 1 !important;
        transform: none !important;
        pointer-events: auto !important;
      }
    }
    .collapse-icon { opacity: 0.5; }
    .collapse-icon.collapsed { transform: rotate(-90deg); }
    
    /* LAYOUTS - All aligned to content-max-width */
    
    /* ORDER LAYOUT - 3 columns, center-aligned */
    .order-layout { 
      display: grid; 
      grid-template-columns: 1fr minmax(320px, 1.2fr) 1fr; 
      gap: var(--space-6); 
      align-items: start;
    }
    
    /* FOCUS LAYOUT - Equal 50/50 columns, full width aligned to nav */
    .focus-layout { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: var(--space-6); 
      align-items: start;
    }
    
    /* REST LAYOUT - 3 columns on desktop: Scripture | Be Still | Prayer+Reflection */
    .rest-layout { 
      display: grid; 
      grid-template-columns: repeat(3, 1fr); 
      gap: var(--space-5); 
      align-items: start;
    }
    .rest-layout > .column {
      display: flex;
      flex-direction: column;
      gap: var(--space-5);
    }
    /* Each card in Rest should stretch to fill available space */
    .rest-layout .scripture-card,
    .rest-layout .bestill-card,
    .rest-layout .reflection-card,
    .rest-layout .prayer-gratitude-card {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .column { display: flex; flex-direction: column; gap: var(--space-4); }
    
    /* Card Header Colors - From Design System Step 5 */
    /* Terracotta header - Primary tasks, Order mode */
    .card-header-terracotta,
    .card-header[data-color="terracotta"],
    .primary-card .card-header {
      background: linear-gradient(135deg, rgba(196, 112, 75, 0.08) 0%, rgba(196, 112, 75, 0.03) 100%);
      border-bottom-color: var(--terracotta-border);
      border-radius: 0;
    }
    [data-theme="dark"] .primary-card .card-header {
      background: linear-gradient(135deg, rgba(196, 112, 75, 0.12) 0%, rgba(196, 112, 75, 0.04) 100%);
    }
    .primary-card .card-header:hover { background: var(--terracotta-bg); }
    .primary-card .card-header h3 { font-size: var(--text-base); color: var(--accent); }
    .primary-card .task-text { font-size: var(--text-base); font-weight: 500; }
    /* Soft highlight treatment for primary tasks */
    .primary-card .task-item {
      background: var(--terracotta-bg);
      border-left: 2px solid var(--terracotta);
      padding-left: var(--space-3);
      margin-left: calc(-1 * var(--space-3));
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    }
    /* Subtle completion pulse for primary tasks */
    @keyframes completionPulse {
      0% { box-shadow: var(--card-shadow); }
      50% { box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2), var(--card-shadow); }
      100% { box-shadow: var(--card-shadow); }
    }
    .primary-card.just-completed {
      animation: completionPulse 0.8s ease-out;
    }
    
    /* Schedule card - with pastel accent */
    /* Schedule Card */
    .schedule-card {
      background: var(--surface-white);
      border-radius: var(--card-radius);
      overflow: hidden;
    }
    .schedule-card .card-header {
      background: transparent;
      border-bottom: 1px solid var(--border-subtle);
      padding: 16px 24px;
    }
    
    /* Custom styled select for Schedule card */
    .schedule-card .custom-select,
    .custom-select {
      padding: 6px 28px 6px 12px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      background: var(--surface-white);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-sm);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238A8078' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
      cursor: pointer;
    }
    
    .schedule-card .custom-select:focus {
      outline: none;
      border-color: var(--sage);
    }
    
    [data-theme="dark"] .schedule-card .custom-select {
      background: #1A1816;
      border-color: rgba(255, 255, 255, 0.12);
      color: #FAF8F5;
    }
    
    /* Navigation Bar */
    .nav-bar {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 12px 16px;
      background: var(--surface-white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-md);
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 12px 24px;
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      color: var(--text-tertiary);
    }
    
    .nav-item:hover {
      background: var(--bg-secondary);
      color: var(--text-secondary);
    }
    
    /* Active states - each tab has its own color */
    .nav-item.active.order {
      background: var(--terracotta-bg);
      color: var(--terracotta);
    }
    
    .nav-item.active.focus {
      background: rgba(107, 74, 107, 0.08);
      color: var(--plum);
    }
    
    .nav-item.active.rest {
      background: var(--sage-bg);
      color: var(--sage);
    }
    
    .nav-icon {
      width: 24px;
      height: 24px;
    }
    
    .nav-label {
      font-size: 12px;
      font-weight: 500;
    }
    
    /* Dark mode nav */
    [data-theme="dark"] .nav-bar {
      background: #252320;
    }
    
    [data-theme="dark"] .nav-bar .nav-item {
      color: #7A7268;
    }
    
    [data-theme="dark"] .nav-bar .nav-item:hover {
      background: rgba(255, 255, 255, 0.05);
      color: #B0A89E;
    }
    
    [data-theme="dark"] .nav-bar .nav-item.active.order {
      background: rgba(196, 112, 75, 0.15);
      color: var(--terracotta-soft);
    }
    
    [data-theme="dark"] .nav-bar .nav-item.active.focus {
      background: rgba(107, 74, 107, 0.15);
      color: var(--plum-soft);
    }
    
    [data-theme="dark"] .nav-bar .nav-item.active.rest {
      background: rgba(122, 154, 126, 0.15);
      color: var(--sage-soft);
    }
    .schedule-card .card-header h3 {
      font-family: var(--font-body);
      font-size: var(--text-base);
      font-weight: 600;
      color: var(--text-primary);
    }
    /* Schedule grid lines */
    .schedule-hour {
      border-bottom: 1px solid var(--border-subtle);
    }
    .schedule-hour-label {
      font-size: 12px;
      color: var(--text-tertiary);
      font-weight: 500;
    }
    /* Schedule blocks from Design System Step 11 */
    .schedule-event,
    .schedule-block {
      padding: var(--space-2) var(--space-3);
      border-radius: var(--radius-sm);
      font-size: var(--text-sm);
      font-weight: var(--weight-medium);
      color: var(--text-inverse); /* white */
    }
    .schedule-block-terracotta,
    .schedule-event[data-color="terracotta"] { background: var(--terracotta); }
    .schedule-block-sage,
    .schedule-event[data-color="sage"] { background: var(--sage); }
    .schedule-block-ochre,
    .schedule-event[data-color="ochre"] { background: var(--ochre); }
    .schedule-block-plum,
    .schedule-event[data-color="plum"] { background: var(--plum); }
    .schedule-block-clay,
    .schedule-event[data-color="clay"] { background: var(--clay); }
    /* Legacy support */
    .schedule-event.cat-deep-work,
    .schedule-event[style*="terracotta"],
    .event-block[style*="terracotta"] {
      background: var(--terracotta);
    }
    .schedule-event.cat-meeting,
    .schedule-event[style*="sage"],
    .event-block[style*="sage"] {
      background: var(--sage);
    }
    .schedule-event.cat-focus,
    .schedule-event[style*="plum"],
    .event-block[style*="plum"] {
      background: var(--plum);
    }
    .schedule-event.cat-admin,
    .schedule-event[style*="ochre"],
    .event-block[style*="ochre"] {
      background: var(--ochre);
    }
    /* Current time indicator */
    .schedule-now-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--terracotta);
      z-index: 10;
    }
    .schedule-now-dot {
      position: absolute;
      left: -4px;
      top: -3px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--terracotta);
    }
    
    /* Today card - hero in Focus */
    .today-card { min-height: 320px; display: flex; flex-direction: column; }
    /* Plum header - Focus mode, timer */
    .card-header-plum,
    .card-header[data-color="plum"],
    .today-card .card-header {
      background: linear-gradient(135deg, rgba(107, 74, 107, 0.08) 0%, rgba(107, 74, 107, 0.03) 100%);
      border-bottom-color: var(--plum-border);
      border-radius: 0;
    }
    [data-theme="dark"] .today-card .card-header {
      background: linear-gradient(135deg, rgba(107, 74, 107, 0.15) 0%, rgba(107, 74, 107, 0.05) 100%);
    }
    .today-card .card-header:hover { background: var(--plum-bg); }
    .today-card .card-header h3 { color: var(--accent); font-size: var(--text-base); }
    .today-card .card-content { flex: 1; display: flex; flex-direction: column; }
    .today-card.drag-over { box-shadow: 0 0 0 2px var(--focus), var(--card-shadow); }
    /* Focus view drop indicator */
    .focus-drop-indicator {
      padding: var(--space-3);
      margin: var(--space-2) 0;
      background: var(--focus-hover);
      border: 2px dashed var(--focus);
      border-radius: var(--radius-md);
      text-align: center;
      font-size: var(--text-sm);
      color: var(--focus);
      font-weight: 500;
    }
    
    /* TIMER - Blue zone, task linkage UI with premium styling */
    .timer-card { 
      position: relative; 
      overflow: visible;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.55), var(--card-shadow);
      border: 1px solid var(--focus-border);
    }
    [data-theme="dark"] .timer-card {
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.10), var(--card-shadow);
    }
    .timer-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.04) 0%, rgba(96, 165, 250, 0.02) 50%, transparent 100%);
      pointer-events: none;
      z-index: 0;
      border-radius: var(--radius-xl);
    }
    [data-theme="dark"] .timer-card::before {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.06) 0%, rgba(96, 165, 250, 0.03) 50%, transparent 100%);
    }
    .timer-card > * {
      position: relative;
      z-index: 1;
    }
    .timer-card .card-header { 
      background: linear-gradient(135deg, var(--pastel-sky) 0%, rgba(227, 241, 250, 0.8) 100%);
      border-radius: 0;
      border-bottom: 1px solid var(--focus-border);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    [data-theme="dark"] .timer-card .card-header {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(59, 130, 246, 0.08) 100%);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    .timer-card .card-header:hover { 
      background: linear-gradient(135deg, var(--pastel-sky-deep) 0%, var(--pastel-sky) 100%);
    }
    [data-theme="dark"] .timer-card .card-header:hover {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.12) 100%);
    }
    .timer-display,
    .focus-time {
      font-family: var(--font-display);
      font-weight: 400;
      letter-spacing: -0.02em;
      text-align: center; 
      padding: var(--space-6) 0 var(--space-5); 
      position: relative;
    }
    .timer-display::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 1px;
      background: linear-gradient(to right, transparent, var(--border), transparent);
    }
    .timer-time { 
      font-size: var(--text-timer); 
      font-weight: 400; 
      color: #1e40af; 
      font-variant-numeric: tabular-nums; 
      letter-spacing: -0.02em; 
      line-height: 1;
      transition: color 0.3s ease-out;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      display: block;
      margin: 0 auto;
      font-family: var(--font-display);
    }
    [data-theme="dark"] .timer-time {
      color: #60a5fa;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }
    .timer-time.running { color: var(--focus); }
    .timer-time.complete {
      animation: timerComplete 0.6s ease-out;
    }
    @keyframes timerComplete {
      0%, 100% { transform: scale(1); }
      25% { transform: scale(1.05); color: var(--rest); }
      50% { transform: scale(1.02); }
    }
    .timer-complete-message {
      text-align: center;
      padding: 12px;
      background: var(--rest-light);
      border: 1px solid var(--rest-border);
      border-radius: var(--radius-md);
      margin: 8px 12px;
      color: var(--rest);
      font-size: 13px;
      font-weight: 500;
      animation: fadeInUp 0.3s ease-out;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .timer-label { 
      font-size: 11px; 
      color: var(--text-muted); 
      text-transform: uppercase; 
      letter-spacing: 0.1em; 
      margin-bottom: 12px; 
    }
    .timer-presets { 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      gap: 8px; 
      margin: 20px 0 16px; 
      padding: 0 12px; 
      flex-wrap: wrap; 
    }
    .preset-btn { 
      padding: 6px 14px; border: 1px solid var(--border-strong); 
      background: transparent; color: var(--text-muted); 
      font-size: 11px; font-weight: 500; border-radius: var(--radius-full);
      transition: all 0.15s ease-out; 
      cursor: pointer; transition: all 0.2s ease-out; 
      height: 26px;
    }
    .preset-btn:hover { border-color: var(--focus-border); color: var(--focus-soft); background: var(--focus-hover); }
    .preset-btn.active { 
      background: var(--focus-hover); 
      border-color: var(--focus); 
      color: var(--focus); 
      font-weight: 500;
      box-shadow: 0 0 0 1px var(--focus-border), 0 2px 4px rgba(59, 130, 246, 0.15);
    }
    [data-theme="dark"] .preset-btn.active {
      box-shadow: 0 0 0 1px rgba(96, 165, 250, 0.4), 0 2px 6px rgba(96, 165, 250, 0.2);
    }
    .timer-custom-wrapper {
      display: inline-flex;
      align-items: center;
      height: 26px;
    }
    .timer-custom-input {
      padding: 5px 10px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-light);
      font-size: 11px;
      font-weight: 500;
      border-radius: 6px;
      width: 70px;
      height: 26px;
      transition: all 0.2s ease-out;
      text-align: center;
    }
    .timer-custom-input:focus {
      outline: none;
      border-color: var(--focus-border);
      color: var(--focus);
      background: var(--focus-hover);
    }
    .timer-custom-input::placeholder {
      color: var(--text-light);
    }
    
    /* Task selector dropdown - CRITICAL FIX */
    .timer-task-selector,
    .task-selector,
    .timer-link select {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      padding: 12px 16px;
      color: white;  /* Text must be WHITE on plum background */
      font-size: 14px;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      display: block;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }
    
    .timer-task-selector option,
    .task-selector option {
      background: #4D334D;
      color: white;
    }
    
    /* Task link selector - centered, visible, on-brand */
    .timer-link { 
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 12px 20px 16px;
      margin: 0 auto;
      max-width: 280px;
    }
    /* Don't hide when task is linked - allow changing */
    .timer-link svg {
      display: none; /* Hide the link icon */
    }
    .timer-link-label {
      display: none; /* Hide the label */
    }
    /* CustomSelect styling inside timer */
    .timer-link .custom-select {
      width: 100%;
    }
    .timer-link .custom-select-trigger {
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.8);
      padding: 10px 14px;
      border-radius: var(--radius-md);
      font-size: 13px;
      justify-content: center;
      min-width: 200px;
    }
    .timer-link .custom-select-trigger:hover {
      background: rgba(255, 255, 255, 0.18);
      border-color: rgba(255, 255, 255, 0.3);
    }
    .timer-link .custom-select-trigger svg {
      display: block;
      color: rgba(255, 255, 255, 0.6);
    }
    .timer-link .custom-select-menu {
      background: var(--plum-deep);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .timer-link .custom-select-option {
      color: white;
    }
    .timer-link .custom-select-option:hover {
      background: rgba(255, 255, 255, 0.15);
    }
    
    /* Custom Select Component */
    .custom-select { position: relative; display: inline-block; }
    .custom-select-trigger {
      display: flex; align-items: center; gap: 6px; padding: 6px 10px;
      background: var(--toggle-bg); border: 1px solid var(--border-strong);
      border-radius: 6px; font-size: 11px; color: var(--text);
      cursor: pointer; transition: all 0.15s ease-out; min-width: 100px;
    }
    .custom-select-trigger:hover { background: var(--card-bg-hover); }
    .custom-select-trigger.open { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-hover); }
    .custom-select-trigger svg { width: 12px; height: 12px; color: var(--text-muted); transition: transform 0.2s ease-out; flex-shrink: 0; }
    .custom-select-trigger.open svg { transform: rotate(180deg); }
    .custom-select-value { flex: 1; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .custom-select-menu {
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 8px; box-shadow: var(--shadow-lg); padding: 4px;
      opacity: 0; transform: translateY(-8px); pointer-events: none; 
      transition: opacity 0.15s ease-out, transform 0.15s ease-out;
      max-height: 220px; overflow-y: auto;
      padding-bottom: calc(4px + env(safe-area-inset-bottom, 0px));
    }
    .custom-select-menu.show { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .custom-select-menu.flip-up { transform: translateY(8px); }
    .custom-select-menu.flip-up.show { transform: translateY(0); }
    .custom-select-option {
      padding: 8px 10px; font-size: 12px; color: var(--text); border-radius: 6px;
      cursor: pointer; transition: background 0.1s ease-out;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .custom-select-option:hover { background: var(--toggle-bg); }
    .custom-select-option.selected { background: var(--accent-hover); color: var(--accent); }
    
    .timer-controls { display: flex; justify-content: center; gap: 10px; padding-bottom: 12px; }
    .timer-btn { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      gap: 6px; 
      padding: 12px 28px; 
      border: 1px solid var(--border-strong); 
      background: transparent; 
      color: var(--text); 
      font-size: 14px; 
      font-weight: 500; 
      border-radius: var(--radius-full); 
      cursor: pointer; 
      transition: all 0.15s ease-out;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
    }
    .timer-btn:hover { 
      border-color: var(--focus); 
      color: var(--focus); 
      background: var(--focus-hover);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      transform: translateY(-1px);
    }
    .timer-btn.primary { 
      background: var(--focus); 
      border-color: var(--focus); 
      color: #fff;
      box-shadow: 0 2px 4px rgba(59, 130, 246, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    .timer-btn.primary:hover { 
      background: #2563eb;
      box-shadow: 0 3px 6px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }
    [data-theme="dark"] .timer-btn.primary {
      box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    [data-theme="dark"] .timer-btn.primary:hover {
      box-shadow: 0 3px 8px rgba(59, 130, 246, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }
    .timer-btn svg { width: 18px; height: 18px; }
    
    /* APPLE-STYLE TIMER - Unified with card system */
    .apple-timer-container {
      position: relative;
      overflow: hidden;
      border-radius: var(--card-radius);
      border: none;
      outline: none;
      background: linear-gradient(145deg, var(--plum) 0%, var(--plum-deep) 100%);
      box-shadow: var(--shadow-lg);
      transition: transform 300ms cubic-bezier(0.25, 0.1, 0.25, 1), box-shadow 300ms cubic-bezier(0.25, 0.1, 0.25, 1);
      /* Ensure settings overlay clips to card bounds */
      isolation: isolate;
      color: white;
    }
    .apple-timer-container.settings-open {
      overflow: hidden; /* Keep overflow hidden to maintain corner clipping */
    }
    .apple-timer-container:hover {
      transform: translateY(var(--hover-lift-y)) scale(1.008);
      box-shadow: var(--shadow-xl);
    }
    /* Subtle internal glow for focus zone feel - plum gradient */
    .apple-timer-glow {
      pointer-events: none;
      position: absolute;
      inset: 0;
      background: linear-gradient(145deg, var(--plum) 0%, var(--plum-deep) 100%);
      opacity: 1;
      transition: opacity var(--motion);
      z-index: 0;
    }
    .apple-timer-container:hover .apple-timer-glow {
      opacity: 1;
      background: linear-gradient(145deg, var(--plum) 0%, var(--plum-deep) 100%);
    }
    [data-theme="dark"] .apple-timer-glow {
      background: linear-gradient(145deg, var(--plum) 0%, var(--plum-deep) 100%);
    }
    [data-theme="dark"] .apple-timer-container:hover .apple-timer-glow {
      background: linear-gradient(145deg, var(--plum) 0%, var(--plum-deep) 100%);
    }
    /* Timer header - REMOVED band, now uses floating icons */
    .apple-timer-header {
      display: none; /* Hide the header band entirely */
    }
    /* Floating timer controls in top-right */
    .apple-timer-floating-controls {
      position: absolute;
      top: 16px;
      right: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 20;
    }
    .apple-timer-header::after {
      display: none;
    }
    [data-theme="dark"] .apple-timer-header {
      display: none;
    }
    .apple-timer-title {
      font-size: var(--text-base);
      font-weight: 600;
      letter-spacing: var(--tracking-tight);
      color: white;
    }
    .apple-timer-subtitle {
      margin-top: 2px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.7);
    }
    .apple-timer-modes {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0;
      padding: 6px;
      position: relative;
      z-index: 10;
      background: rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md);
      width: fit-content;
      margin: 32px auto 0; /* Increased top margin since no header band */
    }
    .apple-timer-mode-btn {
      padding: 12px 22px;
      font-size: 14px;
      font-weight: 500;
      border-radius: var(--radius-sm);
      border: none;
      background: transparent;
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      transition: all 0.15s ease;
      position: relative;
      white-space: nowrap;
    }
    .apple-timer-mode-btn:hover {
      color: rgba(255, 255, 255, 0.9);
    }
    .apple-timer-mode-btn.active {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      font-weight: 600;
      border-radius: var(--radius-sm);
    }
    .apple-timer-mode-btn:disabled {
      cursor: default;
    }
    [data-theme="dark"] .apple-timer-mode-btn.active {
      background: rgba(255, 255, 255, 0.2);
    }
    .apple-timer-settings-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.1);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.15s ease-out;
      box-shadow: none;
    }
    .apple-timer-settings-btn svg path,
    .apple-timer-settings-btn svg circle {
      stroke: rgba(255, 255, 255, 0.7);
    }
    .apple-timer-settings-btn:hover {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
    }
    .apple-timer-settings-btn:hover svg path,
    .apple-timer-settings-btn:hover svg circle {
      stroke: white;
    }
    .apple-timer-settings-btn.active {
      border-color: rgba(255, 255, 255, 0.4);
      background: rgba(255, 255, 255, 0.2);
    }
    .apple-timer-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px 0 16px;
      position: relative;
    }
    .apple-timer-ring {
      position: relative;
      width: min(280px, 55vw);
      aspect-ratio: 1;
      filter: drop-shadow(0 8px 24px rgba(107, 74, 107, 0.25));
      display: flex;
      align-items: center;
      justify-content: center;
    }
    [data-theme="dark"] .apple-timer-ring {
      filter: drop-shadow(0 10px 24px rgba(0, 0, 0, 0.5));
    }
    .apple-timer-ring svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: visible;
    }
    .apple-timer-ring .timer-ring-track {
      stroke: rgba(255, 255, 255, 0.2);
    }
    [data-theme="dark"] .apple-timer-ring .timer-ring-track {
      stroke: rgba(255, 255, 255, 0.15);
    }
    /* Timer ring pulse when running */
    @keyframes timerRingPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.85; }
    }
    .apple-timer-ring.running .timer-ring-track {
      animation: timerRingPulse 2s ease-in-out infinite;
    }
    /* Timer time - positioned INSIDE the ring */
    .apple-timer-time {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .apple-timer-time-text {
      font-family: var(--font-display);
      font-size: 64px;
      font-weight: 400;
      letter-spacing: -0.02em;
      font-variant-numeric: tabular-nums;
      line-height: 1;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
    }
    [data-theme="dark"] .apple-timer-time-text {
      color: white;
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    }
    /* Status label below time, inside the ring */
    .apple-timer-status {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 8px;
      font-weight: 400;
    }
    .apple-timer-label {
      display: none; /* Hide old label - status is now inside ring */
    }
    .apple-timer-label-dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
    }
    .apple-timer-cycle {
      font-size: var(--text-xs);
      color: rgba(255, 255, 255, 0.5);
      text-align: center;
      padding-bottom: 8px;
    }
    .apple-timer-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      padding: 12px 24px 16px;
      position: relative;
      z-index: 10;
    }
    .apple-timer-btn {
      padding: 12px 28px;
      border-radius: var(--radius-md);
      font-size: var(--text-base);
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      z-index: 10;
    }
    .apple-timer-btn-primary {
      background: white !important;
      color: var(--plum) !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
    .apple-timer-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
    }
    .apple-timer-btn-secondary {
      background: rgba(255, 255, 255, 0.2) !important;
      color: white !important;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .apple-timer-btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3) !important;
    }
    .apple-timer-btn-skip {
      background: rgba(255, 255, 255, 0.15) !important;
      color: white !important;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .apple-timer-btn-skip:hover {
      background: rgba(255, 255, 255, 0.25) !important;
    }
    /* Currently Working On indicator - PROMINENT like mockup */
    .timer-task,
    .timer-linked-task {
      background: rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 14px;
      margin: 0 auto;
      max-width: 380px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .timer-task-icon,
    .timer-linked-task-icon {
      width: 40px;
      height: 40px;
      background: #C4704B;  /* Terracotta */
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .timer-task-label,
    .timer-linked-task-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: rgba(255, 255, 255, 0.55);
      margin-bottom: 4px;
      font-weight: 600;
    }
    
    .timer-task-name,
    .timer-linked-task-name {
      font-size: 15px;
      font-weight: 600;
      color: white;
    }
    .timer-linked-task-icon svg {
      width: 20px;
      height: 20px;
      color: white;
      fill: white;
    }
    .timer-linked-task-content {
      flex: 1;
      min-width: 0;
    }
    .timer-linked-task-label {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: rgba(255, 255, 255, 0.55);
      margin-bottom: 4px;
    }
    .timer-linked-task-name {
      font-size: 15px;
      font-weight: 600;
      color: white;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* Clear button for linked task - more subtle */
    .timer-linked-task-clear {
      background: transparent;
      border: none;
      border-radius: 6px;
      padding: 6px;
      cursor: pointer;
      color: rgba(255, 255, 255, 0.4);
      transition: all 0.15s ease;
      flex-shrink: 0;
      opacity: 0;
    }
    .timer-linked-task:hover .timer-linked-task-clear {
      opacity: 1;
    }
    .timer-linked-task-clear:hover {
      background: rgba(255, 255, 255, 0.15);
      color: rgba(255, 255, 255, 0.8);
    }
    /* Timer task section wrapper */
    .timer-task-section {
      padding: 8px 24px 32px;
    }
    
    /* Custom Timer Task Selector - styled for plum background */
    .timer-task-selector {
      position: relative;
      width: 100%;
      max-width: 380px;
      margin: 0 auto;
    }
    .timer-task-trigger {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: rgba(255, 255, 255, 0.85);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
      text-align: left;
    }
    .timer-task-trigger:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.35);
    }
    .timer-task-trigger.open {
      background: rgba(255, 255, 255, 0.18);
      border-color: rgba(255, 255, 255, 0.4);
    }
    .timer-task-trigger-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 6px;
      flex-shrink: 0;
    }
    .timer-task-trigger-icon svg {
      color: rgba(255, 255, 255, 0.8);
    }
    .timer-task-trigger-text {
      flex: 1;
    }
    .timer-task-trigger-chevron {
      color: rgba(255, 255, 255, 0.6);
      transition: transform 0.15s ease;
      flex-shrink: 0;
    }
    .timer-task-trigger.open .timer-task-trigger-chevron {
      transform: rotate(180deg);
    }
    /* Task dropdown menu - portaled */
    .timer-task-menu {
      background: #4D334D;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      padding: 6px;
      max-height: 280px;
      overflow-y: auto;
      opacity: 0;
      transform: translateY(-8px);
      transition: opacity 0.15s ease, transform 0.15s ease;
    }
    .timer-task-menu.show {
      opacity: 1;
      transform: translateY(0);
    }
    .timer-task-option {
      padding: 12px 14px;
      border-radius: 8px;
      color: rgba(255, 255, 255, 0.9);
      font-size: 14px;
      cursor: pointer;
      transition: background 0.1s ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .timer-task-option:hover {
      background: rgba(255, 255, 255, 0.15);
    }
    
    /* Legacy task selector dropdown for timer (fallback) */
    .timer-task-selector-wrapper {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 0;
      position: relative;
    }
    .timer-task-select {
      width: 100%;
      padding: 14px 40px 14px 16px;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: rgba(255, 255, 255, 0.85);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.7)' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      transition: all 0.15s ease;
    }
    .timer-task-select:hover {
      background-color: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.35);
    }
    .timer-task-select:focus {
      outline: none;
      background-color: rgba(255, 255, 255, 0.12);
      border-color: rgba(255, 255, 255, 0.4);
    }
    .timer-task-select option {
      background: #4D334D;
      color: white;
      padding: 12px 16px;
    }
    /* Legacy support */
    .timer-working-on {
      margin-top: var(--space-6);
      padding: var(--space-4) var(--space-5);
      background: rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    .timer-working-on-icon {
      width: 36px;
      height: 36px;
      background: var(--terracotta);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      flex-shrink: 0;
    }
    .timer-working-on-text {
      flex: 1;
      min-width: 0;
    }
    .timer-working-on-label {
      font-size: 10px;
      font-weight: var(--weight-semibold);
      text-transform: uppercase;
      letter-spacing: var(--tracking-wider);
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 2px;
    }
    .timer-working-on-task {
      font-size: var(--text-base);
      font-weight: var(--weight-medium);
      color: white;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .timer-working-on-icon svg {
      width: 18px;
      height: 18px;
    }
    /* Card Icon Badges - From Design System Step 6 */
    .card-icon,
    .card-header-icon {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-sm); /* 6px */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: white; /* explicit white for icon visibility */
      flex-shrink: 0;
      margin-right: 10px;
    }
    .card-icon svg,
    .card-header-icon svg {
      width: 14px;
      height: 14px;
    }
    /* Color variants - set both background AND color for currentColor strokes */
    .card-icon-terracotta,
    .card-header-icon.card-icon-terracotta { background: var(--terracotta); color: var(--terracotta); }
    .card-icon-sage,
    .card-header-icon.card-icon-sage { background: var(--sage); color: var(--sage); }
    .card-icon-ochre,
    .card-header-icon.card-icon-ochre { background: var(--ochre); color: var(--ochre); }
    .card-icon-plum,
    .card-header-icon.card-icon-plum { background: var(--plum); color: var(--plum); }
    .card-icon-clay,
    .card-header-icon.card-icon-clay { background: var(--clay); color: var(--clay); }
    .card-icon-neutral,
    .card-header-icon.card-icon-neutral { background: var(--text-tertiary); color: var(--text-tertiary); }
    /* Legacy support - card-specific colors */
    .today-card .card-header-icon,
    .today-card .card-icon {
      background: var(--plum);
    }
    .primary-card .card-header-icon,
    .primary-card .card-icon {
      background: var(--terracotta);
    }
    .this-week-card .card-header-icon,
    .this-week-card .card-icon {
      background: var(--ochre);
    }
    .later-card .card-header-icon,
    .explore-card .card-header-icon,
    .later-card .card-icon,
    .explore-card .card-icon {
      background: var(--sage);
    }
    .habits-card .card-header-icon,
    .habits-card .card-icon {
      background: var(--sage);
    }
    .wisdom-card .card-header-icon,
    .wisdom-card .card-icon {
      background: var(--ochre);
    }
    .anchors-card .card-header-icon,
    .anchors-card .card-icon {
      background: var(--terracotta);
    }
    .schedule-card .card-header-icon,
    .schedule-card .card-icon {
      background: var(--ochre);
    }
    .apple-timer-settings-overlay {
      position: absolute;
      inset: 0;
      z-index: 50;
      pointer-events: none;
      opacity: 0;
      transition: opacity 250ms ease-out;
      border-radius: var(--card-radius);
      overflow: hidden;
    }
    .apple-timer-settings-overlay.open {
      pointer-events: auto;
      opacity: 1;
    }
    .apple-timer-settings-backdrop {
      position: absolute;
      inset: 0;
      background: var(--card-bg); /* Fully opaque background */
      transition: opacity 250ms ease-out;
      opacity: 0;
      border-radius: inherit;
    }
    [data-theme="dark"] .apple-timer-settings-backdrop {
      background: var(--card-bg);
    }
    .apple-timer-settings-overlay.open .apple-timer-settings-backdrop {
      opacity: 1;
    }
    .apple-timer-settings-panel {
      position: absolute;
      inset: 0;
      padding: 16px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      overflow-y: auto;
    }
    .apple-timer-settings-content {
      position: relative;
      width: 100%;
      max-width: 100%;
      overflow: hidden;
      border-radius: var(--radius-lg);
      border: 1px solid var(--card-border);
      background: var(--card-bg);
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08), 0 2px 8px rgba(15, 23, 42, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.55);
      transition: transform 250ms ease-out, opacity 250ms ease-out;
      transform: translateY(-8px);
      opacity: 0;
    }
    [data-theme="dark"] .apple-timer-settings-content {
      background: var(--card-bg);
      border-color: rgba(255, 255, 255, 0.12);
      box-shadow: 0 12px 36px rgba(0, 0, 0, 0.45), inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }
    .apple-timer-settings-overlay.open .apple-timer-settings-content {
      transform: translateY(0);
      opacity: 1;
    }
    .apple-timer-settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: var(--space-4);
      border-bottom: 1px solid var(--border);
    }
    [data-theme="dark"] .apple-timer-settings-header {
      border-bottom-color: rgba(255, 255, 255, 0.10);
    }
    .apple-timer-settings-title {
      font-size: var(--text-base);
      font-weight: 600;
      color: var(--text);
    }
    .apple-timer-settings-subtitle {
      margin-top: 2px;
      font-size: var(--text-xs);
      color: var(--text-muted);
    }
    .apple-timer-settings-close {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-strong);
      background: var(--toggle-bg);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.15s ease-out;
      box-shadow: var(--shadow-sm);
    }
    .apple-timer-settings-close svg path {
      stroke: var(--text-muted);
    }
    .apple-timer-settings-close:hover {
      background: var(--border-strong);
    }
    .apple-timer-settings-close:hover svg path {
      stroke: var(--text);
    }
    [data-theme="dark"] .apple-timer-settings-close {
      border-color: rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.08);
    }
    [data-theme="dark"] .apple-timer-settings-close svg path {
      stroke: rgba(255, 255, 255, 0.85);
    }
    [data-theme="dark"] .apple-timer-settings-close:hover {
      background: rgba(255, 255, 255, 0.12);
    }
    .apple-timer-settings-body {
      padding: var(--space-4);
      display: grid;
      gap: 12px;
    }
    .apple-timer-setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 14px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, 0.02);
    }
    [data-theme="dark"] .apple-timer-setting-row {
      border-color: rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.06);
    }
    .apple-timer-setting-label {
      min-width: 0;
    }
    .apple-timer-setting-label-title {
      font-size: var(--text-sm);
      font-weight: 600;
      color: var(--text);
    }
    .apple-timer-setting-label-subtitle {
      margin-top: 2px;
      font-size: var(--text-xs);
      color: var(--text-muted);
    }
    .apple-timer-setting-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-strong);
      background: var(--card-bg);
      color: var(--text);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease-out;
      box-shadow: var(--shadow-sm);
    }
    .apple-timer-setting-btn:hover {
      transform: translateY(-1px);
      background: var(--border-strong);
      border-color: var(--focus-border);
    }
    .apple-timer-setting-btn:active {
      transform: translateY(0);
    }
    [data-theme="dark"] .apple-timer-setting-btn {
      border-color: rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.07);
    }
    [data-theme="dark"] .apple-timer-setting-btn:hover {
      background: rgba(255, 255, 255, 0.12);
    }
    .apple-timer-setting-input {
      width: 56px;
      height: 36px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-strong);
      background: var(--card-bg);
      text-align: center;
      font-size: var(--text-sm);
      font-variant-numeric: tabular-nums;
      color: var(--text);
      outline: none;
      /* Hide number input spinners */
      -moz-appearance: textfield;
    }
    .apple-timer-setting-input::-webkit-outer-spin-button,
    .apple-timer-setting-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    [data-theme="dark"] .apple-timer-setting-input {
      border-color: rgba(255, 255, 255, 0.15);
      background: rgba(0, 0, 0, 0.20);
    }
    /* Center the duration controls */
    .apple-timer-setting-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-left: auto;
    }
    .apple-timer-toggle {
      position: relative;
      height: 28px;
      width: 48px;
      overflow: hidden;
      border-radius: var(--radius-full);
      border: 1.5px solid rgba(44, 42, 39, 0.25);
      background: rgba(44, 42, 39, 0.12);
      cursor: pointer;
      transition: background-color 0.15s ease-out, border-color 0.15s ease-out;
    }
    .apple-timer-toggle.on {
      border-color: var(--accent);
      background: var(--accent);
    }
    [data-theme="dark"] .apple-timer-toggle {
      border-color: rgba(255, 255, 255, 0.20);
      background: rgba(255, 255, 255, 0.10);
    }
    [data-theme="dark"] .apple-timer-toggle.on {
      border-color: var(--accent-soft);
      background: var(--accent-soft);
    }
    .apple-timer-toggle-knob {
      position: absolute;
      left: 2px;
      top: 2px;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      transform: translateX(0);
      transition: transform 0.15s ease-out;
      will-change: transform;
    }
    [data-theme="dark"] .apple-timer-toggle-knob {
      background: #fff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
    }
    .apple-timer-toggle.on .apple-timer-toggle-knob {
      transform: translateX(20px);
    }
    /* Dark mode timer container overrides */
    /* Timer Card - Plum gradient from Design System Step 12 */
    .timer-card,
    .apple-timer-container,
    .focus-timer-card {
      background: linear-gradient(160deg, #8A6A8A 0%, #6B4A6B 50%, #4D334D 100%);
      border-radius: 20px;
      box-shadow: 0 4px 8px rgba(44, 38, 32, 0.04), 0 12px 32px rgba(44, 38, 32, 0.10);
      color: white;
      padding: 32px;
    }
    [data-theme="dark"] .timer-card,
    [data-theme="dark"] .timer-hero,
    [data-theme="dark"] .apple-timer-container,
    .timer-card.dark,
    .dark .timer-card {
      background: linear-gradient(145deg, var(--plum-deep) 0%, #3D2840 100%); /* Deep and subdued plum in dark mode */
      border-color: rgba(255, 255, 255, 0.08);
      outline-color: rgba(255, 255, 255, 0.06);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08), var(--card-shadow);
    }
    [data-theme="dark"] .apple-timer-container:hover {
      border-color: rgba(255, 255, 255, 0.12);
    }
    /* Timer glow effect */
    .timer-card::before,
    .apple-timer-container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.08) 0%, transparent 50%);
      pointer-events: none;
    }
    /* Timer ring */
    .timer-ring-track,
    .apple-timer-ring-track {
      fill: none;
      stroke: rgba(255, 255, 255, 0.15);
      stroke-width: 8;
    }
    .timer-ring-progress,
    .apple-timer-ring-fill {
      fill: none;
      stroke: var(--text-inverse); /* white */
      stroke-width: 8;
      stroke-linecap: round;
    }
    /* Timer display - using .timer-display class from design system */
    .timer-display {
      font-family: var(--font-display);
      font-size: var(--text-timer);
      font-weight: var(--weight-regular);
      letter-spacing: var(--tracking-tight);
      line-height: var(--leading-none);
      margin-bottom: var(--space-2);
      position: relative;
      z-index: 1;
    }
    /* Timer text */
    .timer-time,
    .apple-timer-time {
      font-family: var(--font-display);
      font-size: var(--text-timer);
      font-weight: var(--weight-regular);
      color: white;
      letter-spacing: var(--tracking-tight);
      line-height: var(--leading-none);
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center; /* Visually centered with ring */
    }
    
    .timer-status {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 8px;
    }
    
    .timer-actions {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 32px;
    }
    
    .timer-btn {
      padding: 14px 28px;
      font-size: 14px;
      font-weight: 600;
      border-radius: 10px;  /* ROUNDED RECTANGLE */
      border: none;
      cursor: pointer;
    }
    
    .timer-btn.primary {
      background: white;
      color: #6B4A6B;  /* Plum color for text */
    }
    
    .timer-btn.secondary {
      background: rgba(255, 255, 255, 0.15);
      color: white;
    }
    [data-theme="dark"] .apple-timer-ring-fill {
      stroke: rgba(255, 255, 255, 0.85);
    }
    [data-theme="dark"] .apple-timer-time {
      color: #F5F3F0;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }
    /* Mode tabs on timer - MUST be centered */
    .timer-modes,
    .timer-mode-tabs,
    .apple-timer-modes {
      display: flex;
      justify-content: center;  /* CENTERED, not flex-start */
      margin-bottom: var(--space-8); /* Increased spacing to match design system */
    }
    
    .timer-modes .segmented-control,
    .timer-mode-tabs .segmented-control,
    .apple-timer-modes .segmented-control,
    .segmented-control.dark {
      display: inline-flex;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 10px;
      padding: 3px;
    }
    .timer-modes .segmented-control button,
    .timer-mode-tab,
    .apple-timer-mode-btn {
      padding: 10px 24px; /* Increased padding to match design system */
      font-size: 14px; /* Increased font size */
      font-weight: 500;
      color: rgba(255, 255, 255, 0.5);
      background: transparent;
      border: none;
      border-radius: calc(var(--radius-md) - 3px);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .timer-modes .segmented-control button.active,
    .timer-mode-tab.active,
    .apple-timer-mode-btn.active {
      background: rgba(255, 255, 255, 0.25);
      color: white;
      box-shadow: none;  /* No shadow on dark background */
    }
    /* Ensure timer card/header band is at top (not floating in middle) */
    .timer-card,
    .timer-hero,
    .apple-timer-container {
      margin-top: 0; /* Card/header band must be at top */
    }
    /* Mode tabs in dark mode */
    [data-theme="dark"] .apple-timer-mode-btn {
      color: rgba(255, 255, 255, 0.5);
      border-color: rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.05);
    }
    [data-theme="dark"] .apple-timer-mode-btn.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border-color: rgba(255, 255, 255, 0.25);
    }
    /* Timer buttons */
    .timer-btn-primary,
    .apple-timer-btn-primary {
      background: var(--text-inverse); /* white */
      color: var(--plum);
      padding: var(--space-3) var(--space-8);
      font-weight: var(--weight-semibold);
      border-radius: var(--radius-md);
      border: none;
    }
    .timer-btn-secondary,
    .apple-timer-btn-secondary {
      background: rgba(255, 255, 255, 0.15);
      color: var(--text-inverse);
      padding: var(--space-3) var(--space-6);
      font-weight: var(--weight-medium);
      border-radius: var(--radius-md);
      border: none;
    }
    
    /* TASKS */
    .task-item { 
      display: flex; align-items: flex-start; gap: var(--space-2); 
      padding: var(--space-2) var(--space-2); border-bottom: 1px solid var(--border); 
      position: relative; border-radius: var(--radius-md); margin: 0 calc(var(--space-2) * -1);
      transition: all 0.2s ease-out;
    }
    .task-item:last-child { border-bottom: none; }
    .task-item:hover { background: var(--toggle-bg); }
    .task-item:hover .task-actions { opacity: 1; }
    .task-item.completing { opacity: 0.5; transform: scale(0.98); }
    .task-item.just-completed { background: var(--rest-light); }
    
    /* Active task indicator (linked to running timer) - Pulsing plum dot like mockup */
    .task-item.active-focus { 
      background: var(--plum-bg); 
      position: relative;
    }
    .task-item.active-focus::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--plum);
      box-shadow: 0 0 6px rgba(107, 74, 107, 0.6);
      animation: focusDotPulse 1.5s ease-in-out infinite;
    }
    @keyframes focusDotPulse {
      0%, 100% { opacity: 1; transform: translateY(-50%) scale(1); box-shadow: 0 0 6px rgba(107, 74, 107, 0.6); }
      50% { opacity: 0.7; transform: translateY(-50%) scale(0.8); box-shadow: 0 0 10px rgba(107, 74, 107, 0.8); }
    }
    .reduce-motion .task-item.active-focus::before { animation: none; }
    
    .task-check,
    .task-checkbox {
      width: 20px;
      height: 20px;
      border-radius: 5px;
      border: 2px solid var(--border-strong);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      background: transparent;
    }
    /* Habit Checkbox - CIRCULAR from Design System Step 7 */
    .habit-check,
    .habit-checkbox {
      width: 22px;
      height: 22px;
      min-width: 22px;
      border-radius: 50%;
      border: 2px solid var(--border-strong);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
      background: transparent;
      color: transparent;
    }
    .habit-check:hover,
    .habit-checkbox:hover {
      border-color: var(--sage);
      background: var(--sage-bg);
    }
    .habit-check.done,
    .habit-check.checked,
    .habit-checkbox.done,
    .habit-checkbox.checked,
    .habit-checkbox[data-checked="true"] {
      background: var(--sage); /* #7A9A7E */
      border-color: var(--sage);
      color: var(--text-inverse); /* white */
    }
    .habit-check.done svg,
    .habit-check.checked svg,
    .habit-checkbox.done svg,
    .habit-checkbox.checked svg {
      width: 12px;
      height: 12px;
      color: white;
    }
    /* Checkmark animation */
    .habit-check.done svg,
    .habit-checkbox.checked svg {
      animation: checkmark-pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes checkmark-pop {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }
    /* Habit checkboxes are circular */
    /* Habit check - matches task-check but circular */
    .habit-check {
      width: 24px;
      height: 24px;
      min-width: 24px;
      border-radius: 50%;
      border: 2px solid var(--border-strong);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      background: transparent;
      flex-shrink: 0;
      color: transparent;
    }
    .habit-check:hover {
      border-color: var(--sage);
      background: var(--sage-bg);
    }
    .habit-check.done {
      background: var(--sage);
      border-color: var(--sage);
      color: white;
    }
    .habit-check.done svg,
    .habit-check svg {
      width: 14px;
      height: 14px;
    }
    .habit-check.done svg {
      color: white;
    }
    .task-check svg { width: 10px; height: 10px; }
    .task-content { flex: 1; min-width: 0; }
    .task-text {  font-size: var(--text-sm); color: var(--text); line-height: var(--leading-normal); }
    .task-text.done { text-decoration: line-through; color: var(--text-muted); }
    .task-meta { display: flex; align-items: center; gap: var(--space-2); margin-top: var(--space-1); flex-wrap: wrap; }
    .task-category { 
      
      font-size: var(--text-xs); color: var(--text-muted); 
      background: var(--toggle-bg); padding: var(--space-1) var(--space-2); border-radius: var(--radius-sm); 
      display: inline-flex; align-items: center; gap: var(--space-1); 
      cursor: pointer; transition: all 0.15s ease-out;
      position: relative;
    }
    .task-category:hover { background: var(--border-strong); }
    .task-category-dot { width: 5px; height: 5px; border-radius: 50%; }
    
    /* PRIMARY TASK EMPHASIS in Focus view only - label only, no highlight */
    .mode-focus .task-item.is-primary {
      background: transparent !important;
      border-left: none !important;
      margin-left: 0 !important;
      padding-left: 0 !important;
      border-radius: 0 !important;
    }
    .mode-focus .task-item.is-primary .task-text { font-weight: var(--weight-regular); }
    /* Primary star - capped to line-height, properly aligned */
    .primary-star-indicator {
      width: 16px;
      height: 16px;
      max-width: 16px;
      max-height: 16px;
      min-width: 16px;
      min-height: 16px;
      color: var(--accent);
      margin-right: var(--space-1);
      flex-shrink: 0;
      opacity: 0.7;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      vertical-align: middle;
      transform: translateY(-1px);
    }
    .primary-star-indicator svg {
      width: 14px;
      height: 14px;
      max-width: 14px;
      max-height: 14px;
    }
    .focus-primary-task {
      position: relative;
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
    }
    .focus-primary-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--terracotta);
      padding: 2px 0 2px 28px;
      margin-bottom: 2px;
    }
    .focus-primary-indicator svg {
      width: 12px;
      height: 12px;
      color: var(--terracotta);
      fill: var(--terracotta);
    }
    
    /* FOCUS TASKS - Matching Screenshot 4 design */
    .focus-tasks-content {
      padding: var(--space-4) var(--space-5);
    }
    .focus-task-list {
      display: flex;
      flex-direction: column;
    }
    .focus-task-item {
      padding: var(--space-4) 0;
      border-bottom: 1px solid var(--border);
    }
    .focus-task-item:last-child {
      border-bottom: none;
    }
    .focus-task-item.is-done {
      opacity: 0.6;
    }
    .focus-primary-label {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--terracotta);
      margin-bottom: 8px;
      padding-left: 4px;
    }
    .focus-primary-label svg {
      width: 12px;
      height: 12px;
      color: var(--terracotta);
      fill: var(--terracotta);
    }
    .focus-primary-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--plum);
      margin-right: 4px;
    }
    .focus-task-row {
      display: flex;
      align-items: flex-start;
      gap: var(--space-3);
    }
    .focus-task-content {
      flex: 1;
      min-width: 0;
    }
    .focus-task-text {
      font-size: var(--text-base);
      font-weight: 500;
      color: var(--text);
      line-height: 1.4;
    }
    .focus-task-text.completed {
      text-decoration: line-through;
      color: var(--text-muted);
    }
    .focus-task-meta {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-top: 4px;
      font-size: var(--text-sm);
      color: var(--text-muted);
    }
    .focus-task-category {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .focus-task-category-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
    .focus-task-time {
      color: var(--text-light);
    }
    .focus-task-time::before {
      content: '';
      margin-right: var(--space-2);
    }
    
    /* INLINE TASK ADD - Click to add anywhere */
    .inline-add-zone {
      min-height: 40px;
      padding: var(--space-2) var(--space-3);
      cursor: text;
      border-radius: var(--radius-md);
      transition: background 0.15s ease-out;
      display: flex;
      align-items: center;
    }
    .inline-add-zone:hover {
      background: var(--toggle-bg);
    }
    .inline-add-placeholder {
      font-size: 13px;
      color: var(--text-muted);
      opacity: 0.6;
      font-style: normal;
    }
    .inline-add-input {
      width: 100%;
      padding: var(--space-2) 0;
      border: none;
      background: transparent;
      
      font-size: var(--text-sm);
      color: var(--text);
      outline: none;
    }
    .inline-add-input::placeholder {
      color: var(--text-muted);
      opacity: 0.6;
    }
    
    /* PORTAL CATEGORY DROPDOWN - Fixed positioning, flip support */
    .category-portal-menu {
      position: fixed;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      z-index: 9999;
      min-width: 130px;
      padding: var(--space-1);
      opacity: 0;
      transform: translateY(-4px);
      transition: opacity 0.15s ease-out, transform 0.15s ease-out;
      pointer-events: none;
    }
    .category-portal-menu.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }
    .category-portal-menu.flip-up {
      transform: translateY(4px);
    }
    .category-portal-menu.flip-up.show {
      transform: translateY(0);
    }
    .category-portal-item {
      
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-2);
      font-size: var(--text-sm);
      color: var(--text);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: background 0.1s ease-out;
    }
    .category-portal-item:hover { background: var(--toggle-bg); }
    .category-portal-item.selected { background: var(--accent-hover); }
    .category-portal-item .cat-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    
    /* Legacy category dropdown (for backwards compat) */
    .category-dropdown {
      position: absolute; top: 100%; left: 0; margin-top: 4px;
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 8px; box-shadow: var(--shadow-lg); z-index: 200;
      min-width: 120px; padding: 4px; opacity: 0; transform: translateY(-4px);
      pointer-events: none; transition: all 0.15s ease-out;
    }
    .category-dropdown.show { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .category-dropdown-item {
      display: flex; align-items: center; gap: 6px; padding: 6px 8px;
      font-size: 11px; color: var(--text); border-radius: 5px;
      cursor: pointer; transition: background 0.15s ease-out;
    }
    .category-dropdown-item:hover { background: var(--toggle-bg); }
    .category-dropdown-item .cat-dot { width: 6px; height: 6px; border-radius: 50%; }
    
    /* Category editor styles */
    .category-edit-row {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) 0;
      border-bottom: 1px solid var(--border);
    }
    .category-color-picker {
      width: 28px;
      height: 28px;
      border: 2px solid var(--border-strong);
      border-radius: 50%;
      cursor: pointer;
      padding: 0;
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
    }
    .category-color-picker::-webkit-color-swatch-wrapper {
      padding: 0;
    }
    .category-color-picker::-webkit-color-swatch {
      border: none;
      border-radius: 50%;
    }
    .category-color-picker::-moz-color-swatch {
      border: none;
      border-radius: 50%;
    }
    .category-color-picker:hover {
      border-color: var(--accent);
      transform: scale(1.1);
    }
    .category-name-input {
      flex: 1;
      padding: var(--space-2);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: var(--text-sm);
      background: var(--toggle-bg);
      color: var(--text);
    }
    .category-delete-btn {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .category-delete-btn:hover {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }
    .category-add-btn {
      margin-top: var(--space-2);
      padding: var(--space-2);
      width: 100%;
      border: 1px dashed var(--border-strong);
      background: transparent;
      color: var(--text-muted);
      font-size: var(--text-sm);
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-1);
    }
    .category-add-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }
    
    .task-time { font-size: 10px; color: var(--text-muted); cursor: pointer; padding: 2px 5px; border-radius: 3px; transition: all 0.15s ease-out; }
    .task-time:hover { background: var(--toggle-bg); }
    .task-time-input { 
      width: 40px; padding: 2px 4px; font-size: 10px; text-align: center; 
      border: 1px solid var(--accent); border-radius: 4px; 
      background: var(--card-bg); color: var(--text); outline: none;
    }
    .task-time-input:focus { box-shadow: 0 0 0 2px var(--accent-hover); }
    .task-focus-time { font-size: 10px; color: var(--focus); font-weight: 500; padding: 2px 6px; background: var(--focus-hover); border-radius: 4px; }
    .task-actions { display: flex; gap: 3px; opacity: 0; transition: opacity 0.2s ease-out; position: absolute; right: 6px; top: 10px; }
    .task-action-btn { 
      width: 24px; height: 24px; border: none; 
      background: var(--card-bg); color: var(--text-muted); 
      border-radius: 5px; cursor: pointer; 
      display: flex; align-items: center; justify-content: center; 
      transition: all 0.15s ease-out; box-shadow: var(--shadow-sm); 
    }
    .task-action-btn:hover { color: var(--text); background: var(--card-bg-hover); }
    .task-action-btn.delete:hover { background: #fef2f2; color: #ef4444; }
    [data-theme="dark"] .task-action-btn.delete:hover { background: rgba(239, 68, 68, 0.15); color: #f87171; }
    .task-action-btn svg { width: 11px; height: 11px; }
    
    /* DRAG & DROP SYSTEM - Phase 3 */
    .drag-handle {
      width: 20px;
      height: 100%;
      min-height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-light);
      cursor: grab;
      opacity: 0;
      transition: opacity 0.15s ease-out, color 0.15s ease-out;
      flex-shrink: 0;
      margin-left: -4px;
      margin-right: 4px;
      border-radius: var(--radius-sm);
    }
    .drag-handle:hover { color: var(--text-muted); background: var(--toggle-bg); }
    .drag-handle:active { cursor: grabbing; }
    .drag-handle svg { width: 14px; height: 14px; }
    .task-item:hover .drag-handle { opacity: 1; }
    /* Prevent drag-handle from appearing in habit items */
    .habit-item .drag-handle { display: none !important; }
    
    /* Dragging state */
    .task-item.dragging,
    .habit-item.dragging,
    .schedule-block.dragging {
      opacity: 0.5;
      transform: scale(0.98);
      box-shadow: none;
    }
    
    /* Drag ghost (follows cursor) */
    .drag-ghost {
      position: fixed;
      pointer-events: none;
      z-index: 9999;
      background: var(--card-bg);
      border: 1px solid var(--accent);
      border-radius: var(--radius-md);
      padding: 8px 12px;
      box-shadow: var(--shadow-lg);
      font-size: 12px;
      color: var(--text);
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transform: translate(-50%, -50%) scale(1.02);
      opacity: 0.95;
    }
    
    /* Drop zone indicators */
    .drop-zone-active {
      background: var(--focus-hover) !important;
      border: 2px dashed var(--focus) !important;
      border-radius: var(--radius-md);
    }
    
    /* Task list drop zone line */
    .task-drop-line {
      height: 3px;
      background: var(--accent);
      border-radius: 2px;
      margin: 2px 0;
      opacity: 0;
      transition: opacity 0.15s ease-out;
    }
    .task-drop-line.visible { opacity: 1; }
    
    /* Schedule drop preview with guide line */
    .schedule-drop-preview {
      position: absolute;
      left: var(--schedule-content-pad);
      right: var(--schedule-content-pad);
      background: var(--accent-light);
      border: 2px dashed var(--accent);
      border-radius: 6px;
      z-index: 10;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      color: var(--accent);
      opacity: 0;
      transition: opacity 0.12s ease-out, top 0.05s ease-out;
    }
    .schedule-drop-preview.visible { opacity: 1; }
    /* Horizontal guide line at snap position */
    .schedule-drop-preview::before {
      content: '';
      position: absolute;
      top: 0;
      left: calc(-1 * var(--schedule-label-width) - 8px);
      right: calc(-1 * var(--schedule-content-pad));
      height: 1px;
      background: linear-gradient(to right, transparent, var(--accent) 20%, var(--accent) 80%, transparent);
      opacity: 0.5;
    }
    
    /* Floating time label during block drag */
    .schedule-drag-label {
      position: fixed;
      background: var(--card-bg);
      border: 1px solid var(--accent);
      border-radius: 8px;
      padding: 5px 12px;
      font-size: 13px;
      font-weight: 600;
      color: var(--accent);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15), 0 2px 4px rgba(0,0,0,0.08);
      z-index: 1000;
      pointer-events: none;
      transform: translate(-50%, -100%);
      margin-top: -12px;
      white-space: nowrap;
    }
    [data-theme="dark"] .schedule-drag-label {
      box-shadow: 0 4px 16px rgba(0,0,0,0.4), 0 2px 4px rgba(0,0,0,0.2);
    }
    
    /* Scheduled indicator on tasks */
    .task-scheduled-indicator {
      width: 14px;
      height: 14px;
      color: var(--focus);
      opacity: 0.7;
      flex-shrink: 0;
    }
    .task-scheduled-indicator svg { width: 12px; height: 12px; }
    
    /* Schedule grid accepting drops */
    .schedule-grid.drag-over {
      background: var(--focus-hover);
    }
    .schedule-grid.drag-over .quarter-slot { background: transparent; }
    
    /* Habit reorder handle - separate from drag-to-schedule handle */
    .habit-reorder-handle {
      width: 20px;
      height: 100%;
      min-height: 32px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: grab;
      color: var(--text-tertiary);
      transition: all 0.2s ease;
      border-radius: var(--radius-sm);
      margin-right: 8px;
      flex-shrink: 0;
      opacity: 0.6;
    }
    .habit-reorder-handle:hover { 
      color: var(--text-secondary); 
      background: var(--bg-secondary); 
      opacity: 1;
    }
    .habit-reorder-handle:active { 
      cursor: grabbing; 
    }
    .habit-reorder-handle.dragging {
      opacity: 0.5;
    }
    .habit-reorder-handle svg { 
      width: 14px; 
      height: 14px; 
    }
    .habit-item.drag-over {
      background: var(--sage-bg);
      border-left: 2px solid var(--sage);
    }
    /* Habit drag handle positioning - for schedule drag */
    .habit-item { 
      position: relative; 
      display: flex;
      align-items: center;
    }
    .habit-item .drag-handle {
      display: none !important;
    }
    .habits-card .card-content { 
      padding: var(--space-5) 24px 24px; /* Increased top padding so first habit isn't jammed */
    }
    .task-count { font-size: 10px; color: var(--text-muted); background: var(--toggle-bg); padding: 2px 8px; border-radius: 10px; }
    .task-count.at-limit { background: var(--accent-light); color: var(--accent); }
    .task-edit-input { flex: 1; padding: 6px 10px; border: 2px solid var(--accent); border-radius: 6px; font-size: 13px; background: var(--card-bg); color: var(--text); outline: none; }
    .empty-state { text-align: center; padding: 24px 16px; color: var(--text-muted); font-size: 13px; font-style: italic; }
    
    /* UNDO TOAST */
    .undo-toast { 
      position: fixed; bottom: 150px; left: 50%; 
      transform: translateX(-50%) translateY(20px); 
      padding: 10px 16px; background: var(--card-bg); 
      border: 1px solid var(--rest-border); border-radius: 10px; 
      box-shadow: var(--shadow-md); z-index: 200; 
      display: flex; align-items: center; gap: 12px; 
      opacity: 0; pointer-events: none; 
      transition: all 0.3s ease-out; 
    }
    .undo-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
    .undo-toast-text { font-size: 13px; color: var(--text); display: flex; align-items: center; gap: 6px; }
    .undo-toast-text svg { width: 16px; height: 16px; color: var(--rest); }
    .undo-btn { 
      padding: 6px 12px; border: none; background: var(--rest); 
      color: #fff; font-size: 12px; font-weight: 600; border-radius: 6px; 
      cursor: pointer; transition: all 0.2s ease-out; 
    }
    .undo-btn:hover { background: #059669; }
    
    /* Dropdowns */
    .dropdown-menu { position: absolute; top: 100%; right: 0; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 8px; box-shadow: var(--shadow-md); z-index: 100; min-width: 120px; padding: 4px; }
    .dropdown-item { padding: 8px 12px; font-size: 12px; cursor: pointer; border-radius: 5px; transition: background 0.15s ease-out; }
    .dropdown-item:hover { background: var(--toggle-bg); }
    
    /* Category colors */
    .cat-photo { background: #f59e0b; }
    .cat-admin { background: #3b82f6; }
    .cat-meeting { background: var(--sage); }
    .cat-personal { background: #ec4899; }
    .cat-writing { background: #6B4A6B; } /* Plum for creative work */
    .cat-none { background: var(--text-muted); opacity: 0.3; }
    
    /* UNIFIED INPUT COMPONENTS - Same height, padding, radius */
    /* Input height: 36px | Padding: 8px 12px | Radius: 8px */
    
    .add-input-inline { 
      width: 100%; 
      height: 36px;
      padding: 0 var(--space-3); 
      border: none; 
      border-top: 1px solid var(--border); 
      font-size: var(--text-sm); 
      background: transparent; 
      color: var(--text); 
      outline: none; 
      margin-top: auto;
    }
    .add-input-inline::placeholder { color: var(--text-muted); }
    .add-input-inline:focus { border-top-color: var(--accent); background: var(--toggle-bg); }
    
    .add-input-row { display: flex; gap: var(--space-2); margin-top: var(--space-3); }
    
    .add-input { 
      flex: 1; 
      height: 36px;
      padding: 0 var(--space-3); 
      border: 1px solid var(--border-strong); 
      border-radius: var(--radius-md); 
      font-size: var(--text-sm); 
      background: var(--toggle-bg); 
      color: var(--text); 
      outline: none;
    }
    .add-input:focus { border-color: var(--accent); background: var(--card-bg); box-shadow: 0 0 0 3px var(--accent-hover); }
    .add-input::placeholder { color: var(--text-muted); }
    
    .add-btn { 
      height: 36px;
      padding: 0 var(--space-4); 
      border: none; 
      background: var(--terracotta); 
      color: #fff; 
      border-radius: var(--radius-full); 
      cursor: pointer; 
      font-size: var(--text-sm); 
      font-weight: 500;
      transition: all 0.15s ease-out;
    }
    .add-btn,
    .quick-add-btn,
    button.primary-action {
      background: var(--terracotta);
      color: white;
      padding: 10px 20px;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: var(--text-sm);
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .add-btn:hover,
    .quick-add-btn:hover,
    button.primary-action:hover {
      background: var(--terracotta-deep);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(196, 112, 75, 0.3);
    }
    .add-btn:active,
    .quick-add-btn:active,
    button.primary-action:active {
      transform: translateY(0);
    }
    /* Secondary button style */
    button.secondary-action {
      background: transparent;
      color: var(--text-secondary);
      padding: 10px 20px;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: var(--text-sm);
      border: 1px solid var(--border-default);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    button.secondary-action:hover {
      background: var(--toggle-bg);
      border-color: var(--border-strong);
    }
    
    /* QUICK ADD BAR - Uses unified input styles */
    .quick-add-bar { 
      position: fixed; 
      bottom: 80px; 
      left: 50%; 
      transform: translateX(-50%); 
      display: flex; 
      align-items: center;
      gap: var(--space-2); 
      padding: var(--space-2) var(--space-3); 
      background: var(--card-bg); 
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px); 
      border: 1px solid var(--card-border); 
      border-radius: var(--radius-full); 
      box-shadow: var(--shadow-md); 
      z-index: 100;
    }
    .quick-add-bar.hidden { opacity: 0; transform: translateX(-50%) translateY(20px); pointer-events: none; }
    .quick-add-bar input { 
      width: 200px; 
      height: 36px;
      padding: 0 var(--space-3); 
      border: 1px solid var(--border-strong); 
      border-radius: var(--radius-full); 
      font-size: var(--text-sm); 
      background: var(--toggle-bg); 
      color: var(--text); 
      outline: none;
    }
    .quick-add-bar input:focus { border-color: var(--accent); background: var(--card-bg); box-shadow: 0 0 0 3px var(--accent-hover); }
    .quick-add-bar input::placeholder { color: var(--text-muted); }
    .quick-add-bar .custom-select { height: 36px; }
    .quick-add-bar .custom-select-trigger { 
      height: 36px; 
      padding: 0 var(--space-3); 
      border-radius: var(--radius-full); 
      font-size: var(--text-sm);
      min-width: 100px;
    }
    .quick-add-bar .add-btn { 
      height: 36px;
      padding: 0 var(--space-4); 
      border-radius: var(--radius-full); 
      display: flex; 
      align-items: center; 
      gap: var(--space-1);
      
      font-size: var(--text-sm);
    }
    .quick-add-bar .add-btn svg { width: 12px; height: 12px; }
    
    /* B) HABITS - With + button reveal pattern */
    /* Sage header - Habits, completions, Rest mode */
    .card-header-sage,
    .card-header[data-color="sage"],
    .habits-card .card-header {
      background: linear-gradient(135deg, rgba(122, 154, 126, 0.08) 0%, rgba(122, 154, 126, 0.03) 100%);
      border-bottom-color: var(--sage-border);
      border-radius: 0;
    }
    [data-theme="dark"] .habits-card .card-header {
      background: linear-gradient(135deg, rgba(122, 154, 126, 0.12) 0%, rgba(122, 154, 126, 0.04) 100%);
    }
    .habits-card .card-header:hover { background: var(--sage-bg); }
    .habits-card .card-header h3 { 
      display: flex; 
      align-items: center; 
      gap: var(--space-2); 
    }
    .habits-add-btn {
      width: 28px; height: 28px;
      border-radius: var(--radius-full);
      border: 1px solid rgba(16, 185, 129, 0.25);
      background: rgba(16, 185, 129, 0.18);
      color: #059669;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease-out;
      box-shadow: 0 1px 3px rgba(5, 150, 105, 0.15);
    }
    .habits-add-btn:hover { background: rgba(16, 185, 129, 0.25); transform: scale(1.05); box-shadow: 0 2px 6px rgba(5, 150, 105, 0.25); }
    [data-theme="dark"] .habits-add-btn { background: var(--sage-bg); border-color: var(--sage-border); color: var(--sage); box-shadow: 0 1px 3px rgba(122, 154, 126, 0.2); }
    [data-theme="dark"] .habits-add-btn:hover { background: rgba(16, 185, 129, 0.3); }
    .habits-add-btn svg { width: 16px; height: 16px; stroke-width: 3; }
    
    /* ANCHORS */
    .anchors-card { margin-bottom: 0; margin-top: 0; }
    /* Ochre header - Anchors, wisdom */
    .card-header-ochre,
    .card-header[data-color="ochre"],
    .wisdom-card .card-header {
      background: linear-gradient(135deg, rgba(201, 162, 39, 0.08) 0%, rgba(201, 162, 39, 0.03) 100%);
      border-bottom-color: var(--ochre-border);
      border-radius: 0;
    }
    .anchors-card .card-header {
      background: linear-gradient(135deg, rgba(196, 112, 75, 0.08) 0%, rgba(196, 112, 75, 0.03) 100%);
      border-bottom-color: var(--terracotta-border);
      border-radius: 0;
    }
    [data-theme="dark"] .wisdom-card .card-header {
      background: linear-gradient(135deg, rgba(201, 162, 39, 0.12) 0%, rgba(201, 162, 39, 0.04) 100%);
    }
    [data-theme="dark"] .anchors-card .card-header {
      background: linear-gradient(135deg, rgba(196, 112, 75, 0.12) 0%, rgba(196, 112, 75, 0.04) 100%);
    }
    
    /* This Week and Later cards - highlight colors */
    .this-week-card .card-header {
      background: linear-gradient(135deg, rgba(201, 162, 39, 0.08) 0%, rgba(201, 162, 39, 0.03) 100%);
    }
    [data-theme="dark"] .this-week-card .card-header {
      background: linear-gradient(135deg, rgba(201, 162, 39, 0.12) 0%, rgba(201, 162, 39, 0.04) 100%);
    }
    
    .later-card .card-header {
      background: linear-gradient(135deg, rgba(122, 154, 126, 0.08) 0%, rgba(122, 154, 126, 0.03) 100%);
    }
    [data-theme="dark"] .later-card .card-header {
      background: linear-gradient(135deg, rgba(122, 154, 126, 0.12) 0%, rgba(122, 154, 126, 0.04) 100%);
    }
    .anchors-card .card-header:hover { background: var(--ochre-bg); }
    [data-theme="dark"] .anchors-card .card-header { 
      background: var(--pastel-sky);
    }
    [data-theme="dark"] .anchors-card .card-header:hover { 
      background: var(--pastel-sky-deep);
    }
    
    /* WISDOM CARD - Gold header */
    .wisdom-card .card-header:hover { background: var(--ochre-bg); }
    .wisdom-card .card-header h3 { color: var(--warm); }
    [data-theme="dark"] .wisdom-card .card-header { 
      background: var(--pastel-butter);
    }
    [data-theme="dark"] .wisdom-card .card-header:hover { 
      background: var(--pastel-butter-deep);
    }
    
    /* Daily Wisdom - Clean reading design */
    .wisdom-card .card-content {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
      padding: var(--card-content-pad-top) 28px 28px; /* Consistent top padding using design token */
    }
    .wisdom-segmented-control {
      margin-bottom: var(--space-2); /* Additional spacing above selector */
    }
    .wisdom-segmented-control,
    .segmented-control {
      display: inline-flex;  /* MUST be inline-flex to wrap buttons only */
      width: fit-content; /* Wrap tightly around buttons */
      background: rgba(0, 0, 0, 0.08);
      border-radius: 10px;
      padding: 3px;
    }
    .wisdom-segmented-btn,
    .segmented-control button {
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 500;
      border-radius: 7px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .wisdom-segmented-btn.active,
    .segmented-control button.active {
      background: white;
      color: var(--text-primary);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    [data-theme="dark"] .wisdom-card .segmented-control,
    [data-theme="dark"] .wisdom-segmented-control {
      background: rgba(255, 255, 255, 0.08);
    }
    [data-theme="dark"] .wisdom-card .segmented-control button,
    [data-theme="dark"] .wisdom-segmented-btn {
      color: #B0A89E;
    }
    [data-theme="dark"] .wisdom-card .segmented-control button.active,
    [data-theme="dark"] .wisdom-segmented-btn.active {
      background: rgba(255, 255, 255, 0.15);
      color: #FAF8F5;
    }
    .wisdom-verse-block {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }
    .wisdom-reference {
      font-size: var(--text-xs);
      font-weight: var(--weight-semibold);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .wisdom-text {
      font-size: var(--text-base);
      line-height: var(--leading-relaxed);
      color: var(--text);
      max-width: 100%;
      line-height: 1.7;
    }
    .wisdom-next-btn {
      margin-top: var(--space-2);
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--border-strong);
      background: transparent;
      color: var(--text-muted);
      font-size: var(--text-sm);
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-1);
      width: fit-content;
      transition: all 0.2s ease-out;
    }
    .wisdom-next-btn:hover {
      border-color: var(--warm-border);
      color: var(--warm);
      background: var(--warm-hover);
    }
    .anchors-add-btn {
      width: 24px; height: 24px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-strong);
      background: var(--toggle-bg);
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease-out;
    }
    .anchors-add-btn:hover { background: var(--border-strong); color: var(--text); }
    .anchor-item {
      display: flex; align-items: center; justify-content: space-between; gap: var(--space-2);
      padding: var(--space-2) 0; border-bottom: 1px solid var(--border);
    }
    .anchor-text { flex: 1; font-size: var(--text-base); font-weight: var(--weight-medium); color: var(--text); line-height: var(--leading-normal); }
    .anchor-bullet {
      flex-shrink: 0;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      opacity: 0.6;
    }
    .anchor-bullet svg {
      width: 14px;
      height: 14px;
    }
    .anchor-actions { display: flex; gap: var(--space-1); opacity: 0; transition: opacity 0.2s; }
    .anchor-item:hover .anchor-actions { opacity: 1; }
    .anchor-edit, .anchor-delete {
      width: 20px; height: 20px;
      border: none; background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      border-radius: var(--radius-sm);
      transition: all 0.15s;
    }
    .anchor-edit:hover { background: var(--toggle-bg); color: var(--text); }
    .anchor-delete:hover { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
    .anchor-edit svg, .anchor-delete svg { width: 12px; height: 12px; }
    .anchor-edit-row, .anchor-add-row {
      display: flex; align-items: center; gap: var(--space-2);
      padding: var(--space-2) 0;
    }
    .anchor-edit-input, .anchor-add-input {
      flex: 1; padding: 6px 10px;
      border: 1px solid var(--border-strong);
      border-radius: var(--radius-sm);
      font-size: var(--text-sm);
      background: var(--toggle-bg);
      color: var(--text);
    }
    .anchor-edit-actions, .anchor-add-actions {
      display: flex; gap: var(--space-1);
    }
    .anchor-edit-confirm, .anchor-add-confirm,
    .anchor-edit-cancel, .anchor-add-cancel {
      width: 24px; height: 24px;
      border: none; background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      border-radius: var(--radius-sm);
      transition: all 0.15s;
    }
    .anchor-edit-confirm:hover, .anchor-add-confirm:hover {
      background: var(--pastel-mint); color: var(--rest);
    }
    .anchor-edit-cancel:hover, .anchor-add-cancel:hover {
      background: rgba(239, 68, 68, 0.1); color: #ef4444;
    }
    .anchor-edit-confirm svg, .anchor-add-confirm svg,
    .anchor-edit-cancel svg, .anchor-add-cancel svg {
      width: 14px; height: 14px;
    }
    
    .habit-item { 
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-subtle);
    }
    .habit-item:last-child { border-bottom: none; }
    .habit-item:hover { background: var(--toggle-bg); }
    .habit-item:hover .habit-delete { opacity: 1; }
    .habit-info {
      flex: 1;
      min-width: 0;
    }
    .habit-name {
      font-size: 14px;
      color: var(--text-primary);
      display: block;
    }
    .habit-name.done {
      text-decoration: line-through;
      color: var(--text-tertiary);
    }
    .habit-desc {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 2px;
      display: block;
    }
    /* Habit Streaks - Subtle visual continuity */
    .habit-streak {
      display: flex;
      gap: 3px;
      margin-left: auto;
      padding-left: var(--space-2);
    }
    .streak-dots {
      display: flex;
      gap: 4px;
      align-items: center;
    }
    .habit-streak-dot,
    .streak-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--border-default);
      transition: all 0.2s ease;
    }
    .habit-streak-dot.done,
    .streak-dot.done,
    .streak-dot.complete,
    .streak-dot.checked {
      background: var(--sage);
    }
    /* Today indicator */
    .streak-dot.today {
      transform: scale(1.2);
      box-shadow: 0 0 0 2px var(--surface-white), 0 0 0 3px var(--border-default);
    }
    .streak-dot.today.done {
      box-shadow: 0 0 0 2px var(--surface-white), 0 0 0 3px var(--sage);
    }
    .habit-delete { 
      opacity: 0; width: 24px; height: 24px; border: none; 
      background: transparent; color: var(--text-light); 
      cursor: pointer; display: flex; align-items: center; justify-content: center; 
      transition: all 0.2s ease-out; border-radius: var(--radius-sm); 
    }
    .habit-delete:hover { color: #ef4444; background: rgba(239, 68, 68, 0.1); }
    .habit-delete svg { width: 12px; height: 12px; }
    .habit-add-row {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2);
      margin: 0 calc(var(--space-2) * -1);
      background: var(--toggle-bg);
      border-radius: var(--radius-sm);
    }
    .habit-add-input {
      flex: 1;
      padding: var(--space-2);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: var(--text-sm);
      background: var(--card-bg);
      color: var(--text);
      outline: none;
    }
    .habit-add-input:focus { border-color: var(--rest-border); }
    .habit-add-actions { display: flex; gap: var(--space-1); }
    .habit-add-confirm, .habit-add-cancel {
      width: 28px; height: 28px;
      border-radius: var(--radius-sm);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease-out;
    }
    .habit-add-confirm { background: var(--rest); color: #fff; }
    .habit-add-confirm:hover { background: var(--rest-soft); }
    .habit-add-cancel { background: var(--toggle-bg); color: var(--text-muted); }
    .habit-add-cancel:hover { background: var(--border-strong); }
    .habit-add-confirm svg, .habit-add-cancel svg { width: 14px; height: 14px; }
    .habits-reset { display: flex; justify-content: flex-end; padding-top: var(--space-3); border-top: 1px solid var(--border); margin-top: var(--space-2); }
    .habits-reset-btn { 
       font-size: var(--text-xs); color: var(--text-light); 
      background: none; border: none; cursor: pointer; 
      padding: var(--space-1) var(--space-2); border-radius: var(--radius-sm); 
      display: flex; align-items: center; gap: var(--space-1); transition: all 0.2s ease-out; 
    }
    .habits-reset-btn:hover { color: var(--text-muted); background: var(--toggle-bg); }
    .habits-reset-btn svg { width: 12px; height: 12px; }
    
    /* SCHEDULE */
    .schedule-card {
      --schedule-label-width: 52px;
      --schedule-content-pad: 24px;
      /* Removed --schedule-block-left - blocks now align to content padding only */
    }
    .schedule-settings { display: flex; gap: 12px; padding: 0 24px 12px; border-bottom: 1px solid var(--border); flex-wrap: wrap; align-items: center; }
    .schedule-setting { display: flex; align-items: center; gap: 5px; font-size: 11px; color: var(--text-muted); }
    .schedule-setting select { padding: 4px 8px; border: 1px solid var(--border-strong); border-radius: 5px; font-size: 11px; background: var(--toggle-bg); color: var(--text); cursor: pointer; }
   /* SCHEDULE - Scrollable body, fixed header */
   .schedule-card .card-content.schedule-grid {
     padding: var(--card-content-pad-top) 24px 24px; /* Consistent top padding using design token */
      max-height: 780px;
      overflow-y: auto;
      overflow-x: hidden;
      scroll-behavior: smooth;
      scrollbar-width: thin;
      scrollbar-color: var(--border-strong) transparent;
      /* Add padding to prevent first label from being cropped */
      padding-top: 6px;
      padding-bottom: var(--space-2);
    }
    .schedule-card .card-content.schedule-grid::-webkit-scrollbar {
      width: 10px;
    }
    .schedule-card .card-content.schedule-grid::-webkit-scrollbar-track {
      background: transparent;
    }
    .schedule-card .card-content.schedule-grid::-webkit-scrollbar-thumb {
      background: rgba(196, 112, 75, 0.2);
      border-radius: 8px;
      border: 2px solid transparent;
      background-clip: padding-box;
    }
    .schedule-card .card-content.schedule-grid::-webkit-scrollbar-thumb:hover {
      background: rgba(196, 112, 75, 0.3);
      background-clip: padding-box;
    }
    [data-theme="dark"] .schedule-card .card-content.schedule-grid::-webkit-scrollbar-thumb {
      background: rgba(212, 132, 106, 0.3);
      background-clip: padding-box;
    }
    
    /* Consistent scrollbar styling for all scroll areas */
    /* WebKit scrollbars */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(196, 112, 75, 0.2);
      border-radius: 10px;
      border: 2px solid transparent;
      background-clip: padding-box;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(196, 112, 75, 0.3);
      background-clip: padding-box;
    }
    [data-theme="dark"] ::-webkit-scrollbar-thumb {
      background: rgba(212, 132, 106, 0.25);
    }
    [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
      background: rgba(212, 132, 106, 0.35);
    }
    
    /* Firefox scrollbars */
    * {
      scrollbar-width: thin;
      scrollbar-color: rgba(196, 112, 75, 0.2) transparent;
    }
    [data-theme="dark"] * {
      scrollbar-color: rgba(212, 132, 106, 0.25) transparent;
    }
    [data-theme="dark"] .schedule-card .card-content.schedule-grid::-webkit-scrollbar-thumb:hover {
      background: rgba(196, 112, 75, 0.35);
      background-clip: padding-box;
    }
    .schedule-header-date {
      font-size: var(--text-sm);
      color: var(--text-muted);
      font-weight: var(--weight-regular);
    }
    .schedule-reset-btn {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-sm);
      transition: all 0.15s ease-out;
    }
    .schedule-reset-btn:hover {
      background: var(--toggle-bg);
      color: var(--text);
    }
    .schedule-reset-btn svg {
      width: 14px;
      height: 14px;
    }
    .schedule-card .schedule-settings {
      position: sticky;
      top: 0;
      z-index: 20;
      background: var(--card-bg);
    }
    .schedule-grid { 
      position: relative;
      user-select: none;
      -webkit-user-select: none;
    }
    .schedule-grid.dragging { cursor: grabbing; }
    .schedule-hour { 
      display: flex; 
      border-bottom: 1px solid rgba(0,0,0,0.08);
      min-height: 64px; 
      position: relative; 
    }
    [data-theme="dark"] .schedule-hour { border-bottom-color: rgba(255,255,255,0.08); }
    .schedule-hour:last-child { border-bottom: none; }
    
    /* Grid line hierarchy: hour (border-bottom) > 30-min (medium) > 15/45-min (light)
       Hour lines: defined by .schedule-hour border-bottom (strongest)
       30-min line: at 50% (medium weight)
       15-min line: at 25% (lightest, between 0 and 30)
       45-min line: at 75% (lightest, between 30 and 60)
       5-min snapping: invisible (logic only) */
    .schedule-hour::before {
      content: '';
      position: absolute;
      left: var(--schedule-label-width);
      right: 0;
      top: 0;
      bottom: 0;
      background-image: 
        /* 30-min line at 50% - medium weight, clearly visible */
        linear-gradient(to bottom, 
          transparent 0%, transparent calc(50% - 0.5px), 
          rgba(59, 130, 246, 0.18) calc(50% - 0.5px), 
          rgba(59, 130, 246, 0.18) calc(50% + 0.5px), 
          transparent calc(50% + 0.5px)),
        /* 15-min line at 25% - lighter, between hour and 30-min */
        linear-gradient(to bottom, 
          transparent 0%, transparent calc(25% - 0.5px), 
          rgba(59, 130, 246, 0.08) calc(25% - 0.5px), 
          rgba(59, 130, 246, 0.08) calc(25% + 0.5px), 
          transparent calc(25% + 0.5px)),
        /* 45-min line at 75% - lighter, between 30-min and next hour */
        linear-gradient(to bottom, 
          transparent 0%, transparent calc(75% - 0.5px), 
          rgba(59, 130, 246, 0.08) calc(75% - 0.5px), 
          rgba(59, 130, 246, 0.08) calc(75% + 0.5px), 
          transparent calc(75% + 0.5px));
      pointer-events: none;
      z-index: 0;
    }
    [data-theme="dark"] .schedule-hour::before {
      background-image: 
        /* 30-min line - medium */
        linear-gradient(to bottom, 
          transparent 0%, transparent calc(50% - 0.5px), 
          rgba(96, 165, 250, 0.22) calc(50% - 0.5px), 
          rgba(96, 165, 250, 0.22) calc(50% + 0.5px), 
          transparent calc(50% + 0.5px)),
        /* 15-min line - light */
        linear-gradient(to bottom, 
          transparent 0%, transparent calc(25% - 0.5px), 
          rgba(96, 165, 250, 0.10) calc(25% - 0.5px), 
          rgba(96, 165, 250, 0.10) calc(25% + 0.5px), 
          transparent calc(25% + 0.5px)),
        /* 45-min line - light */
        linear-gradient(to bottom, 
          transparent 0%, transparent calc(75% - 0.5px), 
          rgba(96, 165, 250, 0.10) calc(75% - 0.5px), 
          rgba(96, 165, 250, 0.10) calc(75% + 0.5px), 
          transparent calc(75% + 0.5px));
    }
    
    .hour-label { 
      width: var(--schedule-label-width); 
      font-size: 10px; 
      color: var(--text-muted); 
      font-weight: 500; 
      padding: 0 8px 0 0; 
      text-align: right; 
      flex-shrink: 0; 
      z-index: 2; 
      background: var(--card-bg);
      line-height: 1;
      /* Align label baseline with hour line */
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;
      margin-top: -5px;
    }
    .hour-slots { flex: 1; position: relative; display: flex; flex-direction: column; }
    .quarter-slot { 
      flex: 1; 
      min-height: 16px; 
      border-left: 1px solid var(--border); 
      padding-left: 8px; 
      cursor: pointer; 
      display: flex; 
      align-items: center; 
      position: relative; 
      z-index: 1; 
      transition: background 0.15s ease-out; 
    }
    .quarter-slot:hover { background: var(--focus-hover); }
    .quarter-slot.has-block { pointer-events: none; }
    
   /* Schedule Event Blocks - SOLID FILLED with brand colors per mockup */
   .schedule-block {
      position: absolute;
      left: calc(var(--schedule-label-width) + var(--schedule-content-pad));
      right: var(--schedule-content-pad);
      background: var(--terracotta); /* Default: terracotta solid fill */
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      z-index: 5;
      overflow: hidden;
      transition: all 0.15s ease-out;
      box-shadow: var(--shadow-sm);
      display: flex;
      flex-direction: column;
      justify-content: center;
      color: white;
      /* No margin offset - position is calculated exactly */
    }
    /* Pseudo-element for extended hitbox on thin events */
    .schedule-block::before {
      content: '';
      position: absolute;
      inset: -4px -2px;
      z-index: -1;
    }
    /* Compact mode for short events (30 min or less) */
    .schedule-block.compact {
      flex-direction: row;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      min-height: 24px;
    }
    .schedule-block.compact .schedule-block-title {
      font-size: 11px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: white;
    }
    .schedule-block.compact .schedule-block-type {
      font-size: 9px;
      color: rgba(255,255,255,0.8);
      white-space: nowrap;
    }
    .schedule-block:hover {
      box-shadow: var(--shadow-md);
      transform: translateX(2px) translateY(-1px);
      filter: brightness(1.05);
    }
    .schedule-block:active {
      transform: scale(0.99);
    }
    .schedule-block-title {
      font-size: 12px;
      font-weight: 600;
      color: white;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.3;
    }
    .schedule-block-time {
      font-size: 10px;
      font-weight: 600;
      color: rgba(255,255,255,0.9);
      letter-spacing: 0.02em;
    }
    .schedule-block.compact .schedule-block-time {
      font-weight: 500;
      margin-right: 4px;
      color: rgba(255,255,255,0.85);
    }
    .schedule-block-meta {
      font-size: 10px;
      color: rgba(255,255,255,0.75);
      display: flex;
      align-items: center;
      gap: 2px;
      margin-top: 2px;
    }
    .schedule-block-meta svg {
      width: 10px;
      height: 10px;
      color: rgba(255,255,255,0.75);
    }
    
    /* Schedule Modal - Overlay + Centered Modal (dim-only, no blur) */
    .schedule-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.22);
      /* No backdrop blur - dim only for Edit Item modal */
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      opacity: 1;
      transition: opacity 180ms ease;
    }
    [data-theme="dark"] .schedule-modal-overlay { background: rgba(0, 0, 0, 0.38); }
    /* Closing animation */
    .schedule-modal-overlay.closing {
      opacity: 0;
    }
    .schedule-modal {
      background: var(--card-bg);
      border: 1px solid var(--border-strong);
      border-radius: 16px;
      /* Softer, Apple-like shadow stack (light mode) */
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
      width: 100%;
      max-width: 360px;
      max-height: calc(100vh - 40px);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transform: translateY(0) scale(1);
      opacity: 1;
      transition: transform 180ms ease, opacity 180ms ease;
    }
    [data-theme="dark"] .schedule-modal {
      /* Dark mode: present but not inky */
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.35), 0 2px 10px rgba(0, 0, 0, 0.22), 0 0 0 1px rgba(255,255,255,0.06);
    }
    /* Modal closing animation */
    .schedule-modal-overlay.closing .schedule-modal {
      transform: translateY(8px) scale(0.98);
      opacity: 0;
    }
    @keyframes modalPopIn { 
      from { opacity: 0; transform: scale(0.92) translateY(8px); } 
      to { opacity: 1; transform: scale(1) translateY(0); } 
    }
    .schedule-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 18px 14px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }
    .schedule-modal-title { font-size: 15px; font-weight: 600; color: var(--text); letter-spacing: -0.01em; }
    .schedule-modal-close {
      width: 26px; height: 26px;
      border: none;
      background: var(--toggle-bg);
      color: var(--text-muted);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease-out;
    }
    .schedule-modal-close:hover { background: var(--border-strong); color: var(--text); }
    .schedule-modal-close:focus-visible { 
      outline: none; 
      box-shadow: 0 0 0 2px var(--card-bg), 0 0 0 4px var(--focus); 
    }
    .schedule-modal-close svg { width: 13px; height: 13px; }
    .schedule-modal-content {
      padding: 16px 18px 12px;
      overflow-y: auto;
      flex: 1;
      position: relative;
    }
    .schedule-modal-content::after {
      content: '';
      position: sticky;
      bottom: 0;
      left: 0;
      right: 0;
      height: 20px;
      background: linear-gradient(to top, var(--card-bg) 0%, transparent 100%);
      pointer-events: none;
      display: block;
      margin-top: -20px;
    }
    .schedule-modal-field { margin-bottom: 14px; }
    .schedule-modal-checkbox-field {
      margin-top: var(--space-4);
      padding-top: var(--space-3);
      border-top: 1px solid var(--border);
    }
    .schedule-modal-checkbox-label {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-size: var(--text-sm);
      color: var(--text);
      cursor: pointer;
      text-transform: none;
      letter-spacing: normal;
      font-weight: var(--weight-regular);
    }
    .schedule-modal-checkbox-label input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--focus);
      cursor: pointer;
    }
    .schedule-modal-checkbox-label .checkbox-hint {
      color: var(--text-muted);
      font-size: var(--text-xs);
    }
    .schedule-modal-label { 
      font-size: 10px; 
      color: var(--text-muted); 
      margin-bottom: 6px; 
      display: block; 
      text-transform: uppercase; 
      letter-spacing: 0.06em;
      font-weight: 500;
    }
    .schedule-modal-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border-strong);
      border-radius: 8px;
      font-size: 14px;
      background: var(--toggle-bg);
      color: var(--text);
      outline: none;
      transition: all 0.15s ease-out;
    }
    .schedule-modal-input:focus { 
      border-color: var(--focus); 
      box-shadow: 0 0 0 3px var(--focus-hover);
    }
    .schedule-modal-input::placeholder { color: var(--text-muted); opacity: 0.7; }
    
    /* Consistent focus ring for all modal controls */
    .schedule-modal button:focus-visible,
    .schedule-modal select:focus-visible,
    .schedule-modal input:focus-visible {
      outline: none;
      box-shadow: 0 0 0 2px var(--card-bg), 0 0 0 4px var(--focus);
    }
    
    /* TIME Section - Apple Calendar-style layout */
    .time-section { margin-bottom: 16px; }
    .time-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    .time-row-label {
      font-size: 10px;
      font-weight: 500;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .time-row-end {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 10px;
      padding-left: 2px;
    }
    .time-row-end strong { color: var(--text); font-weight: 500; }
    .duration-section-label {
      font-size: 10px;
      font-weight: 500;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-top: 14px;
      margin-bottom: 8px;
    }
    .schedule-time-preview { font-size: 13px; color: var(--text); font-weight: 500; padding: 6px 0; }
    .duration-chips { display: flex; gap: 5px; flex-wrap: wrap; }
    .duration-chip {
      padding: 6px 12px;
      border: 1px solid var(--border-strong);
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      background: transparent;
      cursor: pointer;
      transition: all 0.15s ease-out;
    }
    .duration-chip:hover { border-color: var(--focus); color: var(--text); background: var(--focus-hover); }
    .duration-chip.active { border-color: var(--focus); color: var(--focus); background: var(--focus-hover); }
    .duration-chip:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--card-bg), 0 0 0 4px var(--focus); }
    .duration-custom { margin-top: 10px; }
    .duration-custom-input {
      width: 100%; 
      padding: 8px 12px; 
      border: 1px solid var(--border-strong);
      border-radius: 8px; 
      font-size: 13px; 
      background: var(--toggle-bg);
      color: var(--text); 
      outline: none;
      transition: all 0.15s ease-out;
    }
    .duration-custom-input:focus { border-color: var(--focus); box-shadow: 0 0 0 3px var(--focus-hover); }
    .duration-custom-input::placeholder { color: var(--text-muted); opacity: 0.6; }
    .schedule-modal-actions {
      display: flex;
      gap: 10px;
      padding: 14px 18px 16px;
      border-top: 1px solid var(--border);
      background: var(--toggle-bg);
      flex-shrink: 0;
      align-items: center;
    }
    .schedule-modal-btn {
      padding: 9px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease-out;
      white-space: nowrap;
    }
    .schedule-modal-btn.primary { 
      background: var(--focus); 
      color: #fff; 
      border: none;
      flex: 0 0 auto;
      min-width: 72px;
    }
    .schedule-modal-btn.primary:hover { background: var(--focus-soft); transform: translateY(-1px); }
    .schedule-modal-btn.primary:active { transform: translateY(0); }
    .schedule-modal-btn.primary:focus-visible { 
      outline: none; 
      box-shadow: 0 0 0 2px var(--toggle-bg), 0 0 0 4px var(--focus); 
    }
    .schedule-modal-btn.secondary { 
      background: transparent; 
      border: 1px solid var(--border-strong); 
      color: var(--text-muted);
      flex: 0 0 auto;
    }
    .schedule-modal-btn.secondary:hover { background: var(--card-bg); color: var(--text); }
    .schedule-modal-btn.secondary:focus-visible { 
      outline: none; 
      box-shadow: 0 0 0 2px var(--toggle-bg), 0 0 0 4px var(--focus); 
    }
    .schedule-modal-btn.danger { 
      background: transparent; 
      border: none; 
      color: var(--text-muted);
      font-weight: 400;
      flex: 1;
      text-align: center;
    }
    .schedule-modal-btn.danger:hover { color: #ef4444; }
    .schedule-modal-btn.danger.confirming { 
      color: #ef4444; 
      font-weight: 500;
      animation: dangerPulse 0.3s ease-out;
    }
    @keyframes dangerPulse { 
      0%, 100% { transform: scale(1); } 
      50% { transform: scale(1.02); } 
    }
    [data-theme="dark"] .schedule-modal-btn.danger:hover { color: #f87171; }
    [data-theme="dark"] .schedule-modal-btn.danger.confirming { color: #f87171; }
    
    /* Schedule Block Type Colors - SOLID FILLED */
    .schedule-block.type-task { 
      background: var(--terracotta); /* Solid terracotta for tasks */
    }
    .schedule-block.type-task .schedule-block-title { color: white; }
    .schedule-block.type-habit { 
      background: var(--sage); /* Solid sage for habits */
    }
    .schedule-block.type-habit .schedule-block-title { color: white; }
    /* Event type (custom blocks) use plum */
    .schedule-block.type-event,
    .schedule-block:not(.type-task):not(.type-habit) {
      background: var(--plum);
    }
    .schedule-block-type {
      font-size: 8px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: rgba(255,255,255,0.7);
      margin-top: 1px;
      display: flex;
      align-items: center;
      gap: 3px;
    }
    .schedule-block-type svg { width: 8px; height: 8px; color: rgba(255,255,255,0.7); }
    
    /* Modal Type Segmented Control - Apple-style */
    .schedule-modal-type-control {
      display: flex;
      gap: 0;
      background: var(--toggle-bg);
      border-radius: 10px;
      padding: 3px;
      margin-bottom: 16px;
      position: relative;
    }
    .schedule-modal-type-btn {
      flex: 1;
      padding: 8px 10px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 12px;
      font-weight: 500;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.18s ease-out;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      position: relative;
      z-index: 1;
    }
    .schedule-modal-type-btn svg { width: 13px; height: 13px; opacity: 0.7; transition: opacity 0.15s; }
    .schedule-modal-type-btn:hover { color: var(--text); }
    .schedule-modal-type-btn:hover svg { opacity: 1; }
    .schedule-modal-type-btn:focus-visible { 
      outline: none; 
      box-shadow: inset 0 0 0 2px var(--focus); 
    }
    .schedule-modal-type-btn.active { 
      background: var(--card-bg); 
      color: var(--text); 
      box-shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.06), inset 0 1px 0 rgba(255,255,255,0.1);
    }
    [data-theme="dark"] .schedule-modal-type-btn.active {
      box-shadow: 0 1px 3px rgba(0,0,0,0.25), 0 1px 2px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.05);
    }
    .schedule-modal-type-btn.active svg { opacity: 1; }
    .schedule-modal-type-btn.active.type-event { color: var(--focus); }
    .schedule-modal-type-btn.active.type-event svg { color: var(--focus); }
    .schedule-modal-type-btn.active.type-task { color: var(--accent); }
    .schedule-modal-type-btn.active.type-task svg { color: var(--accent); }
    .schedule-modal-type-btn.active.type-habit { color: var(--rest); }
    .schedule-modal-type-btn.active.type-habit svg { color: var(--rest); }
    
    /* Modal Item Picker */
    .schedule-modal-picker {
      margin-top: 8px;
    }
    .schedule-modal-picker-label {
      font-size: 10px;
      color: var(--text-muted);
      margin-bottom: 4px;
      display: block;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }
    .schedule-modal-picker select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border-strong);
      border-radius: 8px;
      font-size: 13px;
      background: var(--toggle-bg);
      color: var(--text);
      cursor: pointer;
      outline: none;
      transition: all 0.15s ease-out;
    }
    .schedule-modal-picker select:hover { border-color: var(--text-muted); }
    .schedule-modal-picker select:focus { border-color: var(--focus); box-shadow: 0 0 0 3px var(--focus-hover); }
    
    /* Start Time Picker - Apple-style segmented control */
    .start-time-picker {
      display: flex;
      gap: 4px;
      align-items: center;
    }
    .start-time-picker select {
      padding: 6px 8px;
      border: 1px solid var(--border-strong);
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      background: var(--toggle-bg);
      color: var(--text);
      cursor: pointer;
      outline: none;
      min-width: 48px;
      text-align: center;
      -webkit-appearance: none;
      appearance: none;
      transition: all 0.15s ease-out;
    }
    .start-time-picker select:hover { border-color: var(--text-muted); }
    .start-time-picker select:focus { border-color: var(--focus); box-shadow: 0 0 0 3px var(--focus-hover); }
    .start-time-picker .time-separator {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-muted);
      margin: 0 1px;
    }
    .start-time-picker .ampm-toggle {
      display: flex;
      background: var(--toggle-bg);
      border-radius: 8px;
      padding: 2px;
      border: 1px solid var(--border-strong);
      margin-left: 6px;
    }
    .start-time-picker .ampm-btn {
      padding: 5px 10px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.15s ease-out;
    }
    .start-time-picker .ampm-btn:hover { color: var(--text); }
    .start-time-picker .ampm-btn:focus-visible { outline: none; box-shadow: inset 0 0 0 2px var(--focus); }
    .start-time-picker .ampm-btn.active { 
      background: var(--card-bg); 
      color: var(--text); 
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
    }
    
    /* Version History Section */
    .version-history-section {
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    .version-history-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      cursor: pointer;
      transition: background 0.15s ease-out;
      border-radius: 6px;
      margin: 0 -8px;
      padding: 10px 8px;
    }
    .version-history-toggle:hover { background: var(--toggle-bg); }
    .version-history-toggle-text {
      font-size: 13px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .version-history-toggle-text svg { width: 16px; height: 16px; color: var(--accent); }
    .version-current {
      font-size: 11px;
      color: var(--accent);
      background: var(--accent-hover);
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: 500;
    }
    .version-history-content {
      margin-top: 12px;
    }
    .version-history-latest {
      margin-bottom: 16px;
    }
    .version-history-label {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 8px;
      font-weight: 500;
    }
    .version-history-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .version-history-list li {
      font-size: 12px;
      color: var(--text-muted);
      padding: 4px 0 4px 16px;
      position: relative;
    }
    .version-history-list li::before {
      content: '';
      position: absolute;
      left: 4px;
      color: var(--accent);
    }
    .version-history-expand {
      font-size: 11px;
      color: var(--text-muted);
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px 0;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: color 0.15s ease-out;
    }
    .version-history-expand:hover { color: var(--text); }
    .version-history-expand svg { width: 12px; height: 12px; transition: transform 0.15s ease-out; }
    .version-history-expand.expanded svg { transform: rotate(90deg); }
    .version-history-past {
      padding-top: 12px;
      border-top: 1px solid var(--border);
      margin-top: 12px;
    }
    .version-history-past-item {
      margin-bottom: 12px;
    }
    .version-history-past-version {
      font-size: 11px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 4px;
    }
    
    /* SCRIPTURE - Clean immersive design, no header bar */
    .scripture-card {
      background: linear-gradient(145deg, var(--surface-warm) 0%, var(--surface-white) 100%);
      border-radius: var(--card-radius);
      padding: 0;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    [data-theme="dark"] .scripture-card {
      background: linear-gradient(145deg, var(--card-bg) 0%, #2A2725 100%);
    }
    /* Terracotta accent bar at very top */
    .scripture-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--terracotta) 0%, var(--ochre) 100%);
      z-index: 2;
    }
    /* Large decorative quote mark */
    .scripture-card::after {
      content: '"';
      position: absolute;
      top: -20px;
      right: 30px;
      font-family: var(--font-display);
      font-size: 180px;
      color: var(--terracotta);
      opacity: 0.06;
      line-height: 1;
      pointer-events: none;
      z-index: 0;
    }
    /* Remove the old header completely */
    .scripture-card .card-header,
    .scripture-card .scripture-header {
      display: none;
    }
    /* Scripture body takes full card */
    .scripture-body {
      padding: 40px;
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 1;
    }
    /* Category pills at top */
    .scripture-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 32px;
    }
    /* Verse section - centered and fills space */
    .scripture-verse-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    /* Verse text - large elegant serif */
    .scripture-verse,
    .scripture-text {
      font-family: var(--font-display);
      font-size: 24px;
      font-weight: 400;
      font-style: italic;
      line-height: 1.55;
      color: var(--text-primary);
      margin-bottom: 16px;
    }
    /* Reference - terracotta color */
    .scripture-reference {
      font-family: var(--font-body);
      font-size: var(--text-base); /* 14px */
      font-weight: var(--weight-semibold); /* 600 */
      color: var(--terracotta); /* #C4704B - MUST be terracotta */
    }
    /* Ensure dark mode also uses terracotta (lifted version) */
    [data-theme="dark"] .scripture-reference {
      color: var(--terracotta); /* In dark mode this maps to #D4846A */
    }
    /* Reflection prompt area - NO border/divider for cleaner look */
    .scripture-prompt-area {
      margin-top: 32px;
      padding-top: 24px;
    }
    .scripture-prompt {
      font-size: 15px;
      color: var(--text-secondary);
      font-style: italic;
      margin-bottom: 16px;
    }
    /* Navigation buttons */
    .scripture-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    .scripture-nav-btn {
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-tertiary);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: color 0.2s ease;
    }
    .scripture-nav-btn:hover {
      color: var(--terracotta);
    }
    .scripture-header-left {
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    .scripture-header-pill {
      font-size: var(--text-xs);
      color: var(--text-light);
      padding: var(--space-1) var(--space-2);
      background: var(--toggle-bg);
      border-radius: var(--radius-full);
      font-weight: 400;
      font-style: italic;
    }
    .scripture-icon { color: var(--accent); }
    .scripture-icon svg { width: 20px; height: 20px; }
    .scripture-title { font-size: var(--text-lg); font-weight: var(--weight-semibold); letter-spacing: var(--tracking-tight); }
    .scripture-subtitle { font-size: var(--text-xs); color: var(--text-muted); font-weight: var(--weight-regular); display: none; }
    /* Legacy support for old structure */
    .selah-verse,
    .verse-text {
      font-family: var(--font-display);
      font-size: 24px;
      font-weight: 400;
      font-style: italic;
      line-height: 1.55;
      color: var(--text-primary);
    }
    .selah-reference,
    .verse-reference,
    .scripture-ref {
      font-family: var(--font-body);
      font-size: var(--text-base); /* 14px */
      font-weight: var(--weight-semibold); /* 600 */
      color: var(--terracotta); /* #C4704B - MUST be terracotta */
    }
    [data-theme="dark"] .scripture-ref {
      color: var(--terracotta); /* In dark mode this maps to #D4846A */
    }
    .scripture-ref svg { width: 10px; height: 10px; opacity: 0.7; }
    .scripture-ref-link { 
      text-decoration: none; 
      color: inherit; 
      display: inline-flex; 
      align-items: center; 
      gap: var(--space-1);
    }
    .scripture-ref-link:hover { text-decoration: underline; }
    /* Scripture reflection prompt */
    .scripture-prompt,
    .selah-prompt {
      font-size: 15px;
      font-style: italic;
      color: var(--text-secondary);
      margin-top: var(--space-5);
      padding-top: var(--space-4);
    }
    .scripture-btn { 
      margin: 0 var(--space-5) var(--space-5); 
      padding: var(--space-2) var(--space-4); 
      border: 1px solid rgba(0,0,0,0.08); 
      background: rgba(0,0,0,0.02); 
      color: var(--text-muted); 
      font-size: var(--text-sm); 
      font-weight: var(--weight-regular); 
      border-radius: var(--radius-full); 
      cursor: pointer; 
      display: inline-flex; 
      align-items: center; 
      gap: var(--space-2); 
      transition: all 0.2s ease-out; 
      position: relative; 
      z-index: 1;
    }
    [data-theme="dark"] .scripture-btn {
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.03);
    }
    .scripture-btn:hover { 
      border-color: var(--terracotta-border);
      color: var(--terracotta);
      background: var(--terracotta-bg);
    }
    [data-theme="dark"] .scripture-btn:hover {
      border-color: var(--terracotta-border);
      color: var(--terracotta);
      background: var(--terracotta-bg);
    }
    /* Subtle shimmer animation for Selah card (only if animations enabled) */
    @keyframes selahShimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .scripture-card {
      background-size: 200% 200%;
    }
    .reduce-motion .scripture-card {
      animation: none;
      background: var(--warm-hover);
      box-shadow: var(--shadow-lg);
      /* Fixed block: closed selector after rules, removed stray bracket */
    }
    .scripture-btn:focus-visible {
      outline: none;
      box-shadow: 0 0 0 2px var(--terracotta-border);
    }
    [data-theme="dark"] .scripture-btn:focus-visible {
      box-shadow: 0 0 0 2px var(--terracotta-border);
    }
    .scripture-btn svg { width: 14px; height: 14px; }
    .scripture-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: var(--space-5);
    }
    .scripture-category,
    .category-pill { 
      padding: 6px 14px;
      font-size: 12px;
      font-weight: 500;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-default);
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: capitalize;
    }
    .scripture-category:hover,
    .category-pill:hover {
      border-color: var(--terracotta-border);
      background: var(--terracotta-bg);
      color: var(--terracotta);
    }
    .scripture-category.active,
    .category-pill.active {
      background: var(--terracotta);
      border-color: var(--terracotta);
      color: white;
      padding-left: 10px; /* Make room for star */
    }
    /* Add star icon before active category text */
    .scripture-category.active::before,
    .category-pill.active::before {
      content: '';
      margin-right: 6px;
      font-size: 10px;
    }
    [data-theme="dark"] .scripture-category,
    [data-theme="dark"] .category-pill {
      border: 1px solid var(--border-default);
      background: transparent;
    }
    [data-theme="dark"] .scripture-category:hover,
    [data-theme="dark"] .category-pill:hover {
      border-color: var(--terracotta-border);
      background: var(--terracotta-bg);
      color: var(--terracotta);
    }
    
    /* REFLECTION - green zone with dots */
    .reflection-card { 
      position: relative; 
      max-width: 800px;
      transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
    }
    .reflection-card:hover {
      transform: translateY(var(--hover-lift-y)) scale(1.008);
      box-shadow: inset 0 1px 0 var(--card-inset-highlight), var(--hover-shadow);
    }
    .reflection-card .card-content {
      text-align: left;
      padding: var(--card-content-pad-top) 24px 24px; /* Consistent top padding using design token */
    }
    .reflection-card .dot-pattern { 
      opacity: 0.3; 
      background-image: radial-gradient(circle at center, rgba(16, 185, 129, 0.05) 1.2px, transparent 1.2px);
      transition: opacity 0.2s ease-out;
    }
    .reflection-card:hover .dot-pattern {
      opacity: 0.45;
    }
    .reflection-card {
      background: var(--surface-white);
      border-radius: var(--card-radius);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .reflection-card .card-header {
      display: none; /* Remove standard header */
    }
    .reflection-header {
      padding: 24px 24px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      text-align: center;
    }
    .reflection-title {
      font-family: var(--font-display);
      font-size: 24px;
      font-weight: var(--weight-medium);
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    .reflection-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }
    /* Reflection icon badge */
    .reflection-icon,
    .reflection-icon-badge {
      width: 48px;
      height: 48px;
      background: var(--sage); /* Sage green to match mockup */
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: var(--text-inverse);
      margin-bottom: var(--space-3);
    }
    /* In dark mode, use lifted sage */
    [data-theme="dark"] .reflection-icon,
    [data-theme="dark"] .reflection-icon-badge {
      background: var(--sage); /* Maps to lifted sage in dark mode */
    }
    .reflection-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      margin-bottom: 12px;
    }
    .reflection-icon svg,
    .reflection-icon-badge svg {
      width: 24px;
      height: 24px;
      color: white;
    }
    .reflection-title {
      font-family: var(--font-display);
      font-size: 22px;
      font-weight: 500;
      color: var(--text-primary);
    }
    .reflection-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
    }
    .reflection-body {
      flex: 1;
      padding: 24px;
      display: flex;
      flex-direction: column;
    }
    .reflection-step-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-tertiary);
      margin-bottom: 8px;
    }
    .reflection-question {
      font-family: var(--font-display);
      font-size: 20px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 16px;
    }
    .reflection-textarea {
      width: 100%;
      min-height: 120px;
      flex: 1;  /* Fill available space */
      padding: 16px;
      border: 1px solid rgba(44, 38, 32, 0.10);
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      color: var(--text-primary);
      background: #F5F2ED;
      resize: vertical;
    }
    
    .reflection-textarea:focus {
      outline: none;
      border-color: #7A9A7E;
      box-shadow: 0 0 0 3px rgba(122, 154, 126, 0.08);
    }
    
    [data-theme="dark"] .reflection-textarea {
      background: #1A1816;
      border-color: rgba(255, 255, 255, 0.12);
      color: #FAF8F5;
    }
    .reflection-textarea:focus {
      outline: none;
      border-color: var(--sage);
      box-shadow: 0 0 0 3px var(--sage-bg);
    }
    .reflection-footer {
      padding: 16px 24px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .reflection-progress {
      display: flex;
      gap: 6px;
    }
    .reflection-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--border-default);
    }
    .reflection-dot.active {
      background: var(--sage);
    }
    .reflection-dot.done {
      background: var(--sage-soft);
    }
    .reflection-actions {
      display: flex;
      gap: 8px;
    }
    .reflection-btn-skip {
      padding: 10px 20px;
      font-size: 13px;
      font-weight: 600;
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      cursor: pointer;
    }
    .reflection-btn-continue {
      padding: 10px 20px;
      font-size: 13px;
      font-weight: 600;
      background: var(--sage);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
    }
    /* Legacy support */
    .daily-reflection-card .card-header,
    .daily-reflection .card-header {
      background: var(--sage-bg);
      border-bottom-color: var(--sage-border);
    }
    .reflection-title {
      font-family: var(--font-display);
      font-size: 18px;
      font-weight: 500;
      color: var(--text-primary);
    }
    .reflection-btn,
    .begin-reflection-btn {
      background: #7A9A7E;  /* Sage green */
      color: white;
      padding: 14px 32px;
      border-radius: 10px;  /* Rounded rectangle, not pill */
      font-size: 14px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .reflection-btn:hover,
    .begin-reflection-btn:hover {
      background: #5E7E62;  /* Darker sage on hover */
      color: white;  /* MUST stay white */
      transform: translateY(-1px);
    }
    .reflection-date-nav {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .reflection-date-btn {
      width: 24px; height: 24px;
      border: none; background: var(--toggle-bg);
      border-radius: 5px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-muted);
      transition: all 0.15s ease-out;
    }
    .reflection-date-btn:hover { background: var(--border-strong); color: var(--text); }
    .reflection-date-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .reflection-date-btn svg { width: 12px; height: 12px; }
    .reflection-date-label { font-size: 11px; color: var(--text-muted); font-weight: 500; min-width: 80px; text-align: center; }
    .reflection-menu-btn {
      width: 28px; height: 28px;
      border: none; background: transparent;
      border-radius: 5px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-muted);
      transition: all 0.15s ease-out;
      position: relative;
      z-index: 10;
    }
    .reflection-menu-btn:hover { background: var(--toggle-bg); color: var(--text); }
    .reflection-menu-btn svg { width: 14px; height: 14px; }
    /* FIXED: Menu z-index and pointer-events */
    .reflection-menu-wrapper {
      position: relative;
      z-index: 100;
    }
    .reflection-menu {
      position: absolute;
      top: calc(100% + 4px); right: 0;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      min-width: 160px;
      z-index: 200;
      opacity: 0; 
      transform: translateY(-4px);
      pointer-events: none;
      visibility: hidden;
      transition: opacity 0.15s ease-out, transform 0.15s ease-out;
    }
    .reflection-menu.open { 
      opacity: 1; 
      transform: translateY(0); 
      pointer-events: auto; 
      visibility: visible;
    }
    .reflection-menu-item {
      padding: 10px 14px;
      font-size: 12px;
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.1s ease-out;
    }
    .reflection-menu-item:first-child { border-radius: 7px 7px 0 0; }
    .reflection-menu-item:last-child { border-radius: 0 0 7px 7px; }
    .reflection-menu-item:hover { background: var(--toggle-bg); }
    .reflection-menu-item.danger { color: #ef4444; }
    .reflection-menu-item.danger:hover { background: #fef2f2; }
    .reflection-menu-item svg { width: 14px; height: 14px; }
    .reflection-readonly-notice {
      background: var(--toggle-bg);
      padding: 8px 14px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      font-style: italic;
      border-bottom: 1px solid var(--border);
    }
    /* REFLECTION PROMPTS - EB Garamond for reflective questions */
    .reflection-prompt { 
      
      font-size: var(--text-lg); 
      color: var(--text); 
      margin-bottom: var(--space-2); 
      font-weight: 400;
      font-style: italic;
    }
    .reflection-input { 
      
      width: 100%; padding: var(--space-3); border: 1px solid var(--border); 
      border-radius: var(--radius-md); font-size: var(--text-sm); background: var(--toggle-bg); 
      color: var(--text); outline: none; resize: none; min-height: 70px; 
      line-height: var(--leading-normal); transition: all 0.2s ease-out; 
    }
    .reflection-input:focus { border-color: var(--rest); background: var(--card-bg); box-shadow: 0 0 0 3px var(--rest-hover); }
    .reflection-input::placeholder { color: var(--text-muted); font-style: normal; }
    .reflection-section { margin-bottom: var(--space-4); position: relative; z-index: 1; }
    .reflection-section:last-child { margin-bottom: 0; }
    .gratitude-section { 
      padding: var(--space-3); 
      background: linear-gradient(135deg, var(--rest-light) 0%, var(--rest-hover) 100%); 
      border-top: 1px solid var(--border); border-radius: 0 0 var(--radius-xl) var(--radius-xl); 
      position: relative; z-index: 1;
    }
    .gratitude-label {  font-size: var(--text-xs); color: var(--rest); font-weight: 600; text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: var(--space-2); display: flex; align-items: center; gap: var(--space-1); }
    .gratitude-label svg { width: 13px; height: 13px; }
    .gratitude-input { 
      
      width: 100%; padding: var(--space-2) var(--space-3); border: 1px solid var(--border); 
      border-radius: var(--radius-sm); font-size: var(--text-sm); background: var(--card-bg); 
      color: var(--text); outline: none; transition: all 0.2s ease-out; 
    }
    .gratitude-input:focus { border-color: var(--rest); box-shadow: 0 0 0 3px var(--rest-hover); }
    
    /* D) DAILY REFLECTION PROGRESSIVE FLOW */
    .reflection-icon-badge {
      width: 56px;
      height: 56px;
      background: var(--sage);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      margin-bottom: 16px;
    }
    .reflection-icon-badge svg {
      width: 28px;
      height: 28px;
    }
    .reflection-start {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 24px;
      text-align: center;
      flex: 1;
    }
    .reflection-start-title {
      font-family: var(--font-display);
      font-size: 24px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    .reflection-start-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }
    /* REFLECTIVE PROMPT - matches Be Still prompt styling */
    .reflection-start-prompt {
      font-size: var(--text-lg); 
      color: var(--text-muted); 
      font-style: italic; 
      line-height: var(--leading-relaxed);
      margin-bottom: var(--space-4);
      letter-spacing: var(--tracking-normal);
    }
    .reflection-start-btn {
      padding: 12px 28px;
      font-size: 14px;
      font-weight: 600;
      background: var(--sage);
      color: white;
      border: none;
      border-radius: var(--radius-full);
      cursor: pointer;
      transition: all 0.2s ease;
      cursor: pointer;
      transition: all 0.2s ease-out;
    }
    .reflection-start-btn:hover {
      background: var(--sage-dark);
      transform: translateY(-1px);
    }
    
    /* Grace affirmation panel */
    .reflection-grace {
      padding: var(--space-6);
    }
    .grace-panel {
      background: var(--pastel-mint);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      margin-bottom: var(--space-4);
      text-align: center;
    }
    /* GRACE MESSAGE - EB Garamond for spiritual affirmation */
    .grace-message {
      
      font-size: var(--text-lg);
      color: var(--text);
      margin-bottom: var(--space-3);
      line-height: var(--leading-normal);
    }
    .grace-tasks-list {
      text-align: left;
      margin-top: var(--space-3);
    }
    .grace-task-item {
      
      font-size: var(--text-sm);
      color: var(--text-muted);
      padding: var(--space-2) 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }
    .grace-task-item:last-child { border-bottom: none; }
    .grace-task-item svg { width: 12px; height: 12px; color: var(--rest); flex-shrink: 0; }
    .grace-more {
      
      font-size: var(--text-xs);
      color: var(--text-muted);
      font-style: normal;
      margin-top: var(--space-2);
    }
    
    /* Stepper flow */
    .reflection-stepper {
      padding: 32px 40px;
      display: flex;
      flex-direction: column;
      height: 100%;  /* Fill vertical space */
    }
    
    .reflection-stepper-header {
      margin-bottom: 24px;
    }
    
    .reflection-stepper-title {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 26px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 4px;
    }
    
    .reflection-stepper-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
    }
    .stepper-progress {
      display: flex;
      justify-content: center;
      gap: var(--space-2);
      margin-bottom: var(--space-4);
    }
    .stepper-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-tertiary);
      margin-bottom: 12px;
    }
    .stepper-question {
      font-size: 16px;
      font-weight: 600;
      color: #7A9A7E;  /* SAGE GREEN */
      margin-bottom: 16px;
    }
    [data-theme="dark"] .reflection-card .stepper-question,
    [data-theme="dark"] .stepper-question {
      color: #8FAD93;  /* Sage soft */
    }
    .stepper-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--border-default);
      transition: background 0.2s ease;
    }
    .stepper-dot.active {
      background: var(--sage);
    }
    .stepper-dot.done {
      background: var(--sage-soft);
    }
    .stepper-step {
      animation: fadeSlideIn 0.25s ease-out;
    }
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateX(10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .stepper-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 20px;
      margin-top: auto;
    }
    .stepper-dots {
      display: flex;
      gap: 6px;
    }
    .stepper-actions {
      display: flex;
      gap: 8px;
    }
    .stepper-btn-skip {
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 600;
      background: transparent;
      color: var(--terracotta);
      border: 1px solid var(--terracotta);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .stepper-btn-skip:hover {
      background: var(--terracotta-bg);
    }
    .stepper-btn-continue {
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 600;
      background: var(--sage);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .stepper-btn-continue:hover {
      background: var(--sage-deep);
      transform: translateY(-1px);
    }
    /* Legacy support */
    .stepper-nav {
      display: flex;
      justify-content: space-between;
      margin-top: var(--space-4);
      gap: var(--space-3);
    }
    .stepper-btn {
      padding: var(--space-2) var(--space-4);
      border: 1px solid var(--border-strong);
      background: var(--toggle-bg);
      color: var(--text);
      border-radius: var(--radius-md);
      font-size: var(--text-sm);
      cursor: pointer;
      transition: all 0.15s ease-out;
    }
    .stepper-btn:hover { background: var(--border-strong); }
    .stepper-btn.primary {
      background: var(--rest);
      border-color: var(--rest);
      color: #fff;
    }
    .stepper-btn.primary:hover { background: var(--rest-soft); }
    
    /* D) Export panel - Calm, understated completion */
    .reflection-export {
      padding: var(--space-6);
      text-align: center;
    }
    .export-success {
      background: var(--pastel-mint);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      margin-bottom: var(--space-4);
    }
    .export-success-icon {
      width: 24px; height: 24px;
      background: var(--rest);
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto var(--space-2);
    }
    .export-success-icon svg { width: 12px; height: 12px; }
    .export-success-text {
      font-size: var(--text-sm);
      color: var(--text);
    }
    .export-actions {
      display: flex;
      gap: var(--space-3);
      justify-content: center;
    }
    /* Export buttons match scripture-btn (Next button) style */
    .export-btn {
      padding: var(--space-2) var(--space-4);
      border: 1px solid var(--border-strong);
      background: transparent;
      color: var(--text-muted);
      font-size: var(--text-sm);
      font-weight: var(--weight-medium);
      border-radius: var(--radius-md);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
    }
    .export-btn:hover { border-color: var(--rest); color: var(--rest); background: var(--rest-hover); }
    .export-btn svg { width: 12px; height: 12px; }
    .export-btn.primary {
      background: var(--rest);
      border-color: var(--rest);
      color: #fff;
    }
    .export-btn.primary:hover { background: var(--rest-soft); }
    
    /* BE STILL CARD - From Design System Step 14 */
    .bestill-card {
      background: linear-gradient(145deg, var(--sage-soft) 0%, var(--sage) 100%);
      /* #8FAD93  #7A9A7E */
      border-radius: var(--radius-xl);
      padding: var(--space-10);
      color: var(--text-inverse);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .bestill-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 50% 30%, rgba(255,255,255,0.15) 0%, transparent 60%);
      pointer-events: none;
    }
    [data-theme="dark"] .bestill-card,
    .dark .bestill-card,
    .bestill-card.dark {
      background: linear-gradient(145deg, #5E7E62 0%, #4A6B4E 100%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), var(--card-shadow);
      border-color: rgba(255, 255, 255, 0.08);
    }
    
    /* Ensure white text has good contrast in dark mode */
    [data-theme="dark"] .bestill-title,
    [data-theme="dark"] .bestill-subtitle,
    [data-theme="dark"] .bestill-message {
      color: white;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);  /* Subtle shadow for readability */
    }
    /* Hover: unified with header - stroke + shadow + lift all animate together */
    .bestill-card:hover {
      transform: translateY(var(--hover-lift-y)) scale(1.005);
      box-shadow: 
        inset 0 1px 0 rgba(255,255,255,0.90),
        0 18px 48px rgba(15,23,42,0.14), 
        0 6px 18px rgba(15,23,42,0.08);
      border-color: var(--sage-border);
      outline-color: var(--sage-bg);
    }
    [data-theme="dark"] .bestill-card:hover {
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.10), var(--hover-shadow);
      border-color: var(--sage-border);
      outline-color: var(--sage-bg);
    }
    /* Remove purple overlay - sage gradient is sufficient */
    .bestill-card::before {
      content: '';
      position: absolute;
      inset: 0;
      opacity: 0;
      pointer-events: none;
      z-index: 0;
    }
    .bestill-card > * {
      position: relative;
      z-index: 1;
    }
    /* Remove Be Still card header - immersive design */
    .bestill-card .card-header {
      display: none;
    }
    /* Dot pattern for Be Still */
    .bestill-card .dot-pattern {
      opacity: 0.5;
      --dot-color: rgba(16, 185, 129, 0.12);
      transition: opacity 220ms ease;
    }
    [data-theme="dark"] .bestill-card .dot-pattern {
      opacity: 0.4;
      --dot-color: rgba(52, 211, 153, 0.10);
    }
    .bestill-card:hover .dot-pattern {
      opacity: 0.7;
    }
    [data-theme="dark"] .bestill-card:hover .dot-pattern {
      opacity: 0.55;
    }
    .header-dots {
      display: flex;
      gap: 3px;
      opacity: 0.4;
    }
    .header-dots span {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: currentColor;
    }
    .bestill-card .header-dots span {
      background: var(--accent);
    }
    
    /* Be Still content - improved contrast */
    .bestill-content {
      padding: 40px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      flex: 1;
      position: relative;
      z-index: 1;
    }
    .bestill-icon {
      width: 64px;
      height: 64px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      margin: 0 auto var(--space-6);
      position: relative;
      z-index: 1;
    }
    .bestill-title {
      font-family: var(--font-display);
      font-size: var(--text-4xl); /* 32px */
      font-weight: var(--weight-medium);
      margin-bottom: var(--space-3);
      position: relative;
      z-index: 1;
    }
    .bestill-subtitle {
      font-size: var(--text-lg); /* 16px */
      color: rgba(255, 255, 255, 0.85);
      line-height: var(--leading-relaxed);
      margin-bottom: var(--space-8);
      position: relative;
      z-index: 1;
    }
    .bestill-prompt {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.75);
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }
    .bestill-btn {
      padding: var(--space-4) var(--space-8);
      background: var(--text-inverse); /* white */
      color: var(--sage-deep); /* #5E7E62 */
      font-size: var(--text-base);
      font-weight: var(--weight-semibold);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--hover-transition);
      position: relative;
      z-index: 1;
    }
    .bestill-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }
    .bestill-btn.secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      padding: var(--space-2) var(--space-4);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .bestill-btn.secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    .bestill-btn.text-only {
      background: transparent;
      color: rgba(255, 255, 255, 0.7);
      padding: var(--space-1) var(--space-3);
      font-size: var(--text-xs);
    }
    .bestill-btn.text-only:hover { color: white; }
    
    /* Breathing Phase - New Design */
    .bestill-breathing {
      padding: 48px 40px;
      text-align: center;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .breathing-ring {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      margin-bottom: 32px;
    }
    
    .breathing-ring svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .breathing-ring .ring-track {
      fill: none;
      stroke: rgba(255, 255, 255, 0.2);
      stroke-width: 4;
    }
    
    .breathing-ring .ring-progress {
      fill: none;
      stroke: white;
      stroke-width: 4;
      stroke-linecap: round;
      transform: rotate(-90deg);
      transform-origin: center;
    }
    
    .breathing-countdown {
      font-family: var(--font-display);
      font-size: 96px;
      font-weight: 400;
      color: white;
      line-height: 1;
      position: relative;
      z-index: 1;
    }
    
    .breathing-count-inner {
      font-family: var(--font-display);
      font-size: 72px;
      font-weight: 400;
      color: white;
      line-height: 1;
      position: relative;
      z-index: 1;
    }
    
    .breathing-ring-svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .breathing-ring-track {
      fill: none;
      stroke: rgba(255, 255, 255, 0.2);
      stroke-width: 4;
    }
    
    .breathing-ring-progress {
      fill: none;
      stroke: white;
      stroke-width: 4;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.3s ease;
    }
    
    .breathing-instruction {
      font-family: var(--font-display);
      font-size: 24px;
      font-weight: 500;
      color: white;
      margin-bottom: 8px;
    }
    
    .breathing-duration {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
    }
    .breathing-skip {
      font-size: 11px;
      color: var(--text-muted);
      cursor: pointer;
      margin-top: 8px;
    }
    .breathing-skip:hover { color: var(--text); }
    
    /* Reduced motion breathing */
    .breathing-reduced {
      padding: var(--space-8) var(--space-5);
      text-align: center;
    }
    .breathing-reduced-steps {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--space-3);
      
      font-size: var(--text-base);
      color: var(--text);
      margin-bottom: var(--space-5);
      flex-wrap: wrap;
    }
    .breathing-reduced-step {
      padding: var(--space-2) var(--space-3);
      background: var(--pastel-lavender);
      border-radius: var(--radius-md);
      font-weight: 500;
    }
    .breathing-reduced-arrow { color: var(--text-muted); }
    
    /* Encouragement & Prayer Phase - SPIRITUAL CONTENT */
    .bestill-message-screen {
      padding: 56px 40px 40px;
      text-align: center;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .bestill-section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 600;
      margin-bottom: 24px;
    }
    
    .bestill-encouragement,
    .bestill-prayer {
      padding: 56px 40px 40px;
      text-align: center;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .encouragement-message,
    .prayer-text {
      font-family: var(--font-display);
      font-size: 22px;
      line-height: 1.5;
      color: white;
      font-style: italic;
      margin-bottom: 16px;
      max-width: 320px;
    }
    
    .encouragement-reference,
    .prayer-reference {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 500;
      margin-bottom: 40px;
    }
    
    .bestill-actions {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    /* Animation for breathing (respects reduced-motion) */
    @keyframes breathePulse {
      0%, 100% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.05); opacity: 1; }
    }
    .breathing-instruction {
      animation: breathePulse 4s ease-in-out infinite;
    }
    @media (prefers-reduced-motion: reduce) {
      .breathing-instruction { animation: none; }
    }
    .reduce-motion .breathing-instruction { animation: none; }
    
    /* ========================================
       PRAYER & GRATITUDE CARD - v0.9.43
       Combined spiritual feature for Rest tab
       ======================================== */
    .prayer-gratitude-card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      box-shadow: var(--card-shadow);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border: 1px solid var(--card-border);
    }
    .prayer-gratitude-card .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      background: linear-gradient(135deg, rgba(122, 154, 126, 0.08) 0%, rgba(201, 162, 39, 0.04) 100%);
      border-bottom: 1px solid var(--border);
    }
    [data-theme="dark"] .prayer-gratitude-card .card-header {
      background: linear-gradient(135deg, rgba(122, 154, 126, 0.12) 0%, rgba(201, 162, 39, 0.06) 100%);
    }
    .prayer-gratitude-card .card-icon-group {
      display: flex;
      position: relative;
      width: 40px;
      height: 40px;
    }
    .prayer-gratitude-card .card-icon-primary {
      width: 32px;
      height: 32px;
      background: var(--sage);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      right: 0;
      top: 0;
      z-index: 2;
    }
    .prayer-gratitude-card .card-icon-secondary {
      width: 20px;
      height: 20px;
      background: var(--ochre);
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      left: 0;
      bottom: 0;
      border: 2px solid var(--card-bg);
      z-index: 3;
    }
    .prayer-gratitude-card .card-icon-primary svg {
      width: 16px;
      height: 16px;
      color: white;
    }
    .prayer-gratitude-card .card-icon-secondary svg {
      width: 10px;
      height: 10px;
      color: white;
    }
    .prayer-gratitude-card .card-header-text {
      flex: 1;
      margin-left: 2px;
    }
    .prayer-gratitude-card .card-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
    }
    .prayer-gratitude-card .card-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }
    
    /* Mode Toggle */
    .pg-mode-toggle {
      display: flex;
      background: var(--toggle-bg);
      border-radius: var(--radius-md);
      padding: 3px;
      margin-bottom: 16px;
    }
    .pg-mode-btn {
      flex: 1;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 500;
      border: none;
      background: transparent;
      color: var(--text-muted);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      position: relative;
    }
    .pg-mode-btn .pg-streak {
      position: absolute;
      right: 8px;
      margin-left: 0;
    }
    .pg-mode-btn:hover {
      color: var(--text);
    }
    .pg-mode-btn.active {
      background: var(--card-bg);
      color: var(--text);
      box-shadow: var(--shadow-sm);
    }
    .pg-mode-btn.active.prayer {
      color: var(--sage);
    }
    .pg-mode-btn.active.gratitude {
      color: var(--ochre);
    }
    .pg-mode-btn svg {
      width: 14px;
      height: 14px;
    }
    
    /* Card Content */
    .pg-content {
      padding: 16px 20px 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    
    /* Quick Entry */
    .pg-quick-entry {
      display: flex;
      gap: 8px;
      margin-bottom: 14px;
    }
    .pg-input {
      flex: 1;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 13px;
      font-family: var(--font-body);
      background: var(--toggle-bg);
      color: var(--text);
    }
    .pg-input:focus {
      outline: none;
      border-color: var(--sage);
      box-shadow: 0 0 0 3px var(--sage-bg);
      background: var(--card-bg);
    }
    .pg-input.gratitude-mode:focus {
      border-color: var(--ochre);
      box-shadow: 0 0 0 3px var(--ochre-bg);
    }
    .pg-input::placeholder {
      color: var(--text-muted);
    }
    .pg-add-btn {
      padding: 10px 14px;
      background: var(--sage);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    .pg-add-btn:hover {
      background: var(--sage-deep);
    }
    .pg-add-btn.gratitude-mode {
      background: var(--ochre);
    }
    .pg-add-btn.gratitude-mode:hover {
      background: var(--ochre-deep);
    }
    
    /* Prayer List */
    .pg-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
      overflow-y: auto;
      min-height: 120px;
      max-height: 260px;
    }
    .pg-item {
      background: var(--toggle-bg);
      border-radius: var(--radius-md);
      padding: 10px 12px;
      transition: all 0.15s ease;
    }
    .pg-item:hover {
      background: var(--hover-bg);
    }
    .pg-item.answered {
      background: var(--sage-bg);
      border: 1px solid rgba(122, 154, 126, 0.15);
    }
    .pg-item.releasing {
      background: var(--plum-bg);
      border: 1px solid rgba(107, 74, 107, 0.15);
    }
    .pg-item-header {
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    .pg-checkbox {
      width: 18px;
      height: 18px;
      border: 2px solid var(--border-strong);
      border-radius: 50%;
      flex-shrink: 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      margin-top: 1px;
    }
    .pg-checkbox:hover {
      border-color: var(--sage);
      background: var(--sage-bg);
    }
    .pg-checkbox.checked {
      background: var(--sage);
      border-color: var(--sage);
    }
    .pg-checkbox.checked svg {
      width: 10px;
      height: 10px;
      color: white;
    }
    .pg-checkbox.releasing {
      background: var(--plum);
      border-color: var(--plum);
    }
    .pg-item-text {
      flex: 1;
      font-size: 13px;
      color: var(--text);
      line-height: 1.4;
    }
    .pg-item.answered .pg-item-text {
      color: var(--sage-deep);
    }
    .pg-item.releasing .pg-item-text {
      color: var(--plum);
      font-style: italic;
    }
    .pg-item-actions {
      display: flex;
      gap: 2px;
      opacity: 0;
      transition: opacity 0.15s ease;
    }
    .pg-item:hover .pg-item-actions {
      opacity: 1;
    }
    .pg-item-action {
      width: 22px;
      height: 22px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .pg-item-action:hover {
      background: var(--border);
      color: var(--text);
    }
    .pg-item-action.delete:hover {
      background: var(--terracotta-bg);
      color: var(--terracotta);
    }
    .pg-item-action svg {
      width: 12px;
      height: 12px;
    }
    .pg-item-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
      padding-left: 28px;
      font-size: 10px;
      color: var(--text-muted);
    }
    .pg-item-date {
      display: flex;
      align-items: center;
      gap: 3px;
    }
    .pg-item-date svg {
      width: 10px;
      height: 10px;
    }
    .pg-category {
      padding: 2px 6px;
      background: var(--card-bg);
      border-radius: 3px;
      font-weight: 500;
      text-transform: capitalize;
    }
    .pg-category.family { color: var(--terracotta); background: var(--terracotta-bg); }
    .pg-category.personal { color: var(--plum); background: var(--plum-bg); }
    .pg-category.work { color: var(--ochre); background: var(--ochre-bg); }
    .pg-category.others { color: var(--sage); background: var(--sage-bg); }
    
    /* Answered Badge */
    .pg-answered-badge {
      display: flex;
      align-items: center;
      gap: 3px;
      font-size: 10px;
      font-weight: 600;
      color: var(--sage);
      background: var(--card-bg);
      padding: 2px 6px;
      border-radius: 3px;
    }
    .pg-answered-badge svg {
      width: 10px;
      height: 10px;
    }
    
    /* Releasing Badge */
    .pg-releasing-badge {
      display: flex;
      align-items: center;
      gap: 3px;
      font-size: 10px;
      font-weight: 600;
      color: var(--plum);
      background: var(--card-bg);
      padding: 2px 6px;
      border-radius: 3px;
    }
    
    /* Gratitude Note */
    .pg-gratitude-note {
      margin-top: 8px;
      padding: 8px 10px;
      background: var(--card-bg);
      border-radius: var(--radius-sm);
      border-left: 3px solid var(--ochre);
      margin-left: 28px;
    }
    .pg-gratitude-note-label {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--ochre);
      font-weight: 600;
      margin-bottom: 3px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .pg-gratitude-note-label svg {
      width: 10px;
      height: 10px;
    }
    .pg-gratitude-note-text {
      font-size: 12px;
      font-style: italic;
      color: var(--text-secondary);
    }
    .pg-gratitude-note-input {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 12px;
      font-family: var(--font-body);
      font-style: italic;
      background: var(--card-bg);
      color: var(--text);
      margin-top: 4px;
    }
    .pg-gratitude-note-input:focus {
      outline: none;
      border-color: var(--ochre);
    }
    .pg-gratitude-note-input::placeholder {
      color: var(--text-muted);
    }
    
    /* Gratitude Entries */
    .pg-gratitude-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 12px;
      background: var(--ochre-bg);
      border-radius: var(--radius-md);
    }
    .pg-gratitude-bullet {
      width: 6px;
      height: 6px;
      background: var(--ochre);
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 5px;
    }
    .pg-gratitude-text {
      flex: 1;
      font-size: 13px;
      color: var(--text);
    }
    .pg-gratitude-remove {
      width: 18px;
      height: 18px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    .pg-gratitude-item:hover .pg-gratitude-remove {
      opacity: 1;
    }
    .pg-gratitude-remove:hover {
      color: var(--terracotta);
      background: var(--terracotta-bg);
    }
    .pg-gratitude-remove svg {
      width: 12px;
      height: 12px;
    }
    
    /* Streak Display */
    .pg-streak {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: var(--ochre);
      font-weight: 600;
      margin-left: auto;
    }
    .pg-streak svg {
      width: 12px;
      height: 12px;
    }
    
    /* Empty State */
    .pg-empty {
      text-align: center;
      padding: 24px 12px;
      color: var(--text-muted);
    }
    .pg-empty-icon {
      width: 40px;
      height: 40px;
      margin: 0 auto 10px;
      background: var(--sage-bg);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .pg-empty-icon.gratitude {
      background: var(--ochre-bg);
    }
    .pg-empty-icon svg {
      width: 20px;
      height: 20px;
      color: var(--sage);
    }
    .pg-empty-icon.gratitude svg {
      color: var(--ochre);
    }
    .pg-empty-title {
      font-size: 13px;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 4px;
    }
    .pg-empty-text {
      font-size: 12px;
    }
    
    /* Tabs */
    .pg-tabs {
      display: flex;
      gap: 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 12px;
    }
    .pg-tab {
      padding: 8px 10px;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      border: none;
      background: transparent;
      cursor: pointer;
      position: relative;
      transition: color 0.2s ease;
    }
    .pg-tab:hover {
      color: var(--text-secondary);
    }
    .pg-tab.active {
      color: var(--sage);
    }
    .pg-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--sage);
      border-radius: 1px;
    }
    .pg-tab-count {
      background: var(--toggle-bg);
      padding: 1px 5px;
      border-radius: 8px;
      font-size: 10px;
      margin-left: 4px;
    }
    .pg-tab.active .pg-tab-count {
      background: var(--sage-bg);
      color: var(--sage);
    }
    
    /* Section Headers */
    .pg-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .pg-section-title {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      font-weight: 600;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .pg-section-title svg {
      width: 12px;
      height: 12px;
    }
    .pg-section-title.prayer { color: var(--sage); }
    .pg-section-title.gratitude { color: var(--ochre); }
    
    /* Category Selector */
    .pg-category-selector {
      display: flex;
      gap: 4px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .pg-category-btn {
      padding: 4px 10px;
      font-size: 11px;
      font-weight: 500;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-muted);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .pg-category-btn:hover {
      border-color: var(--sage);
      color: var(--sage);
    }
    .pg-category-btn.active {
      background: var(--sage);
      border-color: var(--sage);
      color: white;
    }
    .pg-category-btn.active.family {
      background: var(--terracotta);
      border-color: var(--terracotta);
    }
    .pg-category-btn.active.personal {
      background: var(--plum);
      border-color: var(--plum);
    }
    .pg-category-btn.active.work {
      background: var(--ochre);
      border-color: var(--ochre);
    }
    
    /* Action Menu Dropdown */
    .pg-action-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      padding: 4px;
      z-index: 100;
      min-width: 130px;
    }
    .pg-action-menu-item {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      padding: 8px 10px;
      border: none;
      background: transparent;
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
      border-radius: 5px;
      text-align: left;
    }
    .pg-action-menu-item:hover {
      background: var(--toggle-bg);
    }
    .pg-action-menu-item.answered {
      color: var(--sage);
    }
    .pg-action-menu-item.releasing {
      color: var(--plum);
    }
    .pg-action-menu-item.delete {
      color: var(--terracotta);
    }
    .pg-action-menu-item svg {
      width: 12px;
      height: 12px;
    }
    
    /* SETTINGS MODAL */
    .settings-overlay { 
      position: fixed; 
      inset: 0; 
      background: rgba(0,0,0,0.3);
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px); 
      z-index: 500;
      opacity: 0; 
      pointer-events: none; 
      transition: opacity 0.2s ease-out;
      will-change: opacity;
    }
    [data-theme="dark"] .settings-overlay { background: rgba(0,0,0,0.5); }
    .settings-overlay.show { opacity: 1; pointer-events: auto; }
    .settings-modal { 
      position: fixed; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%) scale(0.96) translateY(8px); 
      background: var(--card-bg); 
      border: 1px solid var(--card-border); 
      border-radius: 16px; 
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.18), 0 4px 16px rgba(0, 0, 0, 0.10);
      z-index: 501; 
      width: 90%; 
      max-width: 440px; 
      max-height: 85vh; 
      overflow: hidden; 
      opacity: 0; 
      pointer-events: none; 
      transition: opacity 0.22s ease-out, transform 0.22s cubic-bezier(0.34, 1.4, 0.64, 1);
      will-change: opacity, transform;
      display: flex;
      flex-direction: column;
    }
    [data-theme="dark"] .settings-modal {
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.45), 0 4px 16px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255,255,255,0.04);
    }
    .settings-overlay.show + .settings-modal, .settings-modal.show { 
      opacity: 1; 
      pointer-events: auto; 
      transform: translate(-50%, -50%) scale(1) translateY(0); 
    }
    .settings-header { 
      padding: 16px 20px; 
      border-bottom: 1px solid var(--border); 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      position: relative;
    }
    .settings-header h2 { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
    .settings-header h2 svg { width: 18px; height: 18px; color: var(--text-muted); }
    .settings-close { 
      width: 28px; height: 28px; border: none; 
      background: var(--toggle-bg); color: var(--text-muted); 
      border-radius: 8px; cursor: pointer; 
      display: flex; align-items: center; justify-content: center; 
      transition: all 0.15s ease-out; 
    }
    .settings-close:hover { background: var(--border-strong); color: var(--text); }
    .settings-close:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--card-bg), 0 0 0 4px var(--focus); }
    .settings-close svg { width: 14px; height: 14px; }
    /* Mobile: bottom sheet style */
    @media (max-width: 768px) {
      .settings-modal {
        top: auto;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-width: 100%;
        max-height: 90vh;
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        transform: translateY(100%);
      }
      
      .settings-overlay.show + .settings-modal,
      .settings-modal.show {
        transform: translateY(0);
      }
      
      /* Add drag handle for sheet */
      .settings-header::before {
        content: '';
        position: absolute;
        top: 8px;
        left: 50%;
        transform: translateX(-50%);
        width: 36px;
        height: 5px;
        background: var(--border-strong);
        border-radius: var(--radius-full);
      }
      
      .settings-header {
        padding-top: var(--space-6);
      }
      
      /* Ensure content scrolls within sheet */
      .settings-content {
        padding-bottom: calc(var(--space-6) + var(--safe-bottom));
      }
    }
    
    .settings-content { 
      padding: 18px 20px; 
      overflow-y: auto; 
      max-height: calc(85vh - 120px);
      scrollbar-width: thin;
      scrollbar-color: rgba(0,0,0,0.15) transparent;
    }
    [data-theme="dark"] .settings-content {
      scrollbar-color: rgba(255,255,255,0.2) transparent;
    }
    /* Webkit scrollbar styling */
    .settings-content::-webkit-scrollbar { width: 6px; }
    .settings-content::-webkit-scrollbar-track { background: transparent; margin: 4px 0; }
    .settings-content::-webkit-scrollbar-thumb { 
      background: rgba(0,0,0,0.12); 
      border-radius: 3px;
      border: 1px solid transparent;
    }
    .settings-content::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.2); }
    [data-theme="dark"] .settings-content::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); }
    [data-theme="dark"] .settings-content::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }
    
    .settings-section { margin-bottom: 24px; }
    .settings-section:last-child { margin-bottom: 0; }
    .settings-section-title { 
      font-size: 10px; 
      color: var(--text-muted); 
      text-transform: uppercase; 
      letter-spacing: 0.08em; 
      margin-bottom: 12px; 
      font-weight: 600;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }
    .settings-row { 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      padding: 12px 0; 
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    [data-theme="dark"] .settings-row { border-bottom-color: rgba(255,255,255,0.05); }
    .settings-row:last-child { border-bottom: none; }
    .settings-label { font-size: 13px; color: var(--text); font-weight: 450; }
    .settings-desc { font-size: 11px; color: var(--text-muted); margin-top: 3px; line-height: 1.4; }
    
    /* Toggle switch - improved OFF state contrast */
    .setting-switch { 
      width: 42px; 
      height: 24px; 
      background: rgba(0,0,0,0.18);
      border-radius: 12px; 
      position: relative; 
      cursor: pointer; 
      transition: background 0.2s ease-out; 
      flex-shrink: 0;
      border: 1px solid rgba(0,0,0,0.06);
    }
    [data-theme="dark"] .setting-switch { 
      background: rgba(255,255,255,0.12);
      border-color: rgba(255,255,255,0.08);
    }
    .setting-switch.on { 
      background: var(--accent); 
      border-color: transparent;
    }
    .setting-switch::after { 
      content: ''; 
      position: absolute; 
      width: 20px; 
      height: 20px; 
      background: #fff; 
      border-radius: 50%; 
      top: 2px; 
      left: 2px; 
      transition: transform 0.2s ease-out; 
      box-shadow: 0 1px 3px rgba(0,0,0,0.15), 0 1px 1px rgba(0,0,0,0.08);
    }
    .setting-switch.on::after { transform: translateX(18px); }
    
    /* Name saved indicator with fade out */
    @keyframes savedPillFadeIn { 
      from { opacity: 0; transform: scale(0.9); } 
      to { opacity: 1; transform: scale(1); } 
    }
    @keyframes savedPillFadeOut { 
      from { opacity: 1; } 
      to { opacity: 0; } 
    }
    .saved-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      font-weight: 500;
      color: var(--rest);
      background: var(--rest-hover);
      padding: 4px 10px;
      border-radius: 12px;
      border: 1px solid var(--rest-border);
      white-space: nowrap;
      animation: savedPillFadeIn 0.15s ease-out, savedPillFadeOut 0.3s ease-out 0.9s forwards;
    }
    .saved-indicator svg { width: 10px; height: 10px; }
    
    /* Settings input field */
    .settings-input {
      padding: 8px 12px;
      border: 1px solid var(--border-strong);
      border-radius: 8px;
      font-size: 13px;
      background: var(--toggle-bg);
      color: var(--text);
      outline: none;
      transition: all 0.15s ease-out;
      width: 130px;
    }
    .settings-input:hover { border-color: var(--text-muted); }
    .settings-input:focus { border-color: var(--focus); box-shadow: 0 0 0 3px var(--focus-hover); }
    .settings-input::placeholder { color: var(--text-muted); opacity: 0.6; }
    
    /* GUIDE MODAL */
    .guide-modal {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 16px; box-shadow: var(--shadow-lg); z-index: 501;
      width: 90%; max-width: 400px; max-height: 80vh; overflow: hidden;
      opacity: 0; pointer-events: none; transition: all 0.25s ease-out;
    }
    .guide-modal.show { opacity: 1; pointer-events: auto; transform: translate(-50%, -50%) scale(1); }
    .guide-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .guide-header h2 { font-size: 15px; font-weight: 600; color: var(--accent); display: flex; align-items: center; gap: 8px; }
    .guide-header h2 svg { width: 18px; height: 18px; }
    .guide-content { padding: 20px; }
    .guide-step { margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
    .guide-step:last-of-type { border-bottom: none; margin-bottom: 12px; }
    .guide-step-title { font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 4px; display: flex; align-items: center; gap: 6px; }
    .guide-step-title .dot { width: 8px; height: 8px; border-radius: 50%; }
    .guide-step-title .dot.order { background: var(--order); }
    .guide-step-title .dot.focus { background: var(--focus); }
    .guide-step-title .dot.rest { background: var(--rest); }
    .guide-step-text { font-size: 12px; color: var(--text-muted); line-height: 1.5; }
    .guide-philosophy { padding: 12px; background: var(--accent-hover); border-radius: 8px; font-size: 12px; color: var(--text); font-style: italic; line-height: 1.5; border-left: 3px solid var(--accent); }
    
    /* SETTINGS PHILOSOPHY */
    .settings-philosophy { margin-bottom: 20px; padding: 14px; background: var(--bg-paper); border-radius: 10px; border: 1px solid var(--border); }
    .settings-philosophy-title { font-size: 12px; font-weight: 600; color: var(--accent); margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }
    .settings-philosophy-title svg { width: 14px; height: 14px; }
    .settings-philosophy-text { font-size: 12px; color: var(--text-muted); line-height: 1.5; }
    
    /* EXPORT SECTION */
    .export-section { padding: 12px 14px; border-top: 1px solid var(--border); background: var(--toggle-bg); border-radius: 0 0 14px 14px; position: relative; z-index: 1; }
    .export-btn { display: flex; align-items: center; justify-content: center; gap: 6px; width: 100%; padding: 10px 14px; border: 1px solid var(--rest-border); background: var(--rest-hover); color: var(--rest); font-size: 12px; font-weight: 500; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-out; }
    .export-btn:hover { background: var(--rest-light); border-color: var(--rest); }
    .export-btn svg { width: 14px; height: 14px; }
    
    /* PAGE TRANSITIONS - Smooth mount transition (no snap/glitch on reload) */
    @keyframes appMountFade { from { opacity: 0; } to { opacity: 1; } }
    .app { animation: appMountFade 150ms ease-out forwards; }
    
    /* View container for smooth transitions */
    .view-container { position: relative; }
    .view-wrapper {
      opacity: 0;
      transform: translateY(6px);
      pointer-events: none;
      transition: opacity 0.25s ease-out, transform 0.25s ease-out;
      position: absolute;
      top: 0; left: 0; right: 0;
    }
    .view-wrapper.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
      position: relative;
    }
    @media (prefers-reduced-motion: reduce) {
      .view-wrapper { transition: none; }
    }
    .reduce-motion .view-wrapper { transition: opacity 0.15s ease-out; transform: none; }
    
    /* COMPLETED ARCHIVE */
    .archive-section { margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); }
    .archive-toggle { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; cursor: pointer; transition: background 0.15s ease-out; border-radius: 6px; margin: 0 -8px; padding: 10px 8px; }
    .archive-toggle:hover { background: var(--toggle-bg); }
    .archive-toggle-text { font-size: 13px; color: var(--text); display: flex; align-items: center; gap: 8px; }
    .archive-toggle-text svg { width: 16px; height: 16px; color: var(--rest); }
    .archive-count { font-size: 11px; color: var(--text-muted); background: var(--toggle-bg); padding: 2px 8px; border-radius: 10px; }
    .archive-list { margin-top: 12px; max-height: 200px; overflow-y: auto; }
    .archive-day { margin-bottom: 12px; }
    .archive-day-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 6px; font-weight: 500; }
    .archive-item { display: flex; align-items: center; gap: 8px; padding: 6px 0; font-size: 12px; color: var(--text-muted); }
    .archive-item svg { width: 12px; height: 12px; color: var(--rest); flex-shrink: 0; }
    .archive-item span { text-decoration: line-through; flex: 1; }
    .archive-item-time { font-size: 10px; color: var(--focus); font-weight: 500; }
    
    /* SELAH PAUSE - dots and breathing */
    .selah-overlay { 
      position: fixed; inset: 0; background: rgba(0,0,0,0.9); 
      -webkit-backdrop-filter: blur(16px);
      backdrop-filter: blur(16px); z-index: 1000;
      display: flex; align-items: center; justify-content: center; 
      opacity: 0; pointer-events: none; transition: opacity 0.5s ease-out; 
    }
    @supports (-webkit-backdrop-filter: blur(1px)) and (not (backdrop-filter: blur(1px))) {
      .selah-overlay {
        -webkit-backdrop-filter: blur(14px);
        backdrop-filter: blur(14px);
      }
    }
    .selah-overlay.show { opacity: 1; pointer-events: auto; }
    .selah-overlay .dot-pattern { 
      opacity: 0.15; 
      background-image: radial-gradient(circle at center, rgba(196, 112, 75, 0.3) 2px, transparent 2px);
      background-size: 32px 32px;
      animation: dotDrift 25s ease-in-out infinite;
    }
    .selah-content { max-width: 440px; padding: 48px; text-align: center; color: #fff; position: relative; z-index: 1; }
    .selah-verse { font-size: 24px; line-height: 1.6; font-style: italic; margin-bottom: 16px; font-weight: 300; }
    .selah-ref { font-size: 13px; color: rgba(255,255,255,0.6); margin-bottom: 36px; }
    .selah-close { 
      padding: 10px 28px; border: 1px solid rgba(255,255,255,0.25); 
      background: transparent; color: #fff; font-size: 13px; font-weight: 500; 
      border-radius: 8px; cursor: pointer; transition: all 0.2s ease-out; 
    }
    .selah-close:hover { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.4); }
    .selah-trigger { 
      position: fixed; bottom: 150px; right: 20px; 
      width: 48px; height: 48px; border-radius: 50%; 
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-soft) 100%); 
      color: #fff; border: none; cursor: pointer; 
      display: flex; align-items: center; justify-content: center; 
      box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4); 
      transition: all 0.3s ease-out; z-index: 100; 
    }
    .selah-trigger:hover { transform: scale(1.08); box-shadow: 0 6px 28px rgba(139, 92, 246, 0.5); }
    .selah-trigger svg { width: 22px; height: 22px; }
    .mode-focus .selah-trigger { opacity: 0.7; }
    .mode-focus .selah-trigger:hover { opacity: 1; }
    
    /* ENCOURAGEMENT - Hidden per request */
    .encouragement-bar { 
      display: none;
    }
    
    /* "Enough" Indicator - Permission to rest */
    .enough-indicator {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3) var(--space-5);
      background: var(--card-bg);
      border: 1px solid var(--rest-border);
      border-radius: var(--radius-full);
      box-shadow: var(--shadow-md);
      z-index: 90;
      animation: enoughFadeIn 0.5s ease-out;
    }
    @keyframes enoughFadeIn {
      from { opacity: 0; transform: translateX(-50%) translateY(20px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
    .enough-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--rest);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .enough-icon svg {
      width: 16px;
      height: 16px;
    }
    .enough-text {
      font-size: var(--text-sm);
      color: var(--text);
      font-weight: 500;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .enough-subtext {
      font-size: var(--text-xs);
      color: var(--text-muted);
      font-weight: 400;
    }
    .mode-focus .enough-indicator,
    .mode-rest .enough-indicator {
      display: none;
    }
    
    /* Deep Work Progress Bar - ambient timer awareness */
    .deep-work-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: transparent;
      z-index: 1000;
      pointer-events: none;
    }
    .deep-work-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--focus) 0%, var(--accent) 100%);
      transition: width 1s linear;
      border-radius: 0 2px 2px 0;
    }
    .deep-work-bar-fill.break {
      background: linear-gradient(90deg, var(--sage) 0%, var(--sage-soft) 100%);
    }
    /* Pulse animation when timer completes */
    @keyframes deepWorkPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .deep-work-bar-fill.complete {
      animation: deepWorkPulse 1s ease-in-out 3;
    }
    
    /* New Day Transition */
    .new-day-overlay {
      position: fixed;
      inset: 0;
      background: rgba(222, 218, 213, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: newDayFadeIn 0.8s ease-out;
      cursor: pointer;
    }
    [data-theme="dark"] .new-day-overlay {
      background: rgba(30, 28, 34, 0.95);
    }
    @keyframes newDayFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .new-day-card {
      text-align: center;
      max-width: 400px;
      padding: var(--space-8);
    }
    .new-day-greeting {
      font-size: var(--text-2xl);
      font-weight: 600;
      color: var(--text);
      margin-bottom: var(--space-3);
    }
    .new-day-message {
      font-size: var(--text-lg);
      color: var(--text-muted);
      font-style: italic;
      margin-bottom: var(--space-6);
    }
    .new-day-stats {
      font-size: var(--text-sm);
      color: var(--rest);
      margin-bottom: var(--space-4);
    }
    .new-day-hint {
      font-size: var(--text-xs);
      color: var(--text-light);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    
    /* Weekly Reflection Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.22);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    [data-theme="dark"] .modal-backdrop {
      background: rgba(0, 0, 0, 0.38);
    }
    .weekly-reflection-modal {
      background: var(--card-bg);
      border: 1px solid var(--border-strong);
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
      width: 100%;
      max-width: 480px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    [data-theme="dark"] .weekly-reflection-modal {
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.35), 0 2px 10px rgba(0, 0, 0, 0.22), 0 0 0 1px rgba(255,255,255,0.06);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 18px 14px;
      border-bottom: 1px solid var(--border);
    }
    .modal-header h2 {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      letter-spacing: -0.01em;
      margin: 0;
    }
    .modal-close {
      width: 26px;
      height: 26px;
      border: none;
      background: var(--toggle-bg);
      color: var(--text-muted);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease-out;
    }
    .modal-close:hover {
      background: var(--border-strong);
      color: var(--text);
    }
    .modal-close svg {
      width: 13px;
      height: 13px;
    }
    .modal-body {
      padding: 18px;
    }
    .weekly-reflection-prompt {
      font-size: var(--text-base);
      color: var(--text-muted);
      margin-bottom: var(--space-2);
    }
    .weekly-reflection-question {
      font-size: var(--text-xl);
      font-weight: 600;
      color: var(--text);
      margin-bottom: var(--space-4);
    }
    .weekly-reflection-input {
      width: 100%;
      padding: var(--space-3);
      border: 1px solid var(--border-strong);
      border-radius: var(--radius-md);
      font-size: var(--text-base);
      font-family: var(--font-system);
      background: var(--toggle-bg);
      color: var(--text);
      resize: vertical;
      min-height: 120px;
    }
    .weekly-reflection-input:focus {
      outline: none;
      border-color: var(--rest);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15);
    }
    .weekly-reflection-hint {
      font-size: var(--text-xs);
      color: var(--text-light);
      font-style: italic;
      margin-top: var(--space-3);
    }
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: var(--space-2);
      padding: 14px 18px 16px;
      border-top: 1px solid var(--border);
    }
    .modal-btn {
      padding: 6px 14px;
      border: 1px solid var(--border-strong);
      border-radius: var(--radius-sm);
      font-size: var(--text-sm);
      cursor: pointer;
      transition: all 0.15s ease-out;
    }
    .modal-btn.secondary {
      background: transparent;
      color: var(--text-muted);
    }
    .modal-btn.secondary:hover {
      background: var(--toggle-bg);
      color: var(--text);
    }
    .modal-btn.primary {
      background: var(--rest);
      color: #fff;
      border-color: var(--rest);
    }
    .modal-btn.primary:hover {
      background: var(--rest-hover);
      border-color: var(--rest-hover);
    }
    
    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .encouragement-bar { transition: opacity 0.2s ease-out; transform: none; }
      .encouragement-bar:hover { transform: none; }
      .mode-focus .encouragement-bar { transform: none; }
    }
    
    /* SCRIPTURE QUOTE - EB Garamond */
    .encouragement-text {  font-size: var(--text-base); color: var(--text); font-style: italic; line-height: var(--leading-relaxed); }
    .encouragement-ref {  font-size: var(--text-xs); color: var(--accent); font-weight: 500; margin-left: var(--space-1); font-style: normal; }
    
    /* MERCIES VERSE PILL - Subtle rotating verse */
    .mercies-verse-pill {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-3);
      background: var(--toggle-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      color: var(--text-muted);
      font-style: italic;
      margin: var(--space-3) 0;
      transition: all 0.2s ease-out;
    }
    .mercies-verse-pill:hover {
      background: var(--card-bg);
      border-color: var(--border-strong);
    }
    .mercies-verse-pill svg {
      width: 12px;
      height: 12px;
      color: var(--warm);
    }
    .mercies-verse-ref {
      color: var(--warm);
      font-weight: 500;
      font-style: normal;
    }
    
    /* CELEBRATION TOAST - Bottom-right, Apple-like animation */
    .toast { 
      position: fixed; 
      bottom: 100px; 
      right: 24px; 
      transform: translateY(20px) scale(0.96);
      padding: 14px 20px; 
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-soft) 100%); 
      color: #fff; 
      border-radius: 14px; 
      box-shadow: 0 8px 32px rgba(139, 92, 246, 0.35), 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1001; 
      opacity: 0; 
      pointer-events: none;
      transition: all 0.35s cubic-bezier(0.34, 1.4, 0.64, 1);
      display: flex; 
      align-items: center; 
      gap: 12px;
      max-width: 320px;
      cursor: pointer;
    }
    .toast.show { 
      transform: translateY(0) scale(1); 
      opacity: 1; 
      pointer-events: auto;
    }
    .toast.show:hover {
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 12px 40px rgba(139, 92, 246, 0.4), 0 6px 16px rgba(0,0,0,0.18);
    }
    .toast svg { width: 20px; height: 20px; flex-shrink: 0; }
    .toast-text { display: flex; flex-direction: column; gap: 2px; }
    .toast-title { font-size: 14px; font-weight: 600; }
    .toast-message { font-size: 12px; font-weight: 400; opacity: 0.9; }
    .toast-close {
      position: absolute;
      top: 6px;
      right: 6px;
      width: 18px;
      height: 18px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: #fff;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all 0.15s ease-out;
    }
    .toast:hover .toast-close { opacity: 1; }
    .toast-close:hover { background: rgba(255,255,255,0.35); }
    .toast-close svg { width: 10px; height: 10px; }
    
    /* Reduced motion: disable slide animation */
    @media (prefers-reduced-motion: reduce) {
      .toast {
        transition: opacity 0.2s ease-out;
        transform: none;
      }
      .toast.show { transform: none; }
      .toast.show:hover { transform: none; }
    }
    
    /* Global button reset - ALL buttons use rounded rectangle, not pill */
    button,
    .btn,
    .button,
    [class*="btn-"],
    [class*="-btn"]:not(.nav-segment-btn):not(.nav-tab) {
      border-radius: 10px !important;  /* Force rounded rectangle */
    }
    
    /* Exception: nav buttons already handled above */
    
    /* FOOTER - Calm, subtle, matches theme */
    .footer { 
      position: fixed; bottom: 0; left: 0; right: 0; 
      padding: var(--space-2) var(--space-4); 
      background: linear-gradient(180deg, transparent 0%, var(--bg) 40%); 
      text-align: center; 
      
      font-size: var(--text-xs); 
      color: var(--text-muted); 
      z-index: 40;
      display: flex; justify-content: center; align-items: center; gap: var(--space-3); flex-wrap: wrap;
    }
    .footer-brand { font-style: italic; color: var(--text-muted); opacity: 0.6; font-size: 9px; width: 100%; margin-bottom: var(--space-1); }
    .footer-row { display: flex; align-items: center; justify-content: center; gap: var(--space-3); flex-wrap: wrap; }
    .footer-credit { color: var(--text-muted); }
    .footer-credit > span:first-of-type { color: #ef4444; } /* Heart only */
    .footer-version { 
      font-size: var(--text-xs); 
      font-weight: var(--weight-regular);
      color: var(--text-light);
      opacity: 0.6;
      margin-left: auto;
      cursor: pointer;
      transition: all 0.15s ease-out;
      padding: 2px 6px;
      border-radius: 4px;
      background: transparent;
      border: none;
    }
    .footer-version:hover {
      opacity: 1;
      color: var(--accent);
      background: var(--accent-hover);
    }
    .footer-link { 
      color: var(--text-muted); 
      text-decoration: none; 
      display: flex; align-items: center; gap: var(--space-1); 
      cursor: pointer; 
    }
    .footer-link:hover { color: var(--accent); }
    .footer-link svg { width: 10px; height: 10px; }
    .footer-divider { color: var(--border); }
    
    @media (max-width: 1400px) {
      .rest-layout { 
        grid-template-columns: repeat(2, 1fr); 
      }
    }
    
    @media (max-width: 1000px) { 
      .focus-layout { grid-template-columns: 1fr; }
      .order-layout { grid-template-columns: 1fr; }
      .rest-layout { grid-template-columns: 1fr; }
      .header-center { display: none; }
      .encouragement-bar { display: none; }
      .quick-add-bar input { width: 160px; }
    }
    
    /* Reduce motion preference */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { transition-duration: 0.01ms !important; animation-duration: 0.01ms !important; }
    }
    .reduce-motion *, .reduce-motion *::before, .reduce-motion *::after { 
      transition-duration: 0.01ms !important; animation-duration: 0.01ms !important; 
    }
    
    /* ========================================
       MOBILE-FIRST ENHANCEMENTS
       ======================================== */
    
    /* Detect touch devices */
    @media (hover: none) and (pointer: coarse) {
      /* Increase touch targets */
      .task-item {
        min-height: var(--touch-target-min);
        padding: var(--space-3) var(--space-2);
      }
      
      .task-check {
        width: 28px;
        height: 28px;
      }
      
      .task-action-btn {
        width: 36px;
        height: 36px;
      }
      
      /* Hide drag handle on touch - use long-press instead */
      .drag-handle {
        display: none;
      }
      
      /* Prevent text selection during swipe */
      .swipeable-content {
        -webkit-user-select: none;
        user-select: none;
      }
    }
    
    /* Small screens */
    @media (max-width: 768px) {
      /* Mobile view-container padding is handled in the 767px media query */
      
      /* Settings becomes bottom sheet on mobile */
      .settings-modal {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        top: auto;
        max-height: 85vh;
        max-width: 100%;
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        transform: translateY(100%);
      }
      
      .settings-modal.show {
        transform: translateY(0);
      }
      
      .settings-overlay.show + .settings-modal,
      .settings-modal.show {
        transform: translateY(0);
      }
    }
    
    /* Prevent overscroll bounce on iOS */
    html, body {
      overscroll-behavior: none;
    }
    
    @supports (-webkit-touch-callout: none) {
      /* iOS-specific fixes */
      body {
        -webkit-touch-callout: none;
      }
    }
    
    /* ========================================
       MOBILE LAYOUT SYSTEM (< 768px)
       ======================================== */
    @media (max-width: 767px) {
      /* Prevent body scroll - app handles it */
      html, body {
        height: 100%;
        overflow: hidden;
        overscroll-behavior: none;
        position: fixed;
        width: 100%;
      }
      
      /* App is the fixed full-screen container */
      .app {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      
      /* View container IS the scrollable area */
      .view-container {
        position: relative;
        flex: 1 1 auto;
        min-height: 0;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: contain;
        padding-top: calc(100px + var(--safe-top, 0px));
        padding-bottom: calc(140px + var(--safe-bottom, 0px));
        padding-left: var(--space-3);
        padding-right: var(--space-3);
      }
      
      /* CRITICAL: View wrappers must NOT be position: absolute on mobile */
      .view-wrapper {
        position: relative !important;
        min-height: auto;
        height: auto;
        opacity: 1;
        transform: none;
        overflow: visible;
      }
      
      /* Non-active tabs are completely hidden */
      .view-wrapper:not(.active) {
        display: none !important;
      }
      
      /* Active tab is visible */
      .view-wrapper.active {
        display: block;
        position: relative !important;
      }
      
      /* Layouts flow naturally */
      .order-layout,
      .focus-layout,
      .rest-layout {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
        width: 100%;
      }
      
      /* Footer inside scroll area */
      .footer {
        margin-top: var(--space-6);
        padding-top: var(--space-4);
        padding-bottom: var(--space-4);
      }
    }
    
    /* ========================================
       SWIPEABLE TASK ITEMS
       ======================================== */
    
    .swipeable-container {
      position: relative;
      overflow: hidden;
      background: var(--card-bg);
    }
    
    .swipe-action {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: 0 var(--space-4);
      color: white;
      font-size: var(--text-sm);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      opacity: 0;
      transition: opacity 0.15s ease;
    }
    
    .swipe-action-right {
      left: 0;
      justify-content: flex-start;
      background: var(--rest);
    }
    
    .swipe-action-left {
      right: 0;
      justify-content: flex-end;
      background: var(--accent);
    }
    
    .swipe-action-icon {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .swipe-action-icon svg {
      width: 18px;
      height: 18px;
    }
    
    .swipeable-content {
      position: relative;
      background: var(--card-bg);
      z-index: 1;
      transition: transform 0.3s var(--spring-bounce);
    }
    
    .swipeable-content.dragging {
      transition: none;
    }
    
    /* Ensure task item background matches */
    .swipeable-container .task-item {
      background: var(--card-bg);
    }
    
    /* ========================================
       MOBILE ACCORDION CARDS - ON BRAND
       ======================================== */
    
    /* Container for accordion system */
    .mobile-accordion-container {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
      margin-bottom: var(--space-4);
    }
    
    /* Button row - three toggle buttons */
    .mobile-accordion-buttons {
      display: flex;
      gap: var(--space-2);
    }
    
    /* Individual button - compact pill */
    .mobile-accordion-btn {
      flex: 1;
      display: flex;
      flex-direction: row; /* HORIZONTAL layout */
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px 12px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
      -webkit-tap-highlight-color: transparent;
    }
    
    .mobile-accordion-btn:active {
      transform: scale(0.97);
    }
    
    /* Active state - subtle highlight, NOT heavy black border */
    .mobile-accordion-btn.active {
      background: var(--pastel-lavender);
      border-color: rgba(139, 92, 246, 0.3);
    }
    
    .mobile-accordion-btn.active.habits {
      background: var(--pastel-mint);
      border-color: rgba(16, 185, 129, 0.3);
    }
    
    .mobile-accordion-btn.active.wisdom {
      background: var(--pastel-cream);
      border-color: rgba(245, 158, 11, 0.3);
    }
    
    /* Icon - inline with text */
    .mobile-accordion-btn-icon {
      width: 18px;
      height: 18px;
      color: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .mobile-accordion-btn.habits .mobile-accordion-btn-icon {
      color: var(--rest);
    }
    
    .mobile-accordion-btn.wisdom .mobile-accordion-btn-icon {
      color: var(--warning);
    }
    
    .mobile-accordion-btn-icon svg {
      width: 16px;
      height: 16px;
    }
    
    /* Label - inline with icon */
    .mobile-accordion-btn-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
    }
    
    /* Badge - small pill */
    .mobile-accordion-btn-badge {
      font-size: 10px;
      font-weight: 500;
      color: var(--text-muted);
      background: rgba(0,0,0,0.06);
      padding: 2px 6px;
      border-radius: var(--radius-full);
      margin-left: 2px;
    }
    
    [data-theme="dark"] .mobile-accordion-btn-badge {
      background: rgba(255,255,255,0.1);
    }
    
    /* Chevron - small, at end */
    .mobile-accordion-btn-chevron {
      width: 14px;
      height: 14px;
      color: var(--text-light);
      transition: transform 0.3s ease;
      margin-left: auto;
    }
    
    .mobile-accordion-btn-chevron svg {
      width: 14px;
      height: 14px;
    }
    
    .mobile-accordion-btn.active .mobile-accordion-btn-chevron {
      transform: rotate(180deg);
    }
    
    /* Expandable panel - styled like a card */
    .mobile-accordion-panel {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transition: max-height 0.4s ease, opacity 0.35s ease, margin 0.35s ease;
      margin-top: 0;
    }
    
    .mobile-accordion-panel.open {
      max-height: 800px;
      opacity: 1;
      margin-top: var(--space-2);
    }
    
    /* Panel header - matches card-header style exactly */
    .mobile-accordion-panel-header {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-3) var(--space-4);
      overflow: hidden;
    }
    
    /* Dot texture for panel headers */
    .mobile-accordion-panel-header::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.38;
      background-image: radial-gradient(rgba(139, 92, 246, 0.45) 0.7px, transparent 0.8px);
      background-size: 6px 6px;
      -webkit-mask-image: linear-gradient(to bottom, black 75%, transparent 100%);
      mask-image: linear-gradient(to bottom, black 75%, transparent 100%);
    }
    
    .mobile-accordion-panel-header.anchors {
      background: var(--pastel-lavender);
    }
    
    .mobile-accordion-panel-header.habits {
      background: var(--pastel-mint);
    }
    
    .mobile-accordion-panel-header.habits::after {
      background-image: radial-gradient(rgba(16, 185, 129, 0.45) 0.7px, transparent 0.8px);
    }
    
    .mobile-accordion-panel-header.wisdom {
      background: var(--pastel-cream);
    }
    
    .mobile-accordion-panel-header.wisdom::after {
      background-image: radial-gradient(rgba(245, 158, 11, 0.45) 0.7px, transparent 0.8px);
    }
    
    .mobile-accordion-panel-title {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
    }
    
    .mobile-accordion-panel-title svg {
      width: 18px;
      height: 18px;
      color: var(--accent);
    }
    
    .mobile-accordion-panel-header.habits .mobile-accordion-panel-title svg {
      color: var(--rest);
    }
    
    .mobile-accordion-panel-header.wisdom .mobile-accordion-panel-title svg {
      color: var(--warning);
    }
    
    .mobile-accordion-panel-actions {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }
    
    /* Panel content */
    .mobile-accordion-panel-content {
      padding: var(--space-3) var(--space-4);
      max-height: 350px;
      overflow-y: auto;
    }
    
    /* Anchor items in accordion */
    .mobile-accordion-panel .anchor-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-2) 0;
      border-bottom: 1px solid var(--border);
    }
    
    .mobile-accordion-panel .anchor-item:last-of-type {
      border-bottom: none;
    }
    
    .mobile-accordion-panel .anchor-time {
      font-size: 13px;
      font-weight: 600;
      color: var(--accent);
      min-width: 60px;
    }
    
    .mobile-accordion-panel .anchor-activity {
      flex: 1;
      font-size: 14px;
      color: var(--text);
    }
    
    .mobile-accordion-panel .anchor-actions {
      display: flex;
      gap: var(--space-1);
    }
    
    .mobile-accordion-panel .anchor-actions button {
      padding: 4px;
      border: none;
      background: transparent;
      color: var(--text-light);
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }
    
    .mobile-accordion-panel .anchor-actions button:hover {
      background: rgba(0,0,0,0.05);
      color: var(--text);
    }
    
    /* Add button - matches app style */
    .mobile-accordion-add-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      width: 100%;
      padding: var(--space-2) var(--space-3);
      margin-top: var(--space-2);
      border: 1px dashed var(--border);
      background: transparent;
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.25s ease;
    }
    
    .mobile-accordion-add-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(139, 92, 246, 0.05);
    }
    
    .mobile-accordion-add-btn svg {
      width: 14px;
      height: 14px;
    }
    
    /* Habit items in accordion */
    .mobile-accordion-panel .habit-row {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-2) 0;
    }
    
    .mobile-accordion-panel .habit-check {
      width: 22px;
      height: 22px;
      border: 2px solid var(--border);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.25s ease;
      flex-shrink: 0;
    }
    
    .mobile-accordion-panel .habit-check.done {
      background: var(--sage);
      border-color: var(--sage);
      color: white;
    }
    
    .mobile-accordion-panel .habit-check svg {
      width: 14px;
      height: 14px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    .mobile-accordion-panel .habit-check.done svg {
      opacity: 1;
    }
    
    .mobile-accordion-panel .habit-name {
      flex: 1;
      font-size: 14px;
      color: var(--text);
    }
    
    .mobile-accordion-panel .habit-streak {
      display: flex;
      gap: 3px;
    }
    
    .mobile-accordion-panel .habit-streak-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--border);
    }
    
    .mobile-accordion-panel .habit-streak-dot.done {
      background: var(--sage);
    }
    
    /* Wisdom content in accordion - reuse desktop styles */
    .wisdom-mobile-content {
      padding: var(--space-2) 0;
    }
    
    .wisdom-mobile-content .wisdom-segmented-control {
      margin-bottom: var(--space-3);
    }
    
    .wisdom-mobile-content .wisdom-verse-block {
      text-align: center;
      margin-bottom: var(--space-3);
    }
    
    .wisdom-mobile-content .wisdom-reference {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.03em;
      margin-bottom: var(--space-2);
    }
    
    .wisdom-mobile-content .wisdom-text {
      font-size: 15px;
      font-style: italic;
      color: var(--text);
      line-height: 1.5;
    }
    
    .wisdom-mobile-content .wisdom-next-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      width: 100%;
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--border);
      background: var(--card-bg);
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 500;
      color: var(--text);
      cursor: pointer;
      transition: all 0.25s ease;
    }
    
    .wisdom-mobile-content .wisdom-next-btn:hover {
      background: var(--toggle-bg);
    }
    
    .wisdom-mobile-content .wisdom-next-btn svg {
      width: 14px;
      height: 14px;
      color: var(--warning);
    }
    
    /* ========================================
       COLLAPSED TIMER - iOS 26 STYLE
       ======================================== */
    
    .apple-timer-collapsed {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: var(--space-3) var(--space-4);
      position: relative;
    }
    
    /* Light dot texture */
    .apple-timer-collapsed::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.2;
      background-image: radial-gradient(rgba(59, 130, 246, 0.5) 0.7px, transparent 0.8px);
      background-size: 6px 6px;
      border-radius: inherit;
    }
    
    .apple-timer-collapsed-row {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      gap: var(--space-4);
    }
    
    /* Left: Title + Time stacked */
    .apple-timer-collapsed-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 80px;
    }
    
    .apple-timer-collapsed-title {
      font-size: 10px;
      font-weight: 600;
      color: var(--focus);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .apple-timer-collapsed-time {
      font-size: 26px;
      font-weight: 700;
      color: var(--text);
      font-variant-numeric: tabular-nums;
      line-height: 1;
    }
    
    /* Center: Mode buttons - horizontal segmented control */
    .apple-timer-collapsed-modes {
      display: flex;
      background: var(--toggle-bg);
      border-radius: var(--radius-full);
      padding: 3px;
      gap: 2px;
    }
    
    .apple-timer-collapsed-mode {
      padding: 6px 12px;
      border: none;
      background: transparent;
      border-radius: var(--radius-full);
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.25s ease;
      white-space: nowrap;
    }
    
    .apple-timer-collapsed-mode:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .apple-timer-collapsed-mode.active {
      background: white;
      color: var(--focus);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    [data-theme="dark"] .apple-timer-collapsed-mode.active {
      background: var(--card-bg);
    }
    
    /* Right: Play button + Expand */
    .apple-timer-collapsed-actions {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-left: auto;
    }
    
    .apple-timer-collapsed-play {
      width: 40px;
      height: 40px;
      border: none;
      background: var(--focus);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }
    
    .apple-timer-collapsed-play:active {
      transform: scale(0.92);
    }
    
    .apple-timer-collapsed-play svg {
      width: 18px;
      height: 18px;
    }
    
    .apple-timer-collapsed-expand {
      width: 32px;
      height: 32px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.25s ease;
    }
    
    .apple-timer-collapsed-expand:active {
      transform: scale(0.92);
    }
    
    .apple-timer-collapsed-expand svg {
      width: 16px;
      height: 16px;
    }
    
    /* Collapse button - position in header, LEFT of settings */
    .apple-timer-collapse-btn {
      position: absolute;
      top: var(--space-3);
      right: calc(var(--space-3) + 80px); /* Move left, away from settings/help */
      width: 32px;
      height: 32px;
      border: none;
      background: rgba(0, 0, 0, 0.08);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-muted);
      z-index: 10;
      transition: all 0.3s ease;
    }
    
    .apple-timer-collapse-btn:hover {
      background: rgba(0, 0, 0, 0.12);
    }
    
    .apple-timer-collapse-btn:active {
      transform: scale(0.9);
    }
    
    .apple-timer-collapse-btn svg {
      width: 16px;
      height: 16px;
    }
    
    /* Only show on mobile */
    @media (min-width: 768px) {
      .apple-timer-collapse-btn {
        display: none;
      }
    }
    
    /* ========================================
       CONTEXT MENU (Long-press / Right-click)
       ======================================== */
    
    .context-menu-backdrop {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: transparent;
    }
    
    .context-menu {
      min-width: 200px;
      max-width: 280px;
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18), 0 2px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--border);
      overflow: hidden;
      animation: contextMenuIn 0.2s var(--spring-bounce);
    }
    
    [data-theme="dark"] .context-menu {
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 2px 8px rgba(0, 0, 0, 0.3);
    }
    
    @keyframes contextMenuIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .context-menu-header {
      padding: var(--space-3) var(--space-4);
      border-bottom: 1px solid var(--border);
    }
    
    .context-menu-title {
      font-size: var(--text-sm);
      font-weight: 600;
      color: var(--text-muted);
      display: block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .context-menu-items {
      padding: var(--space-2) 0;
    }
    
    .context-menu-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      width: 100%;
      padding: var(--space-3) var(--space-4);
      border: none;
      background: transparent;
      color: var(--text);
      font-size: var(--text-base);
      font-family: var(--font-system);
      cursor: pointer;
      text-align: left;
      transition: background 0.15s ease;
    }
    
    .context-menu-item:hover,
    .context-menu-item:active {
      background: var(--border);
    }
    
    .context-menu-item svg {
      width: 16px;
      height: 16px;
      color: var(--text-muted);
      flex-shrink: 0;
    }
    
    .context-menu-item.danger {
      color: #ef4444;
    }
    
    .context-menu-item.danger svg {
      color: #ef4444;
    }
    
    .context-menu-arrow {
      margin-left: auto;
      width: 14px !important;
      height: 14px !important;
    }
    
    .context-menu-divider {
      height: 1px;
      background: var(--border);
      margin: var(--space-2) 0;
    }
    
    .context-menu-back {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      width: 100%;
      padding: var(--space-3) var(--space-4);
      border: none;
      background: transparent;
      color: var(--accent);
      font-size: var(--text-sm);
      font-weight: 500;
      font-family: var(--font-system);
      cursor: pointer;
      border-bottom: 1px solid var(--border);
    }
    
    .context-menu-back svg {
      width: 14px;
      height: 14px;
    }
    
    /* Pull to Refresh */
    .pull-indicator {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      color: var(--text-muted);
      font-size: var(--text-sm);
      z-index: 50;
      pointer-events: none;
    }
    
    .pull-spinner {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .pull-spinner svg {
      width: 18px;
      height: 18px;
    }
    
    .pull-spinner.spinning svg {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    /* --- HEADER SHADOW KILL SWITCH (no shadows on top bars) --- */
    .card-header,
    .card-header:hover,
    .card-header:active,
    .card-header:focus,
    .card-header:focus-visible {
      box-shadow: none !important;
      filter: none !important;
    }

    /* Collapsed headers should not have inset shadow either */
    .card.is-collapsed .card-header.is-collapsed,
    .card-header.is-collapsed,
    .card.is-collapsed .card-header.is-collapsed:hover,
    .card-header.is-collapsed:hover {
      box-shadow: none !important;
      filter: none !important;
    }

    /* Selah / Be Still header should NEVER cast its own shadow */
    .bestill-card .card-header,
    .bestill-card .card-header:hover,
    [data-theme="dark"] .bestill-card .card-header,
    [data-theme="dark"] .bestill-card .card-header:hover {
      box-shadow: none !important;
      filter: none !important;
    }

    /* ========================================
       iOS 26 MOBILE BOTTOM TAB BAR
       ======================================== */

    .mobile-tab-bar {
      display: none; /* Hidden on desktop */
    }

    @media (max-width: 767px) {
      .mobile-tab-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        display: flex;
        justify-content: center;
        padding: var(--space-4);
        padding-bottom: calc(var(--space-4) + var(--safe-bottom));
        pointer-events: none;
      }
      
      .mobile-tab-bar-glass {
        position: relative; /* CRITICAL for absolute indicator positioning */
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 2px;
        padding: 6px;
        background: rgba(255, 255, 255, 0.75);
        backdrop-filter: blur(40px) saturate(200%);
        -webkit-backdrop-filter: blur(40px) saturate(200%);
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: var(--radius-full);
        box-shadow: 
          0 8px 32px rgba(0, 0, 0, 0.12),
          0 2px 8px rgba(0, 0, 0, 0.06);
        pointer-events: auto;
        overflow: hidden; /* Contain the indicator within the pill */
        /* Spring transitions */
        transition: 
          transform 0.5s var(--spring-bounce),
          padding 0.5s var(--spring-smooth),
          gap 0.5s var(--spring-smooth);
      }
      
      [data-theme="dark"] .mobile-tab-bar-glass {
        background: rgba(44, 44, 46, 0.75);
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 
          0 8px 32px rgba(0, 0, 0, 0.4),
          0 2px 8px rgba(0, 0, 0, 0.2);
      }
      
      /* COLLAPSED STATE - matches prototype */
      .mobile-tab-bar-glass.collapsed {
        transform: translateY(6px) scale(0.92);
        padding: 4px;
        gap: 0;
      }
      
      /* TAB BUTTONS */
      .mobile-tab-btn {
        position: relative;
        z-index: 1; /* Above indicator */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 3px;
        padding: 10px 22px;
        border: none;
        background: transparent;
        cursor: pointer;
        border-radius: var(--radius-full);
        transition: all 0.4s var(--spring-bounce);
        -webkit-tap-highlight-color: transparent;
        min-width: 72px;
      }
      
      .mobile-tab-bar-glass.collapsed .mobile-tab-btn {
        padding: 8px 14px;
        min-width: 48px;
      }
      
      .mobile-tab-btn:active {
        transform: scale(0.9);
      }
      
      /* Active tab - mode-specific backgrounds */
      .mobile-tab-btn.active.order {
        background: var(--terracotta) !important;
        color: white;
      }
      .mobile-tab-btn.active.focus {
        background: var(--plum) !important;
        color: white;
      }
      .mobile-tab-btn.active.rest {
        background: var(--sage) !important;
        color: white;
      }
      
      /* ICONS */
      .mobile-tab-icon {
        width: 24px;
        height: 24px;
        color: var(--text-light);
        transition: color 0.3s ease, transform 0.3s var(--spring-bounce);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .mobile-tab-icon svg {
        width: 22px;
        height: 22px;
        stroke-width: 1.8;
      }
      
      .mobile-tab-btn.active .mobile-tab-icon { 
        color: white; 
        transform: scale(1.1); 
      }
      
      /* LABELS */
      .mobile-tab-label {
        font-size: 10px;
        font-weight: 500;
        color: var(--text-light);
        transition: all 0.35s var(--spring-smooth);
        white-space: nowrap;
      }
      
      .mobile-tab-btn.active .mobile-tab-label {
        color: white;
        font-weight: 600;
      }
      
      /* Labels hide when collapsed - EXACT prototype behavior */
      .mobile-tab-bar-glass.collapsed .mobile-tab-label {
        opacity: 0;
        transform: translateY(4px) scale(0.8);
        position: absolute;
        pointer-events: none;
      }
      
      /* MORPHING INDICATOR - slides between tabs */
      .mobile-tab-indicator {
        position: absolute;
        top: 6px;
        left: 0; /* Start at 0, transform handles position */
        height: calc(100% - 12px);
        border-radius: var(--radius-full);
        pointer-events: none;
        z-index: 0;
        /* Smooth spring animation */
        transition: 
          transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275),
          width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275),
          background 0.3s ease;
        will-change: transform, width;
      }
      
      .mobile-tab-indicator.order {
        background: rgba(139, 92, 246, 0.2);
      }
      .mobile-tab-indicator.focus {
        background: rgba(59, 130, 246, 0.2);
      }
      .mobile-tab-indicator.rest {
        background: rgba(16, 185, 129, 0.2);
      }
      
      [data-theme="dark"] .mobile-tab-indicator.order {
        background: rgba(139, 92, 246, 0.3);
      }
      [data-theme="dark"] .mobile-tab-indicator.focus {
        background: rgba(59, 130, 246, 0.3);
      }
      [data-theme="dark"] .mobile-tab-indicator.rest {
        background: rgba(16, 185, 129, 0.3);
      }
      
      /* Collapsed indicator adjusts */
      .mobile-tab-bar-glass.collapsed .mobile-tab-indicator {
        top: 4px;
        height: calc(100% - 8px);
        /* left stays at 0, transform handles position */
      }

      /* ========================================
         MOBILE HEADER
         ======================================== */

      /* COMPLETELY hide desktop header on mobile */
      .header {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        min-height: 0 !important;
        max-height: 0 !important;
        overflow: hidden !important;
        padding: 0 !important;
        margin: 0 !important;
        opacity: 0 !important;
        pointer-events: none !important;
      }
      
      /* Hide desktop nav segmented control */
      .nav-segmented-control {
        display: none !important;
      }
      
      .mobile-header {
        display: flex;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 500; /* Higher z-index */
        align-items: center;
        justify-content: space-between;
        padding: var(--space-2) var(--space-4);
        padding-top: calc(var(--space-2) + var(--safe-top));
        background: rgba(255, 255, 255, 0.92);
        backdrop-filter: blur(24px) saturate(180%);
        -webkit-backdrop-filter: blur(24px) saturate(180%);
        border-bottom: 1px solid var(--border);
        min-height: 56px;
        /* Liquid slide-in on mount */
        animation: headerSlideIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      }
      
      @keyframes headerSlideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      [data-theme="dark"] .mobile-header {
        background: rgba(28, 28, 30, 0.92);
        border-color: rgba(255, 255, 255, 0.08);
      }
      
      .mobile-header-content {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      
      .mobile-header-title {
        font-size: 20px;
        font-weight: 700;
        letter-spacing: -0.02em;
        line-height: 1.2;
      }
      
      .mobile-logo-selah {
        font-family: var(--font-display);
        color: var(--terracotta);
      }
      
      .mobile-logo-rhythm {
        font-family: var(--font-body);
        color: var(--text-secondary);
        font-weight: 400;
      }
      
      .mobile-header-subtitle {
        font-size: 12px;
        color: var(--text-muted);
        font-weight: 400;
      }
      
      .mobile-header-right {
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }
      
      /* Progress ring with liquid animation */
      .mobile-progress {
        display: flex;
        align-items: center;
        gap: 4px;
      }
      
      .mobile-progress-ring {
        flex-shrink: 0;
        transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      
      .mobile-progress-ring:active {
        transform: scale(0.9);
      }
      
      .mobile-progress-track {
        stroke: var(--border-strong);
      }
      
      .mobile-progress-fill {
        stroke: var(--rest);
        stroke-linecap: round;
        /* Liquid fill animation */
        transition: stroke-dashoffset 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      
      .mobile-progress-text {
        font-size: 12px;
        font-weight: 600;
        color: var(--text);
        font-variant-numeric: tabular-nums;
      }
      
      /* Timer pill - bouncy interactions */
      .mobile-timer-pill {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 5px 10px;
        background: var(--toggle-bg);
        border: 1px solid var(--border);
        border-radius: var(--radius-full);
        cursor: pointer;
        /* Liquid spring transition */
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      
      .mobile-timer-pill:active {
        transform: scale(0.9);
        transition: transform 0.1s ease;
      }
      
      .mobile-timer-pill:hover {
        background: var(--hover-bg);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      
      .mobile-timer-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        flex-shrink: 0;
        /* Ensure visibility */
        display: block;
      }
      
      .mobile-timer-dot.focus {
        background: var(--focus);
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
        animation: timerDotPulse 1.2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      
      .mobile-timer-dot.break {
        background: var(--rest);
        box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
        animation: timerDotPulse 1.2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      
      @keyframes timerDotPulse {
        0%, 100% { 
          opacity: 1; 
          transform: scale(1);
          box-shadow: 0 0 8px currentColor;
        }
        50% { 
          opacity: 0.5; 
          transform: scale(0.75);
          box-shadow: 0 0 12px currentColor;
        }
      }
      
      .mobile-timer-time {
        font-size: 12px;
        font-weight: 600;
        color: var(--text);
        font-variant-numeric: tabular-nums;
      }
      
      /* Header buttons - bouncy press */
      .mobile-header-btn {
        width: 34px;
        height: 34px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--toggle-bg);
        border: none;
        border-radius: var(--radius-md);
        color: var(--text-muted);
        cursor: pointer;
        /* Bouncy spring transition */
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      
      .mobile-header-btn:active {
        transform: scale(0.85);
        background: var(--border);
        transition: transform 0.1s ease;
      }
      
      .mobile-header-btn svg {
        width: 18px;
        height: 18px;
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      
      .mobile-header-btn:active svg {
        transform: rotate(-15deg);
      }
      
      .mobile-header-btn svg {
        width: 20px;
        height: 20px;
      }

      /* ========================================
         HIDE DESKTOP ELEMENTS ON MOBILE
         ======================================== */

      /* Hide quick-add bar - use FAB instead */
      .quick-add-bar {
        display: none !important;
      }
      
      /* Hide encouragement bar on mobile */
      .encouragement-bar {
        display: none !important;
      }
      
      /* Hide enough indicator on mobile - too much chrome */
      .enough-indicator {
        display: none !important;
      }

      /* ========================================
         MOBILE CONTENT LAYOUT
         ======================================== */

      /* Adjust main container for mobile - REMOVED duplicate, using scroll constraints section instead */
      
      /* Ensure first card in each tab has proper spacing */
      .order-layout > :first-child,
      .focus-layout > :first-child,
      .rest-layout > :first-child {
        margin-top: 0; /* Reset any margin that might compound */
      }
      
      /* View-container padding is set in the main mobile scroll section above */
      
      /* Single column layouts */
      .order-layout,
      .focus-layout,
      .rest-layout {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
        max-width: 100%;
      }
      
      /* Reset any grid columns */
      .order-layout .column,
      .focus-layout .column,
      .rest-layout .column {
        width: 100%;
        max-width: 100%;
      }

      /* Daily Reflection card should not be tiny */
      .reflection-card {
        min-height: 200px;
      }
      
      .reflection-card .card-content {
        padding: var(--space-4);
      }
      
      /* Make it full width */
      .rest-layout .reflection-card {
        width: 100%;
        max-width: 100%;
      }

      /* Focus layout mobile - ensure all content displays */
      .focus-layout {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
        padding-bottom: var(--space-4);
        overflow: visible;
      }
      
      /* Timer card should be full width and prominent */
      .focus-layout .timer-card {
        width: 100%;
        order: -1; /* Ensure timer is first */
      }
      
      /* Today's tasks card */
      .focus-layout .tasks-focus-card {
        width: 100%;
      }
      
      /* To Explore card */
      .focus-layout .explore-card {
        width: 100%;
      }
      
      /* Rest layout should not force min-height */
      .rest-layout {
        min-height: auto;
      }
      
      /* Footer should be at natural bottom, not floating */
      .footer {
        position: relative;
        margin-top: auto;
        padding-bottom: calc(var(--space-4) + 80px + var(--safe-bottom));
      }
      
      /* Position FAB above mobile tab bar - matches prototype */
      .fab,
      .selah-trigger {
        bottom: calc(var(--tab-bar-height) + var(--safe-bottom) + 20px);
        right: var(--space-4);
        z-index: 150;
        transition: bottom 0.5s var(--spring-bounce);
      }
      
      .fab.shifted,
      .selah-trigger.shifted {
        bottom: calc(var(--tab-bar-height) + var(--safe-bottom) + 8px);
      }
      
      .fab:active,
      .selah-trigger:active {
        transform: scale(0.85) !important;
        transition: transform 0.1s ease;
      }
      
      .fab:hover,
      .selah-trigger:hover {
        transform: scale(1.08);
        box-shadow: 
          0 8px 24px rgba(139, 92, 246, 0.4),
          0 0 0 4px rgba(139, 92, 246, 0.1);
      }
      
      /* Subtle floating animation when idle */
      @keyframes fabFloat {
        0%, 100% {
          transform: translateY(0);
          box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
        }
        50% {
          transform: translateY(-4px);
          box-shadow: 0 8px 24px rgba(139, 92, 246, 0.35);
        }
      }
      
      .fab:not(:active):not(:hover),
      .selah-trigger:not(:active):not(:hover) {
        animation: fabFloat 3s ease-in-out infinite;
      }
      
      /* Global touch feedback - make all buttons bouncy */
      button,
      .btn,
      .card-header,
      .task-checkbox,
      .habit-checkbox {
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      
      button:active,
      .btn:active {
        transform: scale(0.94);
        transition: transform 0.08s ease;
      }
      
      /* Cards get subtle bounce on tap */
      .card:active {
        transform: scale(0.985);
        transition: transform 0.1s ease;
      }
      
      /* Checkboxes bounce when toggled */
      .task-checkbox:active,
      .habit-checkbox:active {
        transform: scale(0.8);
      }
      
      @keyframes checkBounce {
        0% { transform: scale(0.8); }
        50% { transform: scale(1.15); }
        100% { transform: scale(1); }
      }
      
      .task-checkbox.checked,
      .habit-checkbox.checked {
        animation: checkBounce 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      /* Disable horizontal content swipe - we use bottom tabs */
      .view-container {
        transform: none !important;
        transition: none !important;
      }
    }
